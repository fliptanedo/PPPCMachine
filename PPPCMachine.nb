(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    266330,       6671]
NotebookOptionsPosition[    256508,       6359]
NotebookOutlinePosition[    256868,       6375]
CellTagsIndexPosition[    256825,       6372]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["PPPC Machine: combined spectra pipeline", "Title",
 CellChangeTimes->{
  3.621460293618519*^9, {3.621460512410861*^9, 3.621460565697466*^9}, 
   3.621460790178198*^9, {3.62293215640411*^9, 3.6229321576361847`*^9}, {
   3.6241125410770473`*^9, 3.624112571058625*^9}, {3.6307796070622053`*^9, 
   3.6307796163941565`*^9}}],

Cell[TextData[{
 "by ",
 StyleBox["Flip Tanedo",
  FontWeight->"Bold"],
 " \nwith assistance from Jordan Smolinsky & special thanks to David Curtin\n\
based on PPPC4DMID by Marco Cirelli et al, ",
 ButtonBox["www.marcocirelli.net/PPPC4DMID.html",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://www.marcocirelli.net/PPPC4DMID.html"], None},
  ButtonNote->"http://www.marcocirelli.net/PPPC4DMID.html"],
 " \n\n",
 StyleBox["If used:",
  FontWeight->"Bold"],
 " ",
 StyleBox["please",
  FontSlant->"Italic"],
 " cite Rajaraman, Smolinsky, Tanedo (2015). \n\nMachine for fitting FERMI \
diffuse \[Gamma]-ray spectra to simple models of DM annihilation to (i) 2 \
quarks, (ii) 2 (axial-)vector mediators that decay to quarks, (iii) 3 \
pseudoscalar mediators that decay to quarks. We assume that the vectors have \
universal coupling and the pseudoscalar has mass-weighted coupling so that it \
is well approximated by a b-philic coupling.\n\nBased on 2to2scanrevised.nb, \
HeavyHooperonPPPC.nb, 2to3Amplitude.nb\n\nGoal: \n1. output PPPC binned \
spectra\n2. take binned data and compare to PPPC spectra\n`\ta) compare to a \
histogram\n\tb) compare to a histogram with error bars\n\tc) compare to a \
histogram with degeneracies\n3. Provide tools for batch analysis of a range \
of spectra from a parameter space scan\n\t\n",
 StyleBox["Required",
  FontWeight->"Bold"],
 ": PPPC files. http://www.marcocirelli.net/PPPC4DMID.html. Download these \
somewhere and define the path below. See ",
 ButtonBox["www.marcocirelli.net/PPPC4DMID.html",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://www.marcocirelli.net/PPPC4DMID.html"], None},
  ButtonNote->"http://www.marcocirelli.net/PPPC4DMID.html"],
 " for more details.\n\n",
 StyleBox["Usage",
  FontWeight->"Bold"],
 ": Run this notebook. See PPPCMachineRunner notebook for doing parameter \
space scan. See PPPCMachineReader notebook for analysis of these outputs.\n\n",
 StyleBox["Remarks",
  FontWeight->"Bold"],
 ":\nFeb 13: interpolated functions for on-shell mediators with threshold \
masses don\[CloseCurlyQuote]t work, e.g. degenerate DM and vector mediator \
(2-to-2)."
}], "Text",
 CellChangeTimes->CompressedData["
1:eJwd0VtIk3EABfC1NBdeNrWWtDTESytvU3zITOwr1FhFNhquNW+frI1iWSrl
LcWWKSIuTBFzthq0iRjVCikw8I6KGtrCG1loSO0zXTN7SFn9zx4Ov6cDB04w
nS9RslksVgwJXFFxz+Rt2aigdW0G9FybUkMmrVUDtxdLm6BioaIFahI+fop1
2qg7Nd3fYcnLzwH6fzbqiEAtgHSR2mAgRnh4GeFSj0QazWIoeW6GDI4HmOMK
iKc5mwkw4Gx+ClwZcabCWrk8t5DYsCik4bf0PvMsseLQage0GcP75ok/3rX3
Q8vtoAlYHpbiUn5wunGVzVCTxvCH8PnsI8ZO7K2bcUAlb0fUuZ0M9UD2TAQb
pI1u/UQf2eXdMLlKtt3kzlCDPafcmol+kYH2aE+GchbO/YLpZk77YW+Gejyz
9RRaxNcG04miZXoU9o5pQzOJ/vVfXFpreUqo6gi5ChO9I49nEU/krCfBr+ND
8dnEwLn9idBrgU9DfSzvCry/fCu7mFgR9jsPHuvXsUuIRYKIXdDEeSOGzgtL
52H8Hsc9qOkS1sOl0FRRKfrSkXjoblGFWIlculoIxwRlcfBP71uXiiidh58P
+Uex6QlVlUfbxEQ/UdkTuPemiDIR5RsSl85h/0tQOM3LhBzfYNM08S53rhOK
h+oGR7kM1Tmgc1kSox2D1nJ6Ak6mTazBSMfAOizsMvyFB5yl21B/8f2rD0Tx
vqnX8OSNgbYhHkM5kjYMsKbleo6d2J08Xwk9fqr5fF+yZ7haAJt1VQUv+ORP
RVYx/A/FdGdX
  "]],

Cell[CellGroupData[{

Cell["Change Log", "Subsection",
 CellChangeTimes->{{3.632759724992427*^9, 3.632759725806608*^9}}],

Cell[TextData[{
 "Flip\[CloseCurlyQuote]s modifications:\n13 Feb 2015: Fixed ",
 StyleBox["GetMinA",
  FontWeight->"Bold"],
 " error in the case when A=1 fits. Changed ",
 StyleBox["RangeofNorms",
  FontWeight->"Bold"],
 " to sample on a log scale so that it gives even slices over a log-log plot. \
Actually, had to fix ",
 StyleBox["GetMinA",
  FontWeight->"Bold"],
 " again: it can get caught into a never-ending loop if there are no envelope \
sizes that fit. I put in a hard cutoff at A=10 to stop the loop, so any \
envelope scaling of 10 should be treated as effectively no envelope. Fixed \
more greater than/less than errors in this function. Also note that there are \
some AllTrue functions that don\[CloseCurlyQuote]t exist in ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " 9.\n\n11 Feb 2015: Fixed units on Fermi profiles so everything is in GeV. \
Included \[OpenCurlyDoubleQuote]short\[CloseCurlyDoubleQuote] code for \
testing the ",
 StyleBox["GetGoodNorms",
  FontWeight->"Bold"],
 " function. Introduced ",
 StyleBox["GetMinA ",
  FontWeight->"Bold"],
 "functions to find the minimum \[OpenCurlyQuote]wiggle \
room\[CloseCurlyQuote] needed for a given shape to fit an envelope. \
Introduced the ",
 StyleBox["FullTag",
  FontWeight->"Bold"],
 " function to extract all relevant data from the interpolated spectra.\n\n5 \
Feb 2015: consolidated some analysis code from PPPC Machine Reader. No need \
for that to be in a separate place. Including J factor tables from PPPC. \
\[OpenCurlyDoubleQuote]Graveyard\[CloseCurlyDoubleQuote] of old code removed, \
see 25 Jan backup version of code for\n\n26 Jan 2015: re-wrote on \
normalization code based on Jordan\[CloseCurlyQuote]s techniques. Just broke \
up the code into smaller functions so that they can be called and debugged \
independently. Also made them more general (at the cost of more arguments). \
Defined \[OpenCurlyDoubleQuote]bottomless\[CloseCurlyDoubleQuote] ",
 StyleBox["MinEnv",
  FontWeight->"Bold"],
 " to avoid confusion; the envelope is effectively zero above 14 GeV. Also: \
don\[CloseCurlyQuote]t ask about envelopes below / above the \
\[OpenCurlyDoubleQuote]data\[CloseCurlyDoubleQuote] -- i.e. stay within 1 and \
100 GeV, or else \[OpenCurlyDoubleQuote]",
 StyleBox["InEnvelope",
  FontWeight->"Bold"],
 "\[CloseCurlyDoubleQuote] can give spurious rejections.\n\n24 Jan 2015: qq\
\[CloseCurlyQuote] final states. This requires mediators with mass m > mq + \
mq\[CloseCurlyQuote], so the case of interest (tc) requires at least ~ 180 \
GeV\n\n22 Jan 2015: Some changes:\n- Added ",
 StyleBox["d\[Sigma]vdEfastest",
  FontWeight->"Bold"],
 " which does a discrete sum over mediator energies. Only 2x faster for <1% \
error. Doesn\[CloseCurlyQuote]t help much?\n- Fixed ",
 StyleBox["p3\[Phi]2gamfaster ",
  FontWeight->"Bold"],
 "and ",
 StyleBox["p3\[Phi]2gamSwift",
  FontWeight->"Bold"],
 " calls to p2\[Phi]2gamquick, which no longer needs the primary mass as an \
argument.\n- Tested ",
 StyleBox["p3\[Phi]2gamSwift",
  FontWeight->"Bold"],
 ", gives a factor of ~20 improvement in speed over p3\[Phi]2gamfaster. Can \
add another factor of 1.2 if you use d\[Sigma]dvEfastest, but this doesn\
\[CloseCurlyQuote]t seem worth the trouble.\n- Moved \
Jordan\[CloseCurlyQuote]s functions around so each section is organized \
coherently.\n-",
 StyleBox[" TO DO",
  FontWeight->"Bold"],
 ": clean up normalization test code\n- ",
 StyleBox["TO DO",
  FontWeight->"Bold"],
 ": eventually do the qq\[CloseCurlyQuote] final states, at least for \
vectors, maybe just for 2-to-2. \n\n21 Jan 2015: Minor changes for clarity. \
Some rearrangements. I was dumb, you don\[CloseCurlyQuote]t need to define \
interpolating functions that combine different final states---we can always \
add these together afterward. Jordan\[CloseCurlyQuote]s spectrum checker code \
isn\[CloseCurlyQuote]t affected by this. \n- Added ",
 StyleBox["p2\[Phi]2gamquickest",
  FontWeight->"Bold"],
 " function as a helper; introduced ",
 StyleBox["p2\[Phi]2gamSwift ",
  FontWeight->"Bold"],
 "and",
 StyleBox[" p3\[Phi]2gamSwift",
  FontWeight->"Bold"],
 ", factor of 30 faster. \n- ",
 StyleBox["TO DO",
  FontWeight->"Bold"],
 ": test the p3\[Phi]2gamSwift function---check accuracy. \n- Updated output \
functions\n- ",
 StyleBox["TO DO",
  FontWeight->"Bold"],
 ": output functions for 2-to-3 and flavor violation.\n\nJordan\
\[CloseCurlyQuote]s modifications:\n20 Jan 2015: Cut out the fat and wrote a \
function to do interpolations for combined spectra\n8 Jan 2015: Got the \
highlighting stuff to work\n24 Nov - 5 Dec 2014: Added functions to plot \
interpolated spectra iff the spectrum fits inside the specified envelope, and \
also outputs normalization constant\n\nFlip\[CloseCurlyQuote]s original:\n24 \
Nov 2014: Added functions to fit spectra both with exponential of a cubic \
polynomial and with a power law with exponential cutoff\n21 Nov 2014: \
Attempted to add functions that fit to the spectrum rather than outputting \
interpolation functions\n7-19 Nov 2014: Added function to handle flavor \
violating modes. Modified SaveIt to only produce the appropriate data files \
when all the masses make sense\n6 Nov 2014: Added some new helper functions \
for doing runs. Fixed error in p3\[Phi]2gam functions. Fixed error in \
p3\[Phi]2gamfaster: WeightedSpectrum[Egam_] was missing a factor of \
\[CapitalDelta]E\[Phi]. \n4 Nov 2014: ",
 StyleBox["this is a streamlined version of PPPC Machine; the idea is that \
you can just run the notebook to load all relevant functions",
  FontWeight->"Bold"],
 ". Based on the 3 November version. I\[CloseCurlyQuote]ve removed binning \
functions for now. Added DC\[CloseCurlyQuote]s SaveIt and ReadIt functions.\n\
3 November 2014: Minor bug fixes.\n2 Nov 2014: 2-3 spectra, faster 2-2 \
interpolations \n30 October 2014: kinematics and functions for on-shell \
mediators\n21 October 2014"
}], "Text",
 CellChangeTimes->{
  3.6327597293049803`*^9, {3.632835778390602*^9, 3.6328358011471043`*^9}, {
   3.632840332578504*^9, 3.6328403573761663`*^9}, {3.6328415888965693`*^9, 
   3.632841595832148*^9}, {3.632846370000374*^9, 3.63284643538507*^9}, {
   3.6328519419649687`*^9, 3.632851974365191*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"This", " ", "is", " ", "just", " ", "good", " ", "form"}], " ", 
   "*)"}]}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Code for generating interpolated spectra", "Subchapter",
 CellChangeTimes->{{3.631371402559371*^9, 3.631371424702921*^9}}],

Cell[CellGroupData[{

Cell["User-specific input", "Section",
 CellChangeTimes->{{3.5973864159912024`*^9, 3.597386447131727*^9}, {
  3.5973923172472267`*^9, 3.597392326462224*^9}}],

Cell[CellGroupData[{

Cell["Input your PPPC location and run", "Subsection",
 CellChangeTimes->{{3.597392319816428*^9, 3.597392321214788*^9}}],

Cell[TextData[{
 "Go to Insert > File Path to insert the path to ",
 StyleBox["dldNdlxEW.m ",
  FontWeight->"Bold"],
 "\nNote 2/10/2015: don\[CloseCurlyQuote]t bother with ",
 StyleBox["JAnn.m",
  FontWeight->"Bold"],
 ", it\[CloseCurlyQuote]s simpler and more accurate to calculate the J factor \
directly."
}], "Text",
 CellChangeTimes->{{3.597386469451541*^9, 3.5973864856895227`*^9}, {
  3.6326037020393476`*^9, 3.6326037480309134`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", "[", 
     "\"\<C:\\\\Users\\\\Jordan\\\\Documents\\\\My \
Dropbox\\\\Irvine\\\\Research\\\\Dark Matter GC Gamma \
Excess\\\\PPPC4DMID\\\\dlNdlxEW.m\>\"", "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
    "Get", "[", "\"\</Users/fliptanedo/Documents/Code/PPPC/dlNdlxEW.m\>\"", 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Get", "[", "\"\</Users/fliptanedo/Documents/Code/PPPC/JAnn.m\>\"", 
      "]"}], ";"}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.597386449040937*^9, 3.597386462452796*^9}, {
  3.5973865018435183`*^9, 3.597386558274807*^9}, {3.624378793495352*^9, 
  3.6243788150566225`*^9}, {3.630797117628038*^9, 3.630797132137916*^9}, {
  3.630797515647492*^9, 3.630797528536751*^9}, {3.6321551930280848`*^9, 
  3.6321552084900303`*^9}, {3.632603695307334*^9, 3.632603698203306*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define functions", "Section",
 CellChangeTimes->{{3.620624666334518*^9, 3.6206246685720787`*^9}}],

Cell[CellGroupData[{

Cell["Photon spectrum ", "Subsection",
 CellChangeTimes->{{3.6206243644845*^9, 3.6206243662730513`*^9}, 
   3.624112649963079*^9}],

Cell[CellGroupData[{

Cell["Instructions from PPPC sample file", "Subsubsection",
 CellChangeTimes->{{3.620624534671837*^9, 3.620624538078816*^9}}],

Cell[TextData[{
 "Fluxes are given as ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["Log", "10"], TraditionalForm]]],
 Cell[BoxData[
  FormBox[
   RowBox[{"[", 
    FractionBox[
     RowBox[{"d", " ", 
      StyleBox["N",
       FontSlant->"Italic"]}], 
     RowBox[{"d", " ", 
      SubscriptBox["Log", "10"], 
      StyleBox["x",
       FontSlant->"Italic"]}]], "]"}], TraditionalForm]]],
 "  (",
 Cell[BoxData[
  FormBox[
   RowBox[{"x", " ", "=", " ", 
    RowBox[{"K", "/", 
     SubscriptBox["m", "DM"]}]}], TraditionalForm]]],
 ", with ",
 StyleBox["K",
  FontSlant->"Italic"],
 " the kinetic energy in GeV)  normalized per single DM annihilation. \nThe \
format is\n\n\tdlNdlxIEW[",
 StyleBox["primary",
  FontSlant->"Italic"],
 " -> ",
 StyleBox["secondary",
  FontSlant->"Italic"],
 "][",
 StyleBox["mass",
  FontSlant->"Italic"],
 ", ",
 StyleBox["lx",
  FontSlant->"Italic"],
 "]\n\nwhere\n\n\t",
 StyleBox["primary",
  FontSlant->"Italic"],
 " = eL, eR, e, \[Mu]L, \[Mu]R, \[Mu], \[Tau]L, \[Tau]R, \[Tau], q, c, b, t, \
WL, WT, W, ZL, ZT, Z, g, \[Gamma], h, \[Nu]e, \[Nu]\[Mu], \[Nu]\[Tau], V\
\[Rule]e, V\[Rule]\[Mu], V\[Rule]\[Tau]\n\t",
 StyleBox["secondary",
  FontSlant->"Italic"],
 " = e, p, \[Gamma], d, \[Nu]e, \[Nu]\[Mu], \[Nu]\[Tau]\t\n\t",
 StyleBox["mass",
  FontSlant->"Italic"],
 " = ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["m", "DM"], "in", " ", "GeV"}], TraditionalForm]]],
 ", on the range ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["m", "DM"], "="}], TraditionalForm]]],
 " 5 GeV \[Rule] 100 TeV\n\t",
 StyleBox["lx",
  FontSlant->"Italic"],
 " = ",
 Cell[BoxData[
  FormBox[
   RowBox[{"Log", "[", 
    RowBox[{"10", ",", " ", "x"}], " ", "]"}], TraditionalForm]]],
 ", on the range x = ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["10", 
    RowBox[{"-", "9"}]], TraditionalForm]]],
 "\[Rule] 1 except for the channels V\[Rule]e, V\[Rule]\[Mu], V\[Rule]\[Tau] \
for which x = ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["10", 
    RowBox[{"-", "5"}]], TraditionalForm]]],
 "\[Rule] 1\n\nWarning:\tExtrapolations are performed close to the \
kinematical threshold for massive primaries (e.g. in the case DM DM -> ",
 Cell[BoxData[
  FormBox["ZZ", TraditionalForm]]],
 " with ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["m", "DM"], "=", 
    RowBox[{"93", " ", "GeV"}]}], TraditionalForm]]],
 "): the output fluxes should be reliable, but instabilities are possible. \
Also, instabilities very close to the edges of the domain in ",
 StyleBox["x",
  FontSlant->"Italic"],
 " are possible."
}], "Text",
 CellChangeTimes->{{3.491813290390963*^9, 3.49181332305795*^9}, {
   3.491813525593367*^9, 3.4918136998816442`*^9}, {3.491813737620508*^9, 
   3.4918137565178137`*^9}, {3.491813806275464*^9, 3.49181384887426*^9}, {
   3.491813891286971*^9, 3.49181408580469*^9}, 3.491814750694175*^9, {
   3.49321013659302*^9, 3.493210155956542*^9}, {3.49321022433305*^9, 
   3.493210226108947*^9}, {3.499498477073143*^9, 3.4994985034722643`*^9}, {
   3.499498710123808*^9, 3.4994988926095743`*^9}, {3.499498922834304*^9, 
   3.499498953105032*^9}, {3.5168622163242073`*^9, 3.5168622163243933`*^9}, {
   3.516862616685388*^9, 3.516862622287632*^9}, {3.5168627334790173`*^9, 
   3.516862734752125*^9}, 3.5522086172571907`*^9, {3.5522098687604427`*^9, 
   3.552209882574237*^9}, {3.620624523689534*^9, 3.620624533151478*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Generic primary to photon spectrum function", "Subsubsection",
 CellChangeTimes->{{3.620624547266817*^9, 3.62062455469455*^9}}],

Cell["\<\
pE is the primary energy, i.e. the mass of the DM for pairwise annihilation \
to SM pairs.\
\>", "Text",
 CellChangeTimes->{{3.620624576136381*^9, 3.6206245835200157`*^9}, {
  3.623675197436466*^9, 3.623675219208701*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"p2gam", "[", 
   RowBox[{"primary_", ",", "pE_", ",", "photonE_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"photonE", "<", "pE"}], ",", "\[IndentingNewLine]", 
    FractionBox[
     SuperscriptBox["10", 
      RowBox[{
       RowBox[{"dlNdlxIEW", "[", 
        RowBox[{"primary", "\[Rule]", "\"\<\[Gamma]\>\""}], "]"}], "[", 
       RowBox[{"pE", ",", 
        RowBox[{"Log", "[", 
         RowBox[{"10", ",", 
          FractionBox["photonE", "pE"]}], "]"}]}], "]"}]], 
     RowBox[{
      RowBox[{"Log", "[", "10.", "]"}], " ", "photonE", " "}]], ",", 
    "\[IndentingNewLine]", "0"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "if", " ", "photon", " ", "energy", " ", "is", " ", "larger", " ", "than",
      " ", "injection", " ", "energy"}], " ", "*)"}], "\[IndentingNewLine]", 
   "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"usage", ":", " ", 
     RowBox[{
     "primary", " ", "is", " ", "of", " ", "the", " ", "form", " ", 
      "\"\<\[Tau]\>\""}]}], ",", " ", 
    RowBox[{"WITH", " ", "the", " ", "quotation", " ", "marks"}]}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.623677719445817*^9, 3.6236777226013813`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Discussion: Boosted Spectra", "Section",
 CellChangeTimes->{{3.62360164817225*^9, 3.623601653307247*^9}}],

Cell["We give a brief discussion of boosted spectra.", "Text",
 CellChangeTimes->{{3.6236016550121813`*^9, 3.6236016642833357`*^9}}],

Cell["The photon spectrum is given by", "Text",
 CellChangeTimes->{{3.6236016802751913`*^9, 3.623601693666912*^9}}],

Cell[BoxData[
 RowBox[{
  FractionBox[
   SuperscriptBox[
    SubscriptBox["dN", "\[Gamma]"], "tot"], 
   SubscriptBox["dE", "\[Gamma]"]], "=", 
  RowBox[{"\[Integral]", 
   RowBox[{
    SubscriptBox["dE", "SM"], " ", 
    FractionBox[
     SuperscriptBox[
      SubscriptBox["dN", "SM"], "tot"], 
     SubscriptBox["dE", "SM"]], " ", 
    FractionBox[
     RowBox[{
      SubscriptBox["dN", "\[Gamma]"], 
      RowBox[{"(", 
       SubscriptBox["E", "SM"], ")"}]}], 
     SubscriptBox["dE", "\[Gamma]"]]}]}]}]], "DisplayFormula",
 CellChangeTimes->{{3.623601669993658*^9, 3.623601792539073*^9}}],

Cell[TextData[{
 "Where the spectrum of Standard Model primaries is a delta function for the \
case of annihilation of two DM particles into two SM particles. This is fixed \
purely from kinematics.\n\nIn the case of annihilation to on-shell mediators, \
however, we know that ",
 Cell[BoxData[
  FractionBox[
   SuperscriptBox[
    SubscriptBox["dN", "SM"], "tot"], 
   SubscriptBox["dE", "SM"]]],
  CellChangeTimes->{{3.623601669993658*^9, 3.623601792539073*^9}}],
 " has its own spectrum that is a box in the case of two on-shell mediators."
}], "Text",
 CellChangeTimes->{{3.623601675931497*^9, 3.6236016781956263`*^9}, {
  3.6236017972152643`*^9, 3.6236018977652187`*^9}}],

Cell[BoxData[
 RowBox[{
  FractionBox[
   SuperscriptBox[
    SubscriptBox["dN", "SM"], "tot"], 
   SubscriptBox["dE", "SM"]], "=", 
  RowBox[{"\[Integral]", 
   RowBox[{
    SubscriptBox["dE", "\[Phi]"], " ", 
    FractionBox[
     SubscriptBox["dN", "\[Phi]"], 
     SubscriptBox["dE", "\[Phi]"]], " ", 
    SubscriptBox[
     RowBox[{"(", 
      FractionBox[
       RowBox[{
        SubscriptBox["dN", "SM"], 
        RowBox[{"(", 
         SubscriptBox["E", "\[Phi]"], ")"}]}], 
       SubscriptBox["dE", "SM"]], ")"}], "lab"]}]}]}]], "DisplayFormula",
 CellChangeTimes->{{3.623601669993658*^9, 3.6236016732448*^9}, {
  3.623601904950045*^9, 3.623601987761437*^9}}],

Cell[TextData[{
 "Note that ",
 Cell[BoxData[
  SubscriptBox[
   RowBox[{"(", 
    FractionBox[
     RowBox[{
      SubscriptBox["dN", "SM"], 
      RowBox[{"(", 
       SubscriptBox["E", "\[Phi]"], ")"}]}], 
     SubscriptBox["dE", "SM"]], ")"}], "lab"]],
  CellChangeTimes->{{3.623601669993658*^9, 3.6236016732448*^9}, {
   3.623601904950045*^9, 3.623601987761437*^9}}],
 " is a box spectrum for a fixed ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["E", "\[Phi]"], TraditionalForm]]],
 ". This is because ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["E", "\[Phi]"], TraditionalForm]]],
 " in the lab frame is"
}], "Text",
 CellChangeTimes->{{3.623601675931497*^9, 3.6236016781956263`*^9}, {
  3.6236017972152643`*^9, 3.6236017980004272`*^9}, {3.623601998654153*^9, 
  3.623602061892543*^9}}],

Cell[BoxData[
 RowBox[{
  SubscriptBox["E", "\[Phi]"], "=", 
  RowBox[{
   RowBox[{"\[Gamma]", " ", 
    FractionBox[
     SubscriptBox["m", "\[Phi]"], "2"]}], "+", 
   RowBox[{"\[Gamma]\[Beta]", 
    SqrtBox[
     RowBox[{
      FractionBox[
       SuperscriptBox[
        SubscriptBox["m", "\[Phi]"], "2"], "4"], "-", 
      SuperscriptBox[
       SubscriptBox["m", "SM"], "2"]}]], 
    RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}]], "DisplayFormula",
 CellChangeTimes->{{3.623601669993658*^9, 3.6236016732448*^9}, {
  3.623602071165723*^9, 3.623602107231008*^9}}],

Cell["\<\
Where Cos[\[Theta]] is the angle with respect to the boost direction. We have \
to average over this angle to account for the isotropy of the DM \
annihilation. The boost parameter \[Gamma] is the boost from the \[Phi] rest \
frame to the lab frame. In particular,\
\>", "Text",
 CellChangeTimes->{{3.623602109627603*^9, 3.6236021618648453`*^9}}],

Cell[BoxData[{
 RowBox[{"\[Gamma]", " ", "=", " ", 
  FractionBox[
   SubscriptBox["E", "\[Phi]"], 
   SubscriptBox["m", "\[Phi]"]]}], "\[IndentingNewLine]", 
 RowBox[{"\[Gamma]\[Beta]", "=", 
  SqrtBox[
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox[
       SubscriptBox["E", "\[Phi]"], 
       SubscriptBox["m", "\[Phi]"]], ")"}], "2"], "-", 
    "1"}]]}]}], "DisplayFormula",
 CellChangeTimes->{{3.623601669993658*^9, 3.6236016732448*^9}, {
  3.623602172304734*^9, 3.6236022202895813`*^9}}],

Cell["\<\
Then, in terms of the unit box function (box of unit length and height, \
centered around zero,\
\>", "Text",
 CellChangeTimes->{{3.623602232233881*^9, 3.623602239273761*^9}, {
  3.623602279329197*^9, 3.623602302400408*^9}}],

Cell[BoxData[{
 RowBox[{
  SubscriptBox[
   RowBox[{"(", 
    FractionBox[
     RowBox[{
      SubscriptBox["dN", "SM"], 
      RowBox[{"(", 
       SubscriptBox["E", "\[Phi]"], ")"}]}], 
     SubscriptBox["dE", "SM"]], ")"}], "lab"], "=", " ", 
  RowBox[{
   RowBox[{"(", "Norm", ")"}], " ", 
   RowBox[{"UnitBox", "[", 
    FractionBox[
     RowBox[{" ", 
      RowBox[{"(", 
       RowBox[{
        SubscriptBox["E", "SM"], "-", 
        FractionBox[
         SubscriptBox["E", "\[Phi]"], "2"]}], ")"}]}], 
     RowBox[{"2", 
      SqrtBox[
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox[
           SubscriptBox["E", "\[Phi]"], 
           SubscriptBox["m", "\[Phi]"]], ")"}], "2"], "-", "1"}]], 
      SqrtBox[
       RowBox[{
        FractionBox[
         SuperscriptBox[
          SubscriptBox["m", "\[Phi]"], "2"], "4"], "-", 
        SuperscriptBox[
         SubscriptBox["m", "SM"], "2"]}]]}]], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", "Norm", ")"}], " ", "=", 
  RowBox[{
   FractionBox[
    RowBox[{
    "Number", " ", "of", " ", "SM", " ", "particles", " ", "per", " ", 
     "\[Phi]"}], 
    RowBox[{"Width", " ", "of", " ", "the", " ", "box"}]], "=", 
   FractionBox["2", 
    RowBox[{"2", 
     SqrtBox[
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          SubscriptBox["E", "\[Phi]"], 
          SubscriptBox["m", "\[Phi]"]], ")"}], "2"], "-", "1"}]], 
     SqrtBox[
      RowBox[{
       FractionBox[
        SuperscriptBox[
         SubscriptBox["m", "\[Phi]"], "2"], "4"], "-", 
       SuperscriptBox[
        SubscriptBox["m", "SM"], "2"]}]]}]]}]}]}], "DisplayFormula",
 CellChangeTimes->{{3.623601669993658*^9, 3.6236016732448*^9}, {
  3.623602322115097*^9, 3.6236025028653183`*^9}, {3.6236025596208353`*^9, 
  3.623602597494769*^9}, {3.623635637700696*^9, 3.623635642542967*^9}, {
  3.6236356794826612`*^9, 3.623635738945301*^9}}],

Cell["So ultimately we have", "Text",
 CellChangeTimes->{{3.623602607499752*^9, 3.623602609275854*^9}}],

Cell[BoxData[
 RowBox[{
  FractionBox[
   SuperscriptBox[
    SubscriptBox["dN", "\[Gamma]"], "tot"], 
   SubscriptBox["dE", "\[Gamma]"]], "=", 
  RowBox[{"\[Integral]", 
   RowBox[{
    SubscriptBox["dE", "SM"], " ", 
    RowBox[{"(", 
     RowBox[{"\[Integral]", 
      RowBox[{
       SubscriptBox["dE", "\[Phi]"], " ", 
       FractionBox[
        SubscriptBox["dN", "\[Phi]"], 
        SubscriptBox["dE", "\[Phi]"]], " ", 
       RowBox[{"(", "Norm", ")"}], " ", 
       RowBox[{"UnitBox", "[", 
        FractionBox[
         RowBox[{" ", 
          RowBox[{"(", 
           RowBox[{
            SubscriptBox["E", "SM"], "-", 
            FractionBox[
             SubscriptBox["E", "\[Phi]"], "2"]}], ")"}]}], 
         RowBox[{"2", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              FractionBox[
               SubscriptBox["E", "\[Phi]"], 
               SubscriptBox["m", "\[Phi]"]], ")"}], "2"], "-", "1"}]], 
          SqrtBox[
           RowBox[{
            FractionBox[
             SuperscriptBox[
              SubscriptBox["m", "\[Phi]"], "2"], "4"], "-", 
            SuperscriptBox[
             SubscriptBox["m", "SM"], "2"]}]]}]], "]"}]}]}], ")"}], " ", 
    FractionBox[
     RowBox[{
      SubscriptBox["dN", "\[Gamma]"], 
      RowBox[{"(", 
       SubscriptBox["E", "SM"], ")"}]}], 
     SubscriptBox["dE", "\[Gamma]"]]}]}]}]], "DisplayFormula",
 CellChangeTimes->{{3.623602616454091*^9, 3.6236026740053167`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Boosted Spectra: 2 to 2", "Section",
 CellChangeTimes->{{3.622999509073577*^9, 3.6229995128167257`*^9}}],

Cell["\<\
Now we define a set of tools for annihilation modes to two on-shell [vector] \
mediators which subsequently decay into pairs of SM fermions. 

Notes: I\[CloseCurlyQuote]m not building in any automatic \
\[OpenCurlyDoubleQuote]zero if the kinematics don\[CloseCurlyQuote]t allow \
on-shell mediators.\[CloseCurlyDoubleQuote] Users should be careful.\
\>", "Text",
 CellChangeTimes->{{3.6229995143522997`*^9, 3.622999532247127*^9}, {
  3.623674690074484*^9, 3.623674713816463*^9}}],

Cell[CellGroupData[{

Cell["Functions", "Subsection",
 CellChangeTimes->{{3.6236760643471212`*^9, 3.6236760695106583`*^9}}],

Cell["\<\
Following my HeavyHooperonPPPC code, I\[CloseCurlyQuote]ll define a full \
funciton (p2p\[Phi]2gam) which does a numerical integral over the SM final \
state energies (whose range comes from the boosted mediator). For scans it\
\[CloseCurlyQuote]s more useful to define an interpolating function for the \
spectrum\
\>", "Text",
 CellChangeTimes->{{3.623676070806614*^9, 3.623676154700251*^9}, {
  3.62367627549654*^9, 3.6236763295650806`*^9}}],

Cell[CellGroupData[{

Cell["Regular: \[Chi]\[Chi]\[Rule]VV (V\[Rule]qq) [no longer used]", \
"Subsubsection",
 CellChangeTimes->{{3.6308852990134373`*^9, 3.630885301142131*^9}, {
  3.6308853428054247`*^9, 3.630885370964952*^9}, {3.630887581962274*^9, 
  3.630887586120805*^9}, {3.630887625579995*^9, 3.630887627135973*^9}}],

Cell["\<\
This is the obvious thing to write, but there are some tricks to make it \
faster.]\
\>", "Text",
 CellChangeTimes->{{3.6308876287709618`*^9, 3.630887640314715*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"p2\[Phi]2gam", "[", 
   RowBox[{"primary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "photonE_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"finalstate", "=", "primary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", " ", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"e\[Gamma]", "=", "photonE"}], ",", "mSM", ",", "\[Gamma]", ",",
       "\[Gamma]\[Beta]", ",", " ", "E0", ",", " ", "norm", ",", "EfsHi", ",",
       "EfsLo"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mSM", " ", "=", " ", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"finalstate", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", 
        ",", " ", 
        RowBox[{"finalstate", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",",
         " ", 
        RowBox[{"finalstate", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",",
         " ", 
        RowBox[{"finalstate", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
       "]"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]", "=", 
      FractionBox["mchi", "mphi"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]\[Beta]", "=", 
      SqrtBox[
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["mchi", "mphi"], ")"}], "2"], "-", "1"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E0", "=", 
      RowBox[{"mphi", "/", "2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norm", "=", 
      FractionBox["1", 
       RowBox[{"\[Gamma]\[Beta]", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Just", " ", "a", " ", "sanity", " ", "check"}], ",", " ", 
       RowBox[{"the", " ", 
        RowBox[{
         SubscriptBox["dN", "\[Phi]"], "/", 
         SubscriptBox["dE", "\[Phi]"]}], " ", "distribution", " ", "is"}]}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"norm", " ", 
        RowBox[{"UnitBox", "[", 
         FractionBox[
          RowBox[{"e\[Gamma]", 
           RowBox[{"(*", "temp", "*)"}], " ", "-", " ", "E0"}], 
          RowBox[{"2", " ", "\[Gamma]\[Beta]", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               FractionBox["mphi", "2"], ")"}], "2"], "-", 
             SuperscriptBox["mSM", "2"]}]]}]], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"EfsHi", "=", 
      RowBox[{
       RowBox[{"\[Gamma]", " ", "E0"}], "+", 
       RowBox[{"\[Gamma]\[Beta]", " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"EfsLo", "=", 
      RowBox[{
       RowBox[{"\[Gamma]", " ", "E0"}], "-", 
       RowBox[{"\[Gamma]\[Beta]", " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norm", " ", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"p2gam", "[", 
         RowBox[{"finalstate", ",", "Efs", ",", "e\[Gamma]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Efs", ",", "EfsLo", ",", "EfsHi"}], "}"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.630885413977322*^9, 3.630885414274931*^9}, {
  3.6308875183931847`*^9, 3.630887520053771*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["QUICK: \[Chi]\[Chi]\[Rule]VV (V\[Rule]qq)  [no longer used]", \
"Subsubsection",
 CellChangeTimes->{{3.630887542631899*^9, 3.630887593785831*^9}}],

Cell["\<\
This uses \
\[OpenCurlyDoubleQuote]SymbolicProcessing->0\[CloseCurlyDoubleQuote] in the \
NIntegrate function and is factor of 8 faster.\
\>", "Text",
 CellChangeTimes->{{3.630887596166709*^9, 3.630887619778306*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "alternate", " ", "version", " ", "with", " ", 
     "\"\<SymbolicProcessing->0\>\""}], ",", " ", 
    RowBox[{"factor", " ", "of", " ", "8", " ", "faster"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"p2\[Phi]2gamquick", "[", 
    RowBox[{"primary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "photonE_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"finalstate", "=", "primary"}], ",", 
       RowBox[{"mchi", "=", "m\[Chi]"}], ",", " ", 
       RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
       RowBox[{"e\[Gamma]", "=", "photonE"}], ",", "mSM", ",", "\[Gamma]", 
       ",", "\[Gamma]\[Beta]", ",", " ", "E0", ",", " ", "norm", ",", "EfsHi",
        ",", "EfsLo"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mSM", " ", "=", " ", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"finalstate", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", 
         ",", " ", 
         RowBox[{"finalstate", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", 
         ",", " ", 
         RowBox[{"finalstate", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", 
         ",", " ", 
         RowBox[{"finalstate", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Gamma]", "=", 
       FractionBox["mchi", "mphi"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Gamma]\[Beta]", "=", 
       SqrtBox[
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox["mchi", "mphi"], ")"}], "2"], "-", "1"}]]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"E0", "=", 
       RowBox[{"mphi", "/", "2"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"norm", "=", 
       FractionBox["1", 
        RowBox[{"\[Gamma]\[Beta]", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["mphi", "2"], ")"}], "2"], "-", 
           SuperscriptBox["mSM", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Just", " ", "a", " ", "sanity", " ", "check"}], ",", " ", 
        RowBox[{"the", " ", 
         RowBox[{
          SubscriptBox["dN", "\[Phi]"], "/", 
          SubscriptBox["dE", "\[Phi]"]}], " ", "distribution", " ", "is"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"norm", " ", 
         RowBox[{"UnitBox", "[", 
          FractionBox[
           RowBox[{"e\[Gamma]", 
            RowBox[{"(*", "temp", "*)"}], " ", "-", " ", "E0"}], 
           RowBox[{"2", " ", "\[Gamma]\[Beta]", 
            SqrtBox[
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                FractionBox["mphi", "2"], ")"}], "2"], "-", 
              SuperscriptBox["mSM", "2"]}]]}]], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"EfsHi", "=", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", "E0"}], "+", 
        RowBox[{"\[Gamma]\[Beta]", " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["mphi", "2"], ")"}], "2"], "-", 
           SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"EfsLo", "=", 
       RowBox[{
        RowBox[{"\[Gamma]", " ", "E0"}], "-", 
        RowBox[{"\[Gamma]\[Beta]", " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["mphi", "2"], ")"}], "2"], "-", 
           SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"norm", " ", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"finalstate", ",", "Efs", ",", "e\[Gamma]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Efs", ",", "EfsLo", ",", "EfsHi"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Automatic", ",", 
             RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
            "}"}]}]}], "]"}]}], "//", "Quiet"}]}]}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "seems", " ", "to", " ", "give", " ", "slow", " ", "convergence", " ", 
       "warnings"}], ",", " ", 
      RowBox[{"only", " ", "off", " ", "at", " ", "4", "th", " ", 
       RowBox[{"decimal", "?"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["QUICKEST: \[Chi]\[Chi]\[Rule]VV (V\[Rule]qq) [Discretizes integral]", \
"Subsubsection",
 CellChangeTimes->{{3.6308876714891167`*^9, 3.630887693527492*^9}}],

Cell[TextData[{
 "Some quick tests with b-quark final staes: with nEfs=10 samplings, you the \
result is within one precent accuracy and almost 30 times faster. Tested with \
b quark final states (80 GeV DM going to 20 GeV mediators). You can go with \
nEfs=20 samplings to be safe, but this is probably overkill. \n\nSince there \
is a flat distribution in the primary energy, you can get away with fairly \
low number of samplings.\n\nI should also add this to the flavor-violating \
final state, but that one doesn\[CloseCurlyQuote]t have much parameter space \
to worry about anyway, so I\[CloseCurlyQuote]ll leave it as is.\n\n",
 StyleBox["Note",
  FontWeight->"Bold"],
 ": p2\[Phi]2gamquickest also includes the map between primary and its mass."
}], "Text",
 CellChangeTimes->{{3.630887699694344*^9, 3.630887743165934*^9}, {
   3.630887791706736*^9, 3.630887843756044*^9}, 3.630887894092412*^9, {
   3.630887975114046*^9, 3.6308880013530407`*^9}, {3.630888033410327*^9, 
   3.630888035198247*^9}, {3.630888092253276*^9, 3.630888095542273*^9}, {
   3.6308881648894567`*^9, 3.630888187694961*^9}, {3.63088865175102*^9, 
   3.630888670212159*^9}, {3.630889643991789*^9, 3.630889664677698*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"p2\[Phi]2gamquickest", "[", 
   RowBox[{
   "primary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "nEfs_", ",", 
    "photonE_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"finalstate", "=", "primary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", " ", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"e\[Gamma]", "=", "photonE"}], ",", "mSM", ",", "\[Gamma]", ",",
       "\[Gamma]\[Beta]", ",", " ", "E0", ",", " ", "norm", ",", "EfsHi", ",",
       "EfsLo", ",", 
      RowBox[{"numEfs", "=", "nEfs"}], ",", "rangeEfs"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mSM", " ", "=", " ", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"finalstate", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", 
        ",", " ", 
        RowBox[{"finalstate", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",",
         " ", 
        RowBox[{"finalstate", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",",
         " ", 
        RowBox[{"finalstate", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]", "=", 
      FractionBox["mchi", "mphi"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]\[Beta]", "=", 
      SqrtBox[
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["mchi", "mphi"], ")"}], "2"], "-", "1"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E0", "=", 
      RowBox[{"mphi", "/", "2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norm", "=", 
      FractionBox["1", 
       RowBox[{"\[Gamma]\[Beta]", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Just", " ", "a", " ", "sanity", " ", "check"}], ",", " ", 
       RowBox[{"the", " ", 
        RowBox[{
         SubscriptBox["dN", "\[Phi]"], "/", 
         SubscriptBox["dE", "\[Phi]"]}], " ", "distribution", " ", "is"}]}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"norm", " ", 
        RowBox[{"UnitBox", "[", 
         FractionBox[
          RowBox[{"e\[Gamma]", 
           RowBox[{"(*", "temp", "*)"}], " ", "-", " ", "E0"}], 
          RowBox[{"2", " ", "\[Gamma]\[Beta]", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               FractionBox["mphi", "2"], ")"}], "2"], "-", 
             SuperscriptBox["mSM", "2"]}]]}]], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"EfsHi", "=", 
      RowBox[{
       RowBox[{"\[Gamma]", " ", "E0"}], "+", 
       RowBox[{"\[Gamma]\[Beta]", " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"EfsLo", "=", 
      RowBox[{
       RowBox[{"\[Gamma]", " ", "E0"}], "-", 
       RowBox[{"\[Gamma]\[Beta]", " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"norm", " ", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"finalstate", ",", "Efs", ",", "e\[Gamma]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Efs", ",", "EfsLo", ",", "EfsHi"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Automatic", ",", 
             RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
            "}"}]}]}], "]"}]}], "//", "Quiet"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "seems", " ", "to", " ", "give", " ", "slow", " ", "convergence", " ", 
        "warnings"}], ",", " ", 
       RowBox[{"only", " ", "off", " ", "at", " ", "4", "th", " ", 
        RowBox[{"decimal", "?"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"rangeEfs", "=", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"EfsLo", "+", 
         FractionBox[
          RowBox[{"EfsHi", "-", "EfsLo"}], 
          RowBox[{"2", "numEfs"}]]}], ",", "EfsHi", ",", 
        FractionBox[
         RowBox[{"EfsHi", "-", "EfsLo"}], "numEfs"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"norm", "  ", 
      FractionBox[
       RowBox[{"EfsHi", "-", "EfsLo"}], "numEfs"], 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"p2gam", "[", 
          RowBox[{"finalstate", ",", "#", ",", "e\[Gamma]"}], "]"}], "&"}], "/@",
         "rangeEfs"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.63088772970508*^9, 3.63088773151052*^9}, {
  3.630889640041686*^9, 3.630889642322792*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Old: \[Chi]\[Chi]\[Rule]VV\tV\[Rule]qq\[CloseCurlyQuote] [not used]", \
"Subsubsection",
 CellChangeTimes->{{3.630885389381344*^9, 3.630885405002965*^9}, {
  3.630887651416329*^9, 3.630887665322032*^9}, {3.631129174337493*^9, 
  3.6311291772351017`*^9}}],

Cell["\<\
This gives the \[Gamma] spectrum for boosted mediators which can decay into \
flavor violating quark pairs. In particular, you might be interested in the \
decay into top-charm. \
\>", "Text",
 CellChangeTimes->{{3.630885433651085*^9, 3.630885442901494*^9}, {
  3.630885514614702*^9, 3.630885521763619*^9}, {3.631134409500684*^9, 
  3.63113441102663*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"diffquarkstogammafull", "[", 
    RowBox[{
    "flavor1_", ",", " ", "flavor2_", ",", " ", "mchi_", ",", " ", "mphi_", 
     ",", " ", "photonenergy_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m\[Chi]", " ", "=", " ", "mchi"}], ",", " ", 
       RowBox[{"m\[Phi]", " ", "=", " ", "mphi"}], ",", " ", 
       RowBox[{"e\[Gamma]", " ", "=", " ", "photonenergy"}], ",", " ", 
       "\[Gamma]", ",", " ", "\[Beta]", ",", " ", "Eq10", ",", " ", "Eq20", 
       ",", " ", "mq1", ",", " ", "mq2", ",", " ", "Eq1low", ",", " ", 
       "Eq1high", ",", " ", "Eq2low", ",", " ", "Eq2high", ",", " ", "norm1", 
       ",", " ", "norm2"}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{"mq1", " ", "=", " ", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"flavor1", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", ",", 
         " ", 
         RowBox[{"flavor1", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",", 
         " ", 
         RowBox[{"flavor1", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",", 
         " ", 
         RowBox[{"flavor1", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
        "]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"heavy", " ", "quark", " ", "masses"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"mq2", " ", "=", " ", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"flavor2", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", ",", 
         " ", 
         RowBox[{"flavor2", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",", 
         " ", 
         RowBox[{"flavor2", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",", 
         " ", 
         RowBox[{"flavor2", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Gamma]", " ", "=", " ", 
       FractionBox["m\[Chi]", "m\[Phi]"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Beta]", "=", 
       SqrtBox[
        RowBox[{"1", "-", 
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox["m\[Phi]", "m\[Chi]"], ")"}], "2"]}]]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "the", " ", "energies", " ", "of", " ", "the", " ", "emitted", " ", 
        "particles", " ", "in", " ", "the", " ", "\[Phi]", " ", "rest", " ", 
        "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Eq10", " ", "=", " ", 
       RowBox[{
        FractionBox["m\[Phi]", "2"], "+", 
        FractionBox[
         RowBox[{
          SuperscriptBox["mq1", "2"], "-", 
          SuperscriptBox["mq2", "2"]}], 
         RowBox[{"2", " ", "m\[Phi]"}]]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Eq20", " ", "=", " ", 
       RowBox[{
        FractionBox["m\[Phi]", "2"], "+", 
        FractionBox[
         RowBox[{
          SuperscriptBox["mq2", "2"], "-", 
          SuperscriptBox["mq1", "2"]}], 
         RowBox[{"2", " ", "m\[Phi]"}]]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "the", " ", "min", " ", "and", " ", "max", " ", "energies", " ", "of", 
        " ", "the", " ", "emitted", " ", "particles", " ", "in", " ", "the", 
        " ", "lab", " ", "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Eq1low", "=", 
       RowBox[{"\[Gamma]", " ", 
        RowBox[{"(", 
         RowBox[{"Eq10", "-", 
          RowBox[{"\[Beta]", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["Eq10", "2"], "-", 
             SuperscriptBox["mq1", "2"]}]]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Eq2low", " ", "=", " ", 
       RowBox[{"\[Gamma]", 
        RowBox[{"(", 
         RowBox[{"Eq20", "-", 
          RowBox[{"\[Beta]", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["Eq20", "2"], " ", "-", " ", 
             SuperscriptBox["mq2", "2"]}]]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Eq1high", "=", 
       RowBox[{"\[Gamma]", " ", 
        RowBox[{"(", 
         RowBox[{"Eq10", "+", 
          RowBox[{"\[Beta]", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["Eq10", "2"], "-", 
             SuperscriptBox["mq1", "2"]}]]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Eq2high", "=", 
       RowBox[{"\[Gamma]", " ", 
        RowBox[{"(", 
         RowBox[{"Eq20", "+", 
          RowBox[{"\[Beta]", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["Eq20", "2"], "-", 
             SuperscriptBox["mq2", "2"]}]]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"norm1", "=", " ", 
       FractionBox["1", 
        RowBox[{"2", "\[Beta]", " ", "\[Gamma]", 
         SqrtBox[
          RowBox[{
           SuperscriptBox["Eq10", "2"], "-", 
           SuperscriptBox["mq1", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{"norm2", " ", "=", " ", 
       FractionBox["1", 
        RowBox[{"2", "\[Beta]", " ", "\[Gamma]", 
         SqrtBox[
          RowBox[{
           SuperscriptBox["Eq20", "2"], "-", 
           SuperscriptBox["mq2", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "output", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"0.5", " ", "norm1", " ", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"flavor1", ",", " ", "Eq1", ",", " ", "e\[Gamma]"}], "]"}],
           ",", " ", 
          RowBox[{"{", 
           RowBox[{"Eq1", ",", " ", "Eq1low", ",", " ", "Eq1high"}], "}"}]}], 
         "]"}]}], "+", 
       RowBox[{"0.5", "norm2", " ", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"flavor2", ",", " ", "Eq2", ",", " ", "e\[Gamma]"}], "]"}],
           ",", " ", 
          RowBox[{"{", 
           RowBox[{"Eq2", ",", " ", "Eq2low", ",", " ", "Eq2high"}], "}"}]}], 
         "]"}]}]}]}]}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"diffquarkstogammaquick", "[", 
   RowBox[{
   "flavor1_", ",", " ", "flavor2_", ",", " ", "mchi_", ",", " ", "mphi_", 
    ",", " ", "photonenergy_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"m\[Chi]", " ", "=", " ", "mchi"}], ",", " ", 
      RowBox[{"m\[Phi]", " ", "=", " ", "mphi"}], ",", " ", 
      RowBox[{"e\[Gamma]", " ", "=", " ", "photonenergy"}], ",", " ", 
      "\[Gamma]", ",", " ", "\[Beta]", ",", " ", "Eq10", ",", " ", "Eq20", 
      ",", " ", "mq1", ",", " ", "mq2", ",", " ", "Eq1low", ",", " ", 
      "Eq1high", ",", " ", "Eq2low", ",", " ", "Eq2high", ",", " ", "norm1", 
      ",", " ", "norm2"}], "}"}], ",", " ", 
    RowBox[{
     RowBox[{"mq1", " ", "=", " ", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"flavor1", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", ",", 
        " ", 
        RowBox[{"flavor1", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",", 
        " ", 
        RowBox[{"flavor1", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",", 
        " ", 
        RowBox[{"flavor1", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
       "]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"heavy", " ", "quark", " ", "masses"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"mq2", " ", "=", " ", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"flavor2", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", ",", 
        " ", 
        RowBox[{"flavor2", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",", 
        " ", 
        RowBox[{"flavor2", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",", 
        " ", 
        RowBox[{"flavor2", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]", " ", "=", " ", 
      FractionBox["m\[Chi]", "m\[Phi]"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Beta]", "=", 
      SqrtBox[
       RowBox[{"1", "-", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["m\[Phi]", "m\[Chi]"], ")"}], "2"]}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "the", " ", "energies", " ", "of", " ", "the", " ", "emitted", " ", 
       "particles", " ", "in", " ", "the", " ", "\[Phi]", " ", "rest", " ", 
       "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Eq10", " ", "=", " ", 
      RowBox[{
       FractionBox["m\[Phi]", "2"], "+", 
       FractionBox[
        RowBox[{
         SuperscriptBox["mq1", "2"], "-", 
         SuperscriptBox["mq2", "2"]}], 
        RowBox[{"2", " ", "m\[Phi]"}]]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Eq20", " ", "=", " ", 
      RowBox[{
       FractionBox["m\[Phi]", "2"], "+", 
       FractionBox[
        RowBox[{
         SuperscriptBox["mq2", "2"], "-", 
         SuperscriptBox["mq1", "2"]}], 
        RowBox[{"2", " ", "m\[Phi]"}]]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "the", " ", "min", " ", "and", " ", "max", " ", "energies", " ", "of", 
       " ", "the", " ", "emitted", " ", "particles", " ", "in", " ", "the", 
       " ", "lab", " ", "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Eq1low", "=", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{"(", 
        RowBox[{"Eq10", "-", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq10", "2"], "-", 
            SuperscriptBox["mq1", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Eq2low", " ", "=", " ", 
      RowBox[{"\[Gamma]", 
       RowBox[{"(", 
        RowBox[{"Eq20", "-", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq20", "2"], " ", "-", " ", 
            SuperscriptBox["mq2", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Eq1high", "=", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{"(", 
        RowBox[{"Eq10", "+", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq10", "2"], "-", 
            SuperscriptBox["mq1", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Eq2high", "=", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{"(", 
        RowBox[{"Eq20", "+", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq20", "2"], "-", 
            SuperscriptBox["mq2", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"norm1", "=", " ", 
      FractionBox["1", 
       RowBox[{"2", "\[Beta]", " ", "\[Gamma]", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["Eq10", "2"], "-", 
          SuperscriptBox["mq1", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norm2", " ", "=", " ", 
      FractionBox["1", 
       RowBox[{"2", "\[Beta]", " ", "\[Gamma]", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["Eq20", "2"], "-", 
          SuperscriptBox["mq2", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "output", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"0.5", " ", "norm1", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{"p2gam", "[", 
            RowBox[{"flavor1", ",", " ", "Eq1", ",", " ", "e\[Gamma]"}], 
            "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"Eq1", ",", " ", "Eq1low", ",", " ", "Eq1high"}], "}"}], 
           ",", " ", 
           RowBox[{"Method", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Automatic", ",", " ", 
              RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
             "}"}]}]}], "]"}], "//", "Quiet"}], ")"}]}], "+", 
      RowBox[{"0.5", "norm2", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{"p2gam", "[", 
            RowBox[{"flavor2", ",", " ", "Eq2", ",", " ", "e\[Gamma]"}], 
            "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"Eq2", ",", " ", "Eq2low", ",", " ", "Eq2high"}], "}"}], 
           ",", " ", 
           RowBox[{"Method", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Automatic", ",", " ", 
              RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
             "}"}]}]}], "]"}], "//", "Quiet"}], ")"}]}]}]}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.623674391817163*^9, 3.623674392153565*^9}, {
   3.623674434232617*^9, 3.623674612862217*^9}, {3.623674651301249*^9, 
   3.623674687965611*^9}, {3.6236747202085743`*^9, 3.623674862305317*^9}, {
   3.623674916651785*^9, 3.623674970902945*^9}, {3.6236751075413218`*^9, 
   3.623675158002379*^9}, {3.6236752458303022`*^9, 3.623675324817501*^9}, {
   3.623675377010393*^9, 3.6236753889876127`*^9}, {3.623675998473529*^9, 
   3.623676000320026*^9}, 3.6236766097244043`*^9, 3.623677811314086*^9, {
   3.62396778035148*^9, 3.623967828663177*^9}, 3.6240269004520617`*^9, {
   3.6249091371530666`*^9, 3.6249093475116615`*^9}, {3.6249165738575664`*^9, 
   3.6249165860176687`*^9}, {3.6253361764845657`*^9, 
   3.6253362086934867`*^9}, {3.630432351173935*^9, 3.6304323689837503`*^9}, {
   3.630432407015001*^9, 3.6304324201767354`*^9}, {3.6307786150349216`*^9, 
   3.6307786497489333`*^9}, {3.6307788350504827`*^9, 3.6307789382184124`*^9}, 
   3.63077906629455*^9, {3.6307885786709757`*^9, 3.630788614817899*^9}, {
   3.630885307108532*^9, 3.630885317232403*^9}, {3.630885398238092*^9, 
   3.630885439647784*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["QUICKEST: \[Chi]\[Chi]\[Rule]VV\tV\[Rule]qq\[CloseCurlyQuote]", \
"Subsubsection",
 CellChangeTimes->{{3.6311292509988527`*^9, 3.6311292527132797`*^9}}],

Cell["\<\
Define \[OpenCurlyDoubleQuote]different quarks\[CloseCurlyDoubleQuote] \
version. nEfs = 20 seems to work well, valid to the 5th decimal.\
\>", "Text",
 CellChangeTimes->{{3.631129296601145*^9, 3.6311293003779993`*^9}, {
  3.6311344156825943`*^9, 3.631134441127283*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dqp2\[Phi]2gamquickest", "[", 
   RowBox[{
   "flavor1_", ",", " ", "flavor2_", ",", " ", "mchi_", ",", " ", "mphi_", 
    ",", "nEfs_", ",", " ", "photonenergy_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"m\[Chi]", " ", "=", " ", "mchi"}], ",", " ", 
      RowBox[{"m\[Phi]", " ", "=", " ", "mphi"}], ",", " ", 
      RowBox[{"e\[Gamma]", " ", "=", " ", "photonenergy"}], ",", " ", 
      "\[Gamma]", ",", " ", "\[Beta]", ",", " ", "Eq10", ",", " ", "Eq20", 
      ",", " ", "mq1", ",", " ", "mq2", ",", " ", "Eq1low", ",", " ", 
      "Eq1high", ",", " ", "Eq2low", ",", " ", "Eq2high", ",", " ", "norm1", 
      ",", " ", "norm2", ",", 
      RowBox[{"numEfs", "=", "nEfs"}], ",", "rangeEfs1", ",", "rangeEfs2"}], 
     "}"}], ",", " ", 
    RowBox[{
     RowBox[{"mq1", " ", "=", " ", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"flavor1", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", ",", 
        " ", 
        RowBox[{"flavor1", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",", 
        " ", 
        RowBox[{"flavor1", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",", 
        " ", 
        RowBox[{"flavor1", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
       "]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"heavy", " ", "quark", " ", "masses"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"mq2", " ", "=", " ", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"flavor2", "\[Equal]", "\"\<t\>\""}], ",", " ", "173.", ",", 
        " ", 
        RowBox[{"flavor2", "\[Equal]", "\"\<b\>\""}], ",", " ", "4.2", ",", 
        " ", 
        RowBox[{"flavor2", "\[Equal]", "\"\<c\>\""}], ",", " ", "1.2", ",", 
        " ", 
        RowBox[{"flavor2", "\[Equal]", "\"\<q\>\""}], ",", " ", "0.01"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]", " ", "=", " ", 
      FractionBox["m\[Chi]", "m\[Phi]"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Beta]", "=", 
      SqrtBox[
       RowBox[{"1", "-", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["m\[Phi]", "m\[Chi]"], ")"}], "2"]}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "the", " ", "energies", " ", "of", " ", "the", " ", "emitted", " ", 
       "particles", " ", "in", " ", "the", " ", "\[Phi]", " ", "rest", " ", 
       "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Eq10", " ", "=", " ", 
      RowBox[{
       FractionBox["m\[Phi]", "2"], "+", 
       FractionBox[
        RowBox[{
         SuperscriptBox["mq1", "2"], "-", 
         SuperscriptBox["mq2", "2"]}], 
        RowBox[{"2", " ", "m\[Phi]"}]]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Eq20", " ", "=", " ", 
      RowBox[{
       FractionBox["m\[Phi]", "2"], "+", 
       FractionBox[
        RowBox[{
         SuperscriptBox["mq2", "2"], "-", 
         SuperscriptBox["mq1", "2"]}], 
        RowBox[{"2", " ", "m\[Phi]"}]]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "the", " ", "min", " ", "and", " ", "max", " ", "energies", " ", "of", 
       " ", "the", " ", "emitted", " ", "particles", " ", "in", " ", "the", 
       " ", "lab", " ", "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Eq1low", "=", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{"(", 
        RowBox[{"Eq10", "-", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq10", "2"], "-", 
            SuperscriptBox["mq1", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Eq2low", " ", "=", " ", 
      RowBox[{"\[Gamma]", 
       RowBox[{"(", 
        RowBox[{"Eq20", "-", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq20", "2"], " ", "-", " ", 
            SuperscriptBox["mq2", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Eq1high", "=", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{"(", 
        RowBox[{"Eq10", "+", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq10", "2"], "-", 
            SuperscriptBox["mq1", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Eq2high", "=", 
      RowBox[{"\[Gamma]", " ", 
       RowBox[{"(", 
        RowBox[{"Eq20", "+", 
         RowBox[{"\[Beta]", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["Eq20", "2"], "-", 
            SuperscriptBox["mq2", "2"]}]]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"norm1", "=", " ", 
      FractionBox["1", 
       RowBox[{"\[Beta]", " ", "\[Gamma]", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["Eq10", "2"], "-", 
          SuperscriptBox["mq1", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norm2", " ", "=", " ", 
      FractionBox["1", 
       RowBox[{"\[Beta]", " ", "\[Gamma]", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["Eq20", "2"], "-", 
          SuperscriptBox["mq2", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"rangeEfs1", "=", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"Eq1low", "+", 
         FractionBox[
          RowBox[{"Eq1high", "-", "Eq1low"}], 
          RowBox[{"2", "numEfs"}]]}], ",", "Eq1high", ",", 
        FractionBox[
         RowBox[{"Eq1high", "-", "Eq1low"}], "numEfs"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rangeEfs2", "=", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"Eq2low", "+", 
         FractionBox[
          RowBox[{"Eq2high", "-", "Eq2low"}], 
          RowBox[{"2", "numEfs"}]]}], ",", "Eq2high", ",", 
        FractionBox[
         RowBox[{"Eq2high", "-", "Eq2low"}], "numEfs"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "output", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"0.5", " ", "norm1", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"NIntegrate", "[", 
            RowBox[{
             RowBox[{"p2gam", "[", 
              RowBox[{"flavor1", ",", " ", "Eq1", ",", " ", "e\[Gamma]"}], 
              "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"Eq1", ",", " ", "Eq1low", ",", " ", "Eq1high"}], "}"}],
              ",", " ", 
             RowBox[{"Method", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"Automatic", ",", " ", 
                RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
               "}"}]}]}], "]"}], "//", "Quiet"}], ")"}]}], "+", 
        RowBox[{"0.5", "norm2", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NIntegrate", "[", 
            RowBox[{
             RowBox[{"p2gam", "[", 
              RowBox[{"flavor2", ",", " ", "Eq2", ",", " ", "e\[Gamma]"}], 
              "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"Eq2", ",", " ", "Eq2low", ",", " ", "Eq2high"}], "}"}],
              ",", " ", 
             RowBox[{"Method", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"Automatic", ",", " ", 
                RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
               "}"}]}]}], "]"}], "//", "Quiet"}], ")"}]}]}], "]"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "discretize", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"0.5", " ", "norm1", " ", 
       FractionBox[
        RowBox[{"Eq1high", "-", "Eq1low"}], "numEfs"], 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"flavor1", ",", " ", "#", ",", " ", "e\[Gamma]"}], "]"}], 
          "&"}], "/@", "rangeEfs1"}], "]"}]}], "+", 
      RowBox[{"0.5", " ", "norm2", " ", 
       FractionBox[
        RowBox[{"Eq1high", "-", "Eq1low"}], "numEfs"], 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"flavor2", ",", " ", "#", ",", " ", "e\[Gamma]"}], "]"}], 
          "&"}], "/@", "rangeEfs2"}], "]"}]}]}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.63088772970508*^9, 3.63088773151052*^9}, {
   3.630889640041686*^9, 3.630889642322792*^9}, {3.631129291231078*^9, 
   3.631129328791984*^9}, {3.631130156921438*^9, 3.6311302095083227`*^9}, {
   3.631130242373953*^9, 3.6311303570457983`*^9}, 3.631130437440262*^9, {
   3.6311307815229607`*^9, 3.631130796919985*^9}, {3.631131121164805*^9, 
   3.631131121744513*^9}, {3.631131189615069*^9, 3.6311312710886383`*^9}, {
   3.6311313430855227`*^9, 3.631131352179364*^9}, {3.631131386995041*^9, 
   3.631131420545475*^9}, {3.6311314667582817`*^9, 3.63113147801018*^9}, {
   3.631131563785879*^9, 3.631131564739296*^9}, 3.631133842232085*^9, {
   3.631137444127973*^9, 3.6311374848898287`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fast Functions", "Subsection",
 CellChangeTimes->{{3.623680279080459*^9, 3.623680280470078*^9}}],

Cell["\<\
p2\[Phi]2gam takes a long time to plot and, on top of that, can be \
tempramental when making log plots. So we\[CloseCurlyQuote]ll follow our \
approach in HeavyHooperonPPPC.nb and create an interpolating function so that \
the PPPC functions don\[CloseCurlyQuote]t have to be called over and over \
again. (I believe this saves a lot of time since it doesn\[CloseCurlyQuote]t \
have to re-interpolate?) Either way, this has been shown to speed things up \
nicely. Points are spaced evernly on a log scale. I found that 100 points \
work well, Anthony found that fewer points are also ok.

minE and maxE is the range of photon energies over which \
we\[CloseCurlyQuote]d like to interpolate
numpoints is the number of points to sample, I use 100\
\>", "Text",
 CellChangeTimes->{{3.623680289543861*^9, 3.623680404267147*^9}, {
  3.623680560303238*^9, 3.623680584229577*^9}}],

Cell[CellGroupData[{

Cell["V \[Rule] qq: not so fast [not used]", "Subsubsection",
 CellChangeTimes->{{3.630885534726385*^9, 3.630885539036934*^9}, {
  3.63088823712138*^9, 3.630888241537084*^9}, {3.630888303230937*^9, 
  3.6308883068778133`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"p2\[Phi]2gamfast", "[", 
    RowBox[{
    "primary_", ",", "mchi_", ",", "mphi_", ",", "minE_", ",", "maxE_", ",", 
     "numpoints_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"prim", "=", "primary"}], ",", 
       RowBox[{"m\[Chi]", "=", "mchi"}], ",", 
       RowBox[{"m\[Phi]", "=", "mphi"}], ",", 
       RowBox[{"mine", "=", "minE"}], ",", 
       RowBox[{"maxe", "=", "maxE"}], ",", " ", "samplepoints"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"samplepoints", "=", 
       RowBox[{
        RowBox[{
         SuperscriptBox["10", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "minE"}], "]"}], ",", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "maxE"}], "]"}], ",", 
          FractionBox[
           RowBox[{
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "maxE"}], "]"}], "-", 
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Output", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Interpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{"p2\[Phi]2gam", "[", 
            RowBox[{"prim", ",", "m\[Chi]", ",", "m\[Phi]", ",", "#"}], 
            "]"}]}], "}"}], "&"}], "/@", "samplepoints"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"usage", ":", " ", "f"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"b2gamfast", "[", "...", "]"}], ".", " ", 
       RowBox[{"f", "[", 
        SubscriptBox["E", "\[Gamma]"], "]"}]}], " ", "gives", " ", "the", " ",
       "number", " ", "of", " ", "photons", " ", "with", " ", "E"}], "=", 
     RowBox[{
      SubscriptBox["E", "\[Gamma]"], "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "faster", " ", "version", " ", "that", " ", "uses", " ", 
     "p2\[Phi]2gamquick"}], ",", " ", 
    RowBox[{
     RowBox[{"defined", " ", "with", " ", "\"\<SymbolicProcessing\>\""}], 
     "\[Rule]", "0"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p2\[Phi]2gamfastest", "[", 
   RowBox[{
   "primary_", ",", "mchi_", ",", "mphi_", ",", "minE_", ",", "maxE_", ",", 
    "numpoints_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"prim", "=", "primary"}], ",", 
      RowBox[{"m\[Chi]", "=", "mchi"}], ",", 
      RowBox[{"m\[Phi]", "=", "mphi"}], ",", 
      RowBox[{"mine", "=", "minE"}], ",", 
      RowBox[{"maxe", "=", "maxE"}], ",", " ", "samplepoints"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"samplepoints", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox["10", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "minE"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "maxE"}], "]"}], ",", 
         FractionBox[
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "maxE"}], "]"}], "-", 
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Output", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"p2\[Phi]2gamquick", "[", 
           RowBox[{"prim", ",", "m\[Chi]", ",", "m\[Phi]", ",", "#"}], 
           "]"}]}], "}"}], "&"}], "/@", "samplepoints"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"usage", ":", " ", "f"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"b2gamfast", "[", "...", "]"}], ".", " ", 
       RowBox[{"f", "[", 
        SubscriptBox["E", "\[Gamma]"], "]"}]}], " ", "gives", " ", "the", " ",
       "number", " ", "of", " ", "photons", " ", "with", " ", "E"}], "=", 
     RowBox[{
      SubscriptBox["E", "\[Gamma]"], "."}]}]}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.6236805054442577`*^9, 3.623680553484131*^9}, {
  3.623680592861548*^9, 3.6236806232865562`*^9}, {3.6239678444162283`*^9, 
  3.623967870409203*^9}, {3.6239686157961884`*^9, 3.623968615947246*^9}, {
  3.6249093853139744`*^9, 3.6249096502131453`*^9}, {3.625848786893504*^9, 
  3.6258487885060177`*^9}, {3.6307789575119123`*^9, 3.6307789579963064`*^9}, {
  3.6307790164264946`*^9, 3.630779048972685*^9}, {3.630885544646627*^9, 
  3.630885545861128*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["V \[Rule] qq", "Subsubsection",
 CellChangeTimes->{{3.630885534726385*^9, 3.630885539036934*^9}}],

Cell["\<\
Redefine p2\[Phi]2gamfastest to use p2\[Phi]2gamquickest[primary_,m\[Chi]_,m\
\[Phi]_,nEfs_,photonE_]. I suggest nEfs = 20, this is the number of samplings \
for range of primary energies. 

Doing a quick test: for 80 GeV DM/20 GeV mediators, the \
\[OpenCurlyDoubleQuote]Swift\[CloseCurlyDoubleQuote] function is a little \
wobbly above 40 GeV if you only use nEfs=10. If you push to nEfs=20 it \
smooths out and is fairly close to the \[OpenCurlyDoubleQuote]fastest\
\[CloseCurlyDoubleQuote] function.\
\>", "Text",
 CellChangeTimes->{{3.6308883168788433`*^9, 3.630888377442769*^9}, {
  3.630888613433035*^9, 3.630888647305121*^9}, {3.6308888797363033`*^9, 
  3.630888943786025*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "faster", " ", "version", " ", "that", " ", "uses", " ", 
     "p2\[Phi]2gamquick"}], ",", " ", 
    RowBox[{
     RowBox[{"defined", " ", "with", " ", "\"\<SymbolicProcessing\>\""}], 
     "\[Rule]", "0"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"p2\[Phi]2gamSwift", "[", 
    RowBox[{
    "primary_", ",", "mchi_", ",", "mphi_", ",", "minE_", ",", "maxE_", ",", 
     "numpoints_", ",", "nEfs_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"prim", "=", "primary"}], ",", 
       RowBox[{"m\[Chi]", "=", "mchi"}], ",", 
       RowBox[{"m\[Phi]", "=", "mphi"}], ",", 
       RowBox[{"mine", "=", "minE"}], ",", 
       RowBox[{"maxe", "=", "maxE"}], ",", " ", "samplepoints", ",", 
       RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"samplepoints", "=", 
       RowBox[{
        RowBox[{
         SuperscriptBox["10", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "minE"}], "]"}], ",", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "maxE"}], "]"}], ",", 
          FractionBox[
           RowBox[{
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "maxE"}], "]"}], "-", 
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Output", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Interpolation", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"p2\[Phi]2gamquick", "[", 
             RowBox[{"prim", ",", "m\[Chi]", ",", "m\[Phi]", ",", "#"}], 
             "]"}]}], "}"}], "&"}], "/@", "samplepoints"}], "]"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Interpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{"p2\[Phi]2gamquickest", "[", 
            RowBox[{
            "prim", ",", "m\[Chi]", ",", "m\[Phi]", ",", "numEfs", ",", "#"}],
             "]"}]}], "}"}], "&"}], "/@", "samplepoints"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"usage", ":", " ", "f"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"b2gamfast", "[", "...", "]"}], ".", " ", 
        RowBox[{"f", "[", 
         SubscriptBox["E", "\[Gamma]"], "]"}]}], " ", "gives", " ", "the", 
       " ", "number", " ", "of", " ", "photons", " ", "with", " ", "E"}], "=", 
      RowBox[{
       SubscriptBox["E", "\[Gamma]"], "."}]}]}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.6236805054442577`*^9, 3.623680553484131*^9}, {
  3.623680592861548*^9, 3.6236806232865562`*^9}, {3.6239678444162283`*^9, 
  3.623967870409203*^9}, {3.6239686157961884`*^9, 3.623968615947246*^9}, {
  3.6249093853139744`*^9, 3.6249096502131453`*^9}, {3.625848786893504*^9, 
  3.6258487885060177`*^9}, {3.6307789575119123`*^9, 3.6307789579963064`*^9}, {
  3.6307790164264946`*^9, 3.630779048972685*^9}, {3.630885544646627*^9, 
  3.630885545861128*^9}, {3.6308882726366377`*^9, 3.6308882753876677`*^9}, {
  3.6308883821747923`*^9, 3.630888464327239*^9}, {3.63088850493381*^9, 
  3.630888539794635*^9}, {3.630888786415358*^9, 3.6308887878647623`*^9}, {
  3.630889597196385*^9, 3.6308896122936153`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["V \[Rule] qq\[CloseCurlyQuote]: not so fast [not used]", "Subsubsection",
 CellChangeTimes->{{3.630885547872951*^9, 3.630885553051025*^9}, {
  3.63113492707271*^9, 3.631134930095367*^9}, {3.631134969898059*^9, 
  3.6311349707519693`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"diffquarkstogammafast", "[", 
    RowBox[{
    "flavor1_", ",", " ", "flavor2_", ",", " ", "mchi_", ",", " ", "mphi_", 
     ",", " ", "minE_", ",", " ", "maxE_", ",", " ", "numpoints_"}], "]"}], 
   " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"prim1", " ", "=", " ", "flavor1"}], ",", " ", 
       RowBox[{"prim2", "=", "flavor2"}], ",", " ", 
       RowBox[{"m\[Chi]", "=", "mchi"}], ",", " ", 
       RowBox[{"m\[Phi]", "=", "mphi"}], ",", " ", 
       RowBox[{"mine", "=", "minE"}], ",", " ", 
       RowBox[{"maxe", "=", "maxE"}], ",", " ", "samplepoints"}], "}"}], ",", 
     " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"samplepoints", "=", 
       RowBox[{
        RowBox[{
         SuperscriptBox["10", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "minE"}], "]"}], ",", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "maxE"}], "]"}], ",", 
          FractionBox[
           RowBox[{
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "maxE"}], "]"}], "-", 
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Output", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Interpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{"diffquarkstogammafull", "[", 
            RowBox[{
            "prim1", ",", " ", "prim2", ",", "m\[Chi]", ",", "m\[Phi]", ",", 
             "#"}], "]"}]}], "}"}], "&"}], "/@", "samplepoints"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"usage", ":", " ", "f"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"b2gamfast", "[", "...", "]"}], ".", " ", 
       RowBox[{"f", "[", 
        SubscriptBox["E", "\[Gamma]"], "]"}]}], " ", "gives", " ", "the", " ",
       "number", " ", "of", " ", "photons", " ", "with", " ", "E"}], "=", 
     RowBox[{
      SubscriptBox["E", "\[Gamma]"], "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"diffquarkstogammafastest", "[", 
   RowBox[{
   "flavor1_", ",", " ", "flavor2_", ",", " ", "mchi_", ",", " ", "mphi_", 
    ",", " ", "minE_", ",", " ", "maxE_", ",", " ", "numpoints_"}], "]"}], 
  " ", ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"prim1", " ", "=", " ", "flavor1"}], ",", " ", 
      RowBox[{"prim2", "=", "flavor2"}], ",", " ", 
      RowBox[{"m\[Chi]", "=", "mchi"}], ",", " ", 
      RowBox[{"m\[Phi]", "=", "mphi"}], ",", " ", 
      RowBox[{"mine", "=", "minE"}], ",", " ", 
      RowBox[{"maxe", "=", "maxE"}], ",", " ", "samplepoints"}], "}"}], ",", 
    " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"samplepoints", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox["10", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "minE"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "maxE"}], "]"}], ",", 
         FractionBox[
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "maxE"}], "]"}], "-", 
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Output", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"diffquarkstogammaquick", "[", 
           RowBox[{
           "prim1", ",", " ", "prim2", ",", "m\[Chi]", ",", "m\[Phi]", ",", 
            "#"}], "]"}]}], "}"}], "&"}], "/@", "samplepoints"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"usage", ":", " ", "f"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"b2gamfast", "[", "...", "]"}], ".", " ", 
       RowBox[{"f", "[", 
        SubscriptBox["E", "\[Gamma]"], "]"}]}], " ", "gives", " ", "the", " ",
       "number", " ", "of", " ", "photons", " ", "with", " ", "E"}], "=", 
     RowBox[{
      SubscriptBox["E", "\[Gamma]"], "."}]}]}], " ", "*)"}]}]}], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["V \[Rule] qq\[CloseCurlyQuote]", "Subsubsection",
 CellChangeTimes->{{3.631134975535079*^9, 3.631134985959881*^9}}],

Cell["\<\
This matches pretty well with the \[OpenCurlyQuote]fast\[CloseCurlyQuote] \
function but is 1000 times faster. Yes, 1000.\
\>", "Text",
 CellChangeTimes->{{3.6311354485412903`*^9, 3.63113545447318*^9}, {
  3.6311355325151052`*^9, 3.631135561378737*^9}, {3.631135623706441*^9, 
  3.6311356256125393`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dqp2\[Phi]2gamSwift", "[", 
   RowBox[{
   "flavor1_", ",", " ", "flavor2_", ",", " ", "mchi_", ",", " ", "mphi_", 
    ",", " ", "minE_", ",", " ", "maxE_", ",", " ", "numpoints_", ",", 
    "nEfs_"}], "]"}], " ", ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"prim1", " ", "=", " ", "flavor1"}], ",", " ", 
      RowBox[{"prim2", "=", "flavor2"}], ",", " ", 
      RowBox[{"m\[Chi]", "=", "mchi"}], ",", " ", 
      RowBox[{"m\[Phi]", "=", "mphi"}], ",", " ", 
      RowBox[{"mine", "=", "minE"}], ",", " ", 
      RowBox[{"maxe", "=", "maxE"}], ",", " ", "samplepoints", ",", 
      RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"samplepoints", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox["10", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "minE"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "maxE"}], "]"}], ",", 
         FractionBox[
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "maxE"}], "]"}], "-", 
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Output", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"dqp2\[Phi]2gamquickest", "[", 
           RowBox[{
           "prim1", ",", " ", "prim2", ",", "m\[Chi]", ",", "m\[Phi]", ",", 
            "numEfs", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
       "samplepoints"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"usage", ":", " ", "f"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"b2gamfast", "[", "...", "]"}], ".", " ", 
       RowBox[{"f", "[", 
        SubscriptBox["E", "\[Gamma]"], "]"}]}], " ", "gives", " ", "the", " ",
       "number", " ", "of", " ", "photons", " ", "with", " ", "E"}], "=", 
     RowBox[{
      SubscriptBox["E", "\[Gamma]"], "."}]}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.631135004490027*^9, 3.631135006091518*^9}, {
  3.631135056448926*^9, 3.631135064507077*^9}, {3.6311351895898848`*^9, 
  3.631135197897213*^9}}]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Boosted Spectra: 2-to-3", "Section",
 CellChangeTimes->{{3.6236812638670807`*^9, 3.6236812677950706`*^9}}],

Cell["\<\
This section is based on 2to3Amplitude.nb. Here we assume annihilation into \
three mediators is the dominant annihilation mode. We\[CloseCurlyQuote]ve \
worked out the amplitude and everything. See the other notebook for testing.\
\>", "Text",
 CellChangeTimes->{{3.623681300767972*^9, 3.623681351774147*^9}}],

Cell[CellGroupData[{

Cell["The Amplitude", "Subsection",
 CellChangeTimes->{{3.62368135393137*^9, 3.623681358206122*^9}}],

Cell[TextData[{
 "The amplitude is scaled by ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["g", "3"], TraditionalForm]]],
 ". Note that there\[CloseCurlyQuote]s a factor of 2 to account for C12 = \
C21, etc."
}], "Text",
 CellChangeTimes->{{3.623419004818684*^9, 3.623419006870452*^9}, {
  3.623420699022277*^9, 3.623420710157702*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"p", "[", 
   RowBox[{"Ei_", ",", "Mi_"}], "]"}], ":=", 
  SqrtBox[
   RowBox[{
    SuperscriptBox["Ei", "2"], "-", 
    SuperscriptBox["Mi", "2"]}]]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C12", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"E1", " ", "E2"}], " ", "-", 
   RowBox[{
    RowBox[{"p", "[", 
     RowBox[{"E1", ",", "M\[Phi]"}], "]"}], 
    RowBox[{"p", "[", 
     RowBox[{"E2", ",", "M\[Phi]"}], "]"}], " ", 
    "cos"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C13", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"2", "m", " ", "E1"}], " ", "-", " ", 
   SuperscriptBox["M\[Phi]", "2"], "-", 
   RowBox[{"C12", "[", 
    RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C23", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"2", "m", " ", "E2"}], "-", " ", 
   SuperscriptBox["M\[Phi]", "2"], "-", 
   RowBox[{"C12", "[", 
    RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D12", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["M\[Phi]", "2"], "-", 
     RowBox[{"2", " ", "m", " ", "E1"}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["M\[Phi]", "2"], "-", 
     RowBox[{"2", " ", "m", " ", "E2"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D13", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["M\[Phi]", "2"], "-", 
     RowBox[{"2", " ", "m", " ", "E1"}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["M\[Phi]", "2"], "-", 
     RowBox[{"2", " ", "m", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", "m"}], " ", "-", " ", "E1", " ", "-", " ", "E2"}], 
       ")"}]}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"D23", "[", 
    RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["M\[Phi]", "2"], "-", 
      RowBox[{"2", " ", "m", " ", "E2"}]}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["M\[Phi]", "2"], "-", 
      RowBox[{"2", " ", "m", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", "m"}], " ", "-", " ", "E1", " ", "-", " ", "E2"}], 
        ")"}]}]}], ")"}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"M", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "cos_", ",", "M\[Phi]_", ",", "m_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"(", 
     RowBox[{"2", "m"}], ")"}]}], " ", "2", 
   RowBox[{"(", 
    RowBox[{
     FractionBox[
      RowBox[{"C12", "[", 
       RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], "]"}], 
      RowBox[{"D12", "[", 
       RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], 
       "]"}]], "+", 
     FractionBox[
      RowBox[{"C13", "[", 
       RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], "]"}], 
      RowBox[{"D13", "[", 
       RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], 
       "]"}]], "+", 
     FractionBox[
      RowBox[{"C23", "[", 
       RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], "]"}], 
      RowBox[{"D23", "[", 
       RowBox[{"E1", ",", "E2", ",", "cos", ",", "M\[Phi]", ",", "m"}], 
       "]"}]]}], ")"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"times", " ", 
     SuperscriptBox["g", "3"]}], " ", "*)"}]}]}]}], "Input",
 CellChangeTimes->{{3.623095788999467*^9, 3.623095873831113*^9}, {
  3.62312437418355*^9, 3.623124394581603*^9}, {3.623124429214654*^9, 
  3.623124544691284*^9}, {3.62341900142675*^9, 3.623419002236438*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Kinematics notes, not used", "Subsection",
 CellChangeTimes->{{3.623681381718924*^9, 3.623681384253501*^9}}],

Cell[TextData[{
 "These correspond to acceptable of cosine theta. First, the range of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["E", "2"], TraditionalForm]]],
 " depends on the value of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["E", "1"], TraditionalForm]]],
 " and the CM energy 2m as follows:"
}], "Text",
 CellChangeTimes->{{3.623080831307267*^9, 3.623080849378997*^9}, {
  3.6230810599607553`*^9, 3.623081082983569*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   SuperscriptBox[
    SubscriptBox["E", "1"], "max"], "=", 
   RowBox[{
    FractionBox[
     RowBox[{"(", 
      RowBox[{"2", "m"}], ")"}], "2"], "-", 
    FractionBox[
     RowBox[{"3", 
      SuperscriptBox["M\[Phi]", "2"]}], 
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{"2", "m"}], ")"}]}]]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"let", " ", "\[Xi]", 
     RowBox[{"(", 
      RowBox[{"E1", ",", "E2", ",", "c\[Theta]"}], ")"}]}], "=", 
    RowBox[{"E1", "+", "E2", "+", 
     SqrtBox[
      RowBox[{
       SuperscriptBox["p1", "2"], "+", 
       SuperscriptBox["p2", "2"], "+", 
       RowBox[{"p1", " ", "p2", " ", "c\[Theta]"}], " ", "+", " ", 
       SuperscriptBox["M\[Phi]", "2"]}]]}]}], ",", "\[IndentingNewLine]", 
   RowBox[{
   "the", " ", "total", " ", "energy", " ", "of", " ", "the", " ", "final", 
    " ", "states"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"if", " ", "\[Xi]", 
     RowBox[{"(", 
      RowBox[{"E1", ",", "0", ",", 
       RowBox[{"-", "1"}]}], ")"}]}], " ", ">", " ", 
    RowBox[{"(", 
     RowBox[{"2", "m"}], ")"}]}], ",", " ", 
   RowBox[{
   "then", " ", "the", " ", "limits", " ", "are", " ", "the", " ", 
    "solutions", " ", "to"}]}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Xi]", 
    RowBox[{"(", 
     RowBox[{"E1", ",", "E2", ",", 
      RowBox[{"-", "1"}]}], ")"}]}], "=", 
   RowBox[{"2", "m"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"otherwise", ",", " ", 
   RowBox[{"the", " ", "limits", " ", "are", " ", "solutions", " ", "to"}]}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Xi]", 
   RowBox[{"(", 
    RowBox[{"E1", ",", "E2", ",", 
     RowBox[{"+", "1"}]}], ")"}]}], "=", 
  RowBox[{"2", "m"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Xi]", 
   RowBox[{"(", 
    RowBox[{"E1", ",", "E2", ",", 
     RowBox[{"-", "1"}]}], ")"}]}], "=", 
  RowBox[{"2", "m"}]}]}], "DisplayFormula",
 CellChangeTimes->{{3.623080859486372*^9, 3.6230810462425947`*^9}, 
   3.6230813284011583`*^9, {3.623088830652231*^9, 3.62308884502343*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Xi]", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "c\[Theta]_"}], "]"}], ":=", 
  RowBox[{"E1", "+", "E2", "+", 
   SqrtBox[
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E1", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}], ")"}], "+", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E2", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}], ")"}], "+", 
     RowBox[{"2", 
      SqrtBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["E1", "2"], "-", 
         SuperscriptBox["M\[Phi]", "2"]}], ")"}]], 
      SqrtBox[
       RowBox[{
        SuperscriptBox["E2", "2"], "-", 
        SuperscriptBox["M\[Phi]", "2"]}]], "c\[Theta]"}], " ", "+", 
     SuperscriptBox["M\[Phi]", "2"]}]]}]}]], "Input",
 CellChangeTimes->{{3.623081128896021*^9, 3.6230812227680807`*^9}, 
   3.6230863106959333`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Define some useful functions", "Subsection",
 CellChangeTimes->{{3.623089430320148*^9, 3.6230894352858257`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Etot", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "c\[Theta]_", ",", "M\[Phi]_"}], "]"}], ":=", 
  RowBox[{"E1", "+", "E2", "+", 
   SqrtBox[
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E1", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}], ")"}], "+", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E2", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}], ")"}], "+", 
     RowBox[{"2", 
      SqrtBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["E1", "2"], "-", 
         SuperscriptBox["M\[Phi]", "2"]}], ")"}]], 
      SqrtBox[
       RowBox[{
        SuperscriptBox["E2", "2"], "-", 
        SuperscriptBox["M\[Phi]", "2"]}]], "c\[Theta]"}], " ", "+", 
     SuperscriptBox["M\[Phi]", "2"]}]]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MaxE1", "[", 
   RowBox[{"m_", ",", "M\[Phi]_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    RowBox[{"2", " ", "m"}], "2"], "-", 
   FractionBox[
    RowBox[{"3", " ", 
     SuperscriptBox["M\[Phi]", "2"]}], 
    RowBox[{"2", " ", "2", "m"}]]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"IsCaseI", "[", 
   RowBox[{"E1_", ",", "m_", ",", "M\[Phi]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Etot", "[", 
    RowBox[{"E1", ",", "M\[Phi]", ",", 
     RowBox[{"-", "1"}], ",", "M\[Phi]"}], "]"}], ">", 
   RowBox[{"2", " ", "m"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MaxE2", "[", 
   RowBox[{"E1_", ",", "m_", ",", "M\[Phi]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"E2x", "/.", 
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Etot", "[", 
        RowBox[{"E1", ",", "E2x", ",", 
         RowBox[{"-", "1"}], ",", "M\[Phi]"}], "]"}], "\[Equal]", 
       RowBox[{"2", "m"}]}], ",", "E2x"}], "]"}]}], "//", 
   "Max"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MinE2", "[", 
    RowBox[{"E1_", ",", "m_", ",", "M\[Phi]_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"IsCaseI", "[", 
      RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"E2x", "/.", 
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Etot", "[", 
           RowBox[{"E1", ",", "E2x", ",", 
            RowBox[{"-", "1"}], ",", "M\[Phi]"}], "]"}], "\[Equal]", 
          RowBox[{"2", "m"}]}], ",", "E2x"}], "]"}]}], "//", "Min"}], 
     "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"E2x", "/.", 
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Etot", "[", 
           RowBox[{"E1", ",", "E2x", ",", 
            RowBox[{"+", "1"}], ",", "M\[Phi]"}], "]"}], "\[Equal]", 
          RowBox[{"2", "m"}]}], ",", "E2x"}], "]"}]}], "//", "Min"}]}], 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Amplitude", " ", "depends", " ", "on", " ", 
    RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", "which", " ", "is", " ", 
    "fixed", " ", "by", " ", "kinematics"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"costheta", "[", 
   RowBox[{"E1_", ",", "E2_", ",", "m_", ",", "M\[Phi]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", "m"}], "-", "E1", "-", "E2"}], ")"}], "2"], "-", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E1", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}], ")"}], "-", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E2", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}], ")"}], "-", 
     SuperscriptBox["M\[Phi]", "2"]}], ")"}], 
   FractionBox["1", 
    RowBox[{"2", " ", 
     SqrtBox[
      RowBox[{
       SuperscriptBox["E1", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}]], " ", 
     SqrtBox[
      RowBox[{
       SuperscriptBox["E2", "2"], "-", 
       SuperscriptBox["M\[Phi]", "2"]}]]}]]}]}]}], "Input",
 CellChangeTimes->{{3.6230894375868797`*^9, 3.623089456956518*^9}, {
   3.623090426554796*^9, 3.623090428478204*^9}, {3.623093247380686*^9, 
   3.623093318991068*^9}, {3.623093356719802*^9, 3.623093401775467*^9}, {
   3.623093927543741*^9, 3.623094010062828*^9}, {3.623420427621911*^9, 
   3.623420529406431*^9}, 3.623420577497305*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Do Momentum Integral", "Subsection",
 CellChangeTimes->{{3.623419828719371*^9, 3.6234198525163*^9}, 
   3.623421140936594*^9}],

Cell["\<\
Factor of 3 coming from the multiplicity of final states. Note that this is \
NOT dN/dE, this is d<sigma v> / dE.

Symbolic Processing ->0 trick: \
http://mathematica.stackexchange.com/questions/8768/methods-to-speed-up-\
numerical-ndsolve-nintegrate\
\>", "Text",
 CellChangeTimes->{{3.623420783335047*^9, 3.623420791903078*^9}, {
  3.6235168743229733`*^9, 3.623516885195511*^9}, {3.6236814542992697`*^9, 
  3.623681454675414*^9}, {3.623964939180216*^9, 3.6239649450839577`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"d\[Sigma]vdE", "[", 
    RowBox[{"E1_", ",", "m_", ",", "M\[Phi]_"}], "]"}], ":=", 
   RowBox[{"3", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"M", "[", 
        RowBox[{"E1", ",", "E2", ",", 
         RowBox[{"costheta", "[", 
          RowBox[{"E1", ",", "E2", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
         "M\[Phi]", ",", "m"}], "]"}], "2"], ",", 
      RowBox[{"{", 
       RowBox[{"E2", ",", 
        RowBox[{"MinE2", "[", 
         RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
        RowBox[{"MaxE2", "[", 
         RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}]}], "}"}]}], 
     "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "slightly", " ", "faster", " ", "if", " ", "I", " ", "use", " ", 
     "SymbolicProcessing"}], " ", "\[Rule]", " ", "0"}], "  ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d\[Sigma]vdEfast", "[", 
   RowBox[{"E1_", ",", "m_", ",", "M\[Phi]_"}], "]"}], ":=", 
  RowBox[{"3", 
   RowBox[{"NIntegrate", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"M", "[", 
       RowBox[{"E1", ",", "E2", ",", 
        RowBox[{"costheta", "[", 
         RowBox[{"E1", ",", "E2", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
        "M\[Phi]", ",", "m"}], "]"}], "2"], ",", 
     RowBox[{"{", 
      RowBox[{"E2", ",", 
       RowBox[{"MinE2", "[", 
        RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
       RowBox[{"MaxE2", "[", 
        RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}]}], "}"}], ",", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Automatic", ",", 
        RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}]}], 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.623420406616745*^9, 3.6234204082003403`*^9}, {
  3.623420586543908*^9, 3.6234206580602627`*^9}, {3.6234207218766937`*^9, 
  3.623420780865638*^9}, {3.623681444286552*^9, 3.6236814469349527`*^9}, {
  3.62396491969209*^9, 3.623964932724676*^9}}],

Cell[CellGroupData[{

Cell["\<\
Introduce discretized sum vs. integral... only a factor of 2 in speed (not \
used)\
\>", "Subsubsection",
 CellChangeTimes->{{3.63094175262687*^9, 3.6309417659916983`*^9}, {
  3.630942180746254*^9, 3.630942186574245*^9}, {3.630943624528154*^9, 
  3.630943636474288*^9}}],

Cell["\<\
I tried numE2 = 10 for discretization. I\[CloseCurlyQuote]m only looking for \
percent accuracy. At around numE2 = 30 the computation time is the same. For \
numE2 = 5 the accuracy is still percent level but the gain is only about a \
factor of 2 in speed. Even a numE2 = 3 is reasonable. 

It\[CloseCurlyQuote]s not clear that this increase by a factor of 2 buys much \
in terms of overall speed.\
\>", "Text",
 CellChangeTimes->{{3.630941779835682*^9, 3.630941792285081*^9}, {
  3.630942076133128*^9, 3.630942133579156*^9}, {3.630942170447619*^9, 
  3.6309422177088327`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"d\[Sigma]vdEfastest", "[", 
   RowBox[{"En1_", ",", "mDM_", ",", "Mmed_", ",", "nE2_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"E1", "=", "En1"}], ",", 
      RowBox[{"m", "=", "mDM"}], ",", 
      RowBox[{"M\[Phi]", "=", "Mmed"}], ",", 
      RowBox[{"numE2", "=", "nE2"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"E2Lo", "=", 
      RowBox[{"MinE2", "[", 
       RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E2Hi", "=", 
      RowBox[{"MaxE2", "[", 
       RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rangeE2", "=", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"E2Lo", "+", 
         FractionBox[
          RowBox[{"E2Hi", "-", "E2Lo"}], 
          RowBox[{"2", "numE2"}]]}], ",", "E2Hi", ",", 
        FractionBox[
         RowBox[{"E2Hi", "-", "E2Lo"}], "numE2"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"3", 
       RowBox[{"NIntegrate", "[", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"M", "[", 
           RowBox[{"E1", ",", "E2", ",", 
            RowBox[{"costheta", "[", 
             RowBox[{"E1", ",", "E2", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
            "M\[Phi]", ",", "m"}], "]"}], "2"], ",", 
         RowBox[{"{", 
          RowBox[{"E2", ",", 
           RowBox[{"MinE2", "[", 
            RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}], ",", 
           RowBox[{"MaxE2", "[", 
            RowBox[{"E1", ",", "m", ",", "M\[Phi]"}], "]"}]}], "}"}], ",", 
         RowBox[{"Method", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Automatic", ",", 
            RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], 
           "}"}]}]}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"3", 
      FractionBox[
       RowBox[{"E2Hi", "-", "E2Lo"}], "numE2"], 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"M", "[", 
           RowBox[{"E1", ",", "#", ",", 
            RowBox[{"N", "[", 
             RowBox[{"costheta", "[", 
              RowBox[{"E1", ",", "#", ",", "m", ",", "M\[Phi]"}], "]"}], 
             "]"}], ",", "M\[Phi]", ",", "m"}], "]"}], "2"], "&"}], "/@", 
        "rangeE2"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.630941796058628*^9, 3.630941957655405*^9}, {
  3.630942017238044*^9, 3.630942019759322*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Doing the cross section integral: not used in p3\[Phi]2gam fast", \
"Subsection",
 CellChangeTimes->{{3.6236815427646103`*^9, 3.623681571821108*^9}, {
  3.624027061093442*^9, 3.624027083322267*^9}}],

Cell[TextData[{
 "The above plots are not normalized---we ultimately want dN/dE. We\
\[CloseCurlyQuote]ll need to integrate them to normalize. Note that it\
\[CloseCurlyQuote]s hard to directly NIntegrate dNdE because ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " gets confused by the symolic limits of the E2 integral. We fix this by \
defining a new function which only takes numbers. See: \
http://stackoverflow.com/questions/18903010/mathematica-wont-nintegrate-a-\
conditional-function"
}], "Text",
 CellChangeTimes->{{3.623681573149419*^9, 3.623681603047735*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d\[Sigma]vdEnum", "[", 
   RowBox[{
    RowBox[{"E1_", "?", "NumericQ"}], ",", 
    RowBox[{"m_", "?", "NumericQ"}], ",", 
    RowBox[{"M\[Phi]_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"d\[Sigma]vdE", "[", 
   RowBox[{"E1", ",", "m", ",", " ", "M\[Phi]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{"d\[Sigma]vdEnum", "[", 
       RowBox[{"x", ",", "120", ",", "45"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "45", ",", 
        RowBox[{"MaxE1", "[", 
         RowBox[{"120", ",", "45"}], "]"}]}], "}"}]}], "]"}], "//", 
    "Timing"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.623681618793066*^9, 3.6236816335148983`*^9}, {
  3.6240270124240417`*^9, 3.6240270137427797`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["The total spectrum: nice, but not used--too slow", "Subsection",
 CellChangeTimes->{{3.623716080365334*^9, 3.6237160880437613`*^9}, {
  3.624027069883377*^9, 3.624027073234893*^9}, {3.6309436569789467`*^9, 
  3.63094366060716*^9}}],

Cell["\<\
This might be a helpful tip: \
http://mathematica.stackexchange.com/questions/10533/nested-nintegrate

Nov 6 , the normalization is off: have to account for 3 final states. This \
info which is in d\[Sigma]vdEnum, but which is washed out when I normalized \
by Total\[Sigma]v. Then I have to account for the fact that the boxnorm is \
normalized to 2 final state mediators.\
\>", "Text",
 CellChangeTimes->{{3.623779025172448*^9, 3.623779029372677*^9}, {
  3.624322670078206*^9, 3.624322738819991*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"p3\[Phi]2gam", "[", 
   RowBox[{"primary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "photonE_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"finalstate", "=", "primary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", " ", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"e\[Gamma]", "=", "photonE"}], ",", "mSM", ",", " ", "\[Gamma]",
       ",", "\[Gamma]\[Beta]", ",", " ", "E0", ",", " ", "boxnorm", ",", " ", 
      "Total\[Sigma]v", ",", "Ephi", ",", "EfsHi", ",", "EfsLo", ",", 
      "InnerIntegrand", ",", "OuterIntegrand"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mSM", "=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"finalstate", "==", "\"\<t\>\""}], ",", " ", "173.", ",", " ", 
        RowBox[{"finalstate", "==", "\"\<b\>\""}], ",", " ", "4.2", ",", " ", 
        RowBox[{"finalstate", "==", "\"\<c\>\""}], ",", " ", "1.3", ",", " ", 
        RowBox[{"finalstate", "==", "\"\<q\>\""}], ",", " ", "0"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Gamma]", "[", "E\[Phi]_", "]"}], ":=", 
      FractionBox["E\[Phi]", "mphi"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Gamma]\[Beta]", "[", "E\[Phi]_", "]"}], ":=", 
      SqrtBox[
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["E\[Phi]", "mphi"], ")"}], "2"], "-", "1"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E0", "=", 
      RowBox[{"mphi", "/", "2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"boxnorm", "[", "E\[Phi]_", "]"}], ":=", 
      FractionBox["1", 
       RowBox[{"2", " ", 
        RowBox[{"(*", "normalize", "*)"}], 
        RowBox[{"\[Gamma]\[Beta]", "[", "E\[Phi]", "]"}], 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Total\[Sigma]v", "=", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"d\[Sigma]vdEnum", "[", 
         RowBox[{"Ephi", ",", "mchi", ",", "mphi"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Ephi", ",", "mphi", ",", 
          RowBox[{"MaxE1", "[", 
           RowBox[{"mchi", ",", "mphi"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"EfsHi", "[", "E\[Phi]_", "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Gamma]", "[", "E\[Phi]", "]"}], " ", "E0"}], "+", 
       RowBox[{
        RowBox[{"\[Gamma]\[Beta]", "[", "E\[Phi]", "]"}], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"EfsLo", "[", "E\[Phi]_", "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Gamma]", "[", "E\[Phi]", "]"}], " ", "E0"}], "-", 
       RowBox[{
        RowBox[{"\[Gamma]\[Beta]", "[", "E\[Phi]", "]"}], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mphi", "2"], ")"}], "2"], "-", 
          SuperscriptBox["mSM", "2"]}]]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"InnerIntegrand", "[", 
       RowBox[{"Efs_", "?", "NumericQ"}], "]"}], ":=", 
      RowBox[{"p2gam", "[", 
       RowBox[{"finalstate", ",", "Efs", ",", "e\[Gamma]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"OuterIntegrand", "[", 
       RowBox[{"Ephi_", "?", "NumericQ"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"boxnorm", "[", "Ephi", "]"}], 
       RowBox[{"NIntegrate", "[", 
        RowBox[{
         RowBox[{"InnerIntegrand", "[", "Efs", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"Efs", ",", 
           RowBox[{"EfsLo", "[", "Ephi", "]"}], ",", 
           RowBox[{"EfsHi", "[", "Ephi", "]"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      FractionBox[
       RowBox[{"3", " ", 
        RowBox[{"(*", " ", "norm", " ", "*)"}]}], "Total\[Sigma]v"], 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"OuterIntegrand", "[", "Ephi", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Ephi", ",", "mphi", ",", 
          RowBox[{"MaxE1", "[", 
           RowBox[{"mchi", ",", "mphi"}], "]"}]}], "}"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"the", " ", "versions", " ", "below", " ", "work"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
       "but", " ", "they", " ", "give", " ", "a", " ", "bunch", " ", "of", 
        " ", "warnings"}], "..."}], " ", "they", " ", "end", " ", "up", " ", 
      "being", " ", "off", " ", "at", " ", "the", " ", "3", "rd", " ", 
      "decimal"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     FractionBox["1", "Total\[Sigma]v"], 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"boxnorm", "[", "Ephi", "]"}], " ", 
        RowBox[{"p2gam", "[", 
         RowBox[{"finalstate", ",", "Efs", ",", "e\[Gamma]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"Ephi", ",", "mphi", ",", 
         RowBox[{"MaxE1", "[", 
          RowBox[{"mchi", ",", "mphi"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Efs", ",", 
         RowBox[{"EfsLo", "[", "Ephi", "]"}], ",", 
         RowBox[{"EfsHi", "[", "Ephi", "]"}]}], "}"}]}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"real", " ", 
     RowBox[{"version", ":"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     FractionBox["1", "Total\[Sigma]v"], 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"boxnorm", "[", "Ephi", "]"}], 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"p2gam", "[", 
           RowBox[{"finalstate", ",", "Efs", ",", "e\[Gamma]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Efs", ",", 
            RowBox[{"EfsLo", "[", "Ephi", "]"}], ",", 
            RowBox[{"EfsHi", "[", "Ephi", "]"}]}], "}"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"Ephi", ",", "mphi", ",", 
         RowBox[{"MaxE1", "[", 
          RowBox[{"mchi", ",", "mphi"}], "]"}]}], "}"}]}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{
  3.6237170006271048`*^9, {3.6237766365466537`*^9, 3.623776638255574*^9}, {
   3.623776770542029*^9, 3.623776800645845*^9}, {3.623776864772244*^9, 
   3.623776922388423*^9}, {3.6237771628479967`*^9, 3.623777208125573*^9}, {
   3.623777256614217*^9, 3.6237774089699183`*^9}, {3.623777474107605*^9, 
   3.623777476738432*^9}, {3.623777511187936*^9, 3.62377752243019*^9}, {
   3.623777552954921*^9, 3.6237776091766453`*^9}, {3.623777704765044*^9, 
   3.6237777121464167`*^9}, {3.62377821085947*^9, 3.623778297336647*^9}, {
   3.6237783795046263`*^9, 3.623778390074174*^9}, {3.623778449813651*^9, 
   3.623778450002108*^9}, {3.623778621002922*^9, 3.623778660227364*^9}, {
   3.623778787512767*^9, 3.6237788199036093`*^9}, {3.623778856072042*^9, 
   3.623778886649527*^9}, {3.623854124189472*^9, 3.6238541621923018`*^9}, {
   3.623854262341601*^9, 3.623854436857683*^9}, {3.623854564450109*^9, 
   3.623854595315741*^9}, {3.624322741047739*^9, 3.624322756421295*^9}, {
   3.630779111575924*^9, 3.630779233263561*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["2 to 3 Faster", "Subsection",
 CellChangeTimes->{{3.623888601948258*^9, 3.623888603564258*^9}}],

Cell[TextData[{
 "First define a discrete version of p3\[Phi]2gam where we don\
\[CloseCurlyQuote]t need to calculate Total\[Sigma]v or do a full numerical \
integra over E\[Phi]. Further, we\[CloseCurlyQuote]ll just appeal to \
p2\[Phi]2gamFast. The idea is that p3\[Phi]2gam can be approximated as the \
weighted average of many p2\[Phi]2gam functions where m\[Chi] is varied to \
match E\[Phi].\n\nSome testing: n\[Phi]bins = 5 is too small, n\[Phi]bins=20 \
agrees to the third decimal for a reasonable test value. From previous tests, \
N\[Gamma] should be at least 50.\n\n\[OpenCurlyDoubleQuote]Combined\
\[CloseCurlyDoubleQuote] function allows for multiple final states with \
branching ratios given by a weights vector.\n",
 StyleBox["Note: ",
  FontWeight->"Bold"],
 "One way to make this even faster is to define a p2\[Phi]2gamquickest that \
samples instead of NIntegrates (yes, p2\[Phi]2gam). Update: I\
\[CloseCurlyQuote]ve now implemented this in the \[OpenCurlyDoubleQuote]Swift\
\[CloseCurlyDoubleQuote] function. Again, I suggest at least nEfs = 20 based \
on the behavior of the 2-to-2 case. "
}], "Text",
 CellChangeTimes->{{3.623888746570853*^9, 3.6238887884717617`*^9}, {
  3.623962321848598*^9, 3.623962380633354*^9}, {3.623966202536565*^9, 
  3.623966229877187*^9}, {3.62396878223431*^9, 3.623968791761251*^9}, {
  3.630852412145815*^9, 3.630852432580352*^9}, {3.630886374255258*^9, 
  3.6308863983191977`*^9}, {3.630889186588044*^9, 3.630889210523815*^9}}],

Cell[CellGroupData[{

Cell["p3\[Phi]2gamfaster [no longer used]", "Subsubsection",
 CellChangeTimes->{{3.630889148736603*^9, 3.6308891585812073`*^9}, {
   3.630889297120577*^9, 3.6308893004066267`*^9}, 3.630943674213532*^9}],

Cell["Takes around 45 seconds.", "Text",
 CellChangeTimes->{{3.630942994579133*^9, 3.630942999325687*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"p3\[Phi]2gamfaster", "[", 
   RowBox[{
   "SMprimary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "minE\[Gamma]_", ",", 
    "maxE\[Gamma]_", ",", "n\[Phi]bins_", ",", "n\[Gamma]bins_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"primary", "=", "SMprimary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Nphi", "=", "n\[Phi]bins"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", "mSM", ",", 
      "\[IndentingNewLine]", "minEphi", ",", "maxEphi", ",", 
      "\[CapitalDelta]E\[Phi]", ",", "E\[Phi]midpoints", ",", 
      "d\[Sigma]vdEsamples", ",", "total\[Sigma]v", ",", "WeightedSpectrum", 
      ",", "samplepoints"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Identify", " ", "points", " ", "to", " ", "sample", " ", "in", " ", 
      "E\[Phi]"}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mSM", "=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"primary", "==", "\"\<t\>\""}], ",", " ", "173.", ",", " ", 
        RowBox[{"primary", "==", "\"\<b\>\""}], ",", " ", "4.2", ",", " ", 
        RowBox[{"primary", "==", "\"\<c\>\""}], ",", " ", "1.3", ",", " ", 
        RowBox[{"primary", "==", "\"\<q\>\""}], ",", " ", "0"}], "]"}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"minEphi", "=", "m\[Phi]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"maxEphi", "=", 
      RowBox[{"MaxE1", "[", 
       RowBox[{"mchi", ",", "mphi"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]E\[Phi]", "=", 
      FractionBox[
       RowBox[{"maxEphi", "-", "minEphi"}], "Nphi"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E\[Phi]midpoints", "=", 
      RowBox[{
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "+", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "2"], "&"}], "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"minEphi", ",", "maxEphi", ",", "\[CapitalDelta]E\[Phi]"}], 
          "]"}], ",", "2", ",", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Sample", " ", 
        RowBox[{"d\[Sigma]v", "/", "dE"}]}], ",", " ", 
       RowBox[{
       "also", " ", "do", " ", "box", " ", "approximation", " ", "to", " ", 
        "intergal"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"d\[Sigma]vdEsamples", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"d\[Sigma]vdEfast", "[", 
           RowBox[{"#", ",", "mchi", ",", "mphi"}], "]"}]}], "}"}], "&"}], "/@",
        "E\[Phi]midpoints"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"total\[Sigma]v", "=", 
      RowBox[{"\[CapitalDelta]E\[Phi]", " ", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
         "d\[Sigma]vdEsamples"}], "]"}]}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "note", " ", "that", " ", "total\[Sigma]v", " ", "includes", " ", "the",
        " ", "factor", " ", "of", " ", "3", " ", "for", " ", "the", " ", "3", 
       "x2", " ", "final", " ", "state", " ", "SM", " ", "particles", " ", 
       RowBox[{"vs", ".", " ", "only"}], " ", "2", " ", "final", " ", "state",
        " ", "SM", " ", 
       RowBox[{"particles", ".", " ", "I"}], " ", "have", " ", "to", " ", 
       "multiply", " ", "by", " ", "3", " ", "again", " ", "down", " ", "the",
        " ", 
       RowBox[{"road", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"WeightedSpectrum", "[", "Egam_", "]"}], ":=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", 
             RowBox[{"(*", " ", 
              RowBox[{"3", "x2", " ", "final", " ", "particles"}], " ", 
              "*)"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], " ", "\[CapitalDelta]E\[Phi]"}],
             "total\[Sigma]v"], 
           FractionBox[
            RowBox[{"p2\[Phi]2gamquick", "[", 
             RowBox[{"primary", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "mphi", ",", "Egam"}], 
             "]"}], 
            RowBox[{"2", " ", 
             RowBox[{"(*", " ", 
              RowBox[{
              "because", " ", "p2\[Phi]2gam", " ", "is", " ", "normed", " ", 
               "to", " ", "2", " ", "mediators"}], " ", "*)"}]}]]}], ")"}], 
         "&"}], "/@", "d\[Sigma]vdEsamples"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"NB", ":", " ", 
       RowBox[{
       "one", " ", "way", " ", "to", " ", "make", " ", "this", " ", "even", 
        " ", "faster", " ", "is", " ", "to", " ", "define", " ", "a", " ", 
        "p2\[Phi]2gamquickest", " ", "that", " ", "samples", " ", "instead", 
        " ", "of", " ", "NIntegrates"}]}], " ", "*)"}], "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Identify", " ", "log", " ", "sampling", " ", "in", " ", "E\[Gamma]"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"samplepoints", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox["10", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "minEgam"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "maxEgam"}], "]"}], ",", 
         FractionBox[
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "maxEgam"}], "]"}], "-", 
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "minEgam"}], "]"}]}], "Ngam"]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Output", " ", "an", " ", "interpolated", " ", "function"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"WeightedSpectrum", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
       "samplepoints"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6239626540870037`*^9, 3.6239626830062923`*^9}, {
   3.62396272256785*^9, 3.6239627532813797`*^9}, {3.6239628280068502`*^9, 
   3.623962835369751*^9}, {3.623962875081612*^9, 3.6239629520508013`*^9}, {
   3.623963083889194*^9, 3.623963097409747*^9}, {3.623963156981248*^9, 
   3.623963178902687*^9}, {3.623963376036372*^9, 3.623963396431202*^9}, {
   3.623963576236308*^9, 3.623963601368923*^9}, {3.6239639628948593`*^9, 
   3.623964034698489*^9}, {3.623964403996807*^9, 3.623964464655717*^9}, {
   3.623965385200697*^9, 3.623965416914826*^9}, {3.623965553073406*^9, 
   3.623965587286686*^9}, {3.623965622970069*^9, 3.62396563940385*^9}, {
   3.623966179435309*^9, 3.623966182541675*^9}, {3.623966503425797*^9, 
   3.62396655637576*^9}, {3.623966617103036*^9, 3.623966862578979*^9}, {
   3.623968384162057*^9, 3.62396840135191*^9}, {3.623968708184505*^9, 
   3.623968774722851*^9}, {3.623968948399506*^9, 3.623968973883823*^9}, {
   3.623969017585524*^9, 3.623969018034133*^9}, {3.623969054084814*^9, 
   3.623969117628607*^9}, {3.6239691692106123`*^9, 3.623969169532675*^9}, {
   3.623969260447137*^9, 3.623969297259959*^9}, {3.62396934425561*^9, 
   3.623969345228611*^9}, {3.62397099779735*^9, 3.623971068247653*^9}, {
   3.623971176314334*^9, 3.623971183653945*^9}, {3.623971224808139*^9, 
   3.623971315705819*^9}, {3.6239713594453983`*^9, 3.6239713609483633`*^9}, {
   3.623971395072514*^9, 3.623971429543694*^9}, {3.623971495622859*^9, 
   3.623971497838367*^9}, {3.623971528044677*^9, 3.623971552544107*^9}, {
   3.6239715870729437`*^9, 3.623971588371134*^9}, {3.623971644286998*^9, 
   3.623971645197029*^9}, {3.623971690872521*^9, 3.6239716924720993`*^9}, {
   3.6239719344759893`*^9, 3.623971986852112*^9}, {3.623972032194909*^9, 
   3.6239720354971237`*^9}, 3.623972068679126*^9, {3.6239722054451*^9, 
   3.6239722238358173`*^9}, {3.623972264629776*^9, 3.6239722692676773`*^9}, {
   3.623972301988961*^9, 3.6239723035009212`*^9}, {3.623973176413185*^9, 
   3.623973241988571*^9}, {3.6239732789249573`*^9, 3.623973307980194*^9}, {
   3.623973493335875*^9, 3.623973494262554*^9}, {3.6243224433081837`*^9, 
   3.6243225221215153`*^9}, {3.6243226203284883`*^9, 
   3.6243226375793457`*^9}, {3.624326829052218*^9, 3.624326829269285*^9}, {
   3.6307792380810866`*^9, 3.630779293844313*^9}, {3.630942885045004*^9, 
   3.630942886323388*^9}, {3.6309429179819117`*^9, 3.630942924940934*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["p3\[Phi]2gamSwift using p2\[Phi]2gamquickest", "Subsubsection",
 CellChangeTimes->{{3.630889148736603*^9, 3.630889180621866*^9}}],

Cell[TextData[{
 "Comparison",
 StyleBox[" ",
  FontWeight->"Bold"],
 "to p3\[Phi]2gamfaster: Looks really good. Takes only 3 seconds where \
previous function took 45. The gain came from using p2\[Phi]2gamquick",
 StyleBox["est.",
  FontWeight->"Bold"],
 " A good fit: n\[Phi]bins = 30, n\[Gamma]bins = 100, nEfs=20. Can probably \
relax these a bit, but be sure to test against  p3\[Phi]2gamfaster with \
conservative numbers (which takes about a minute to run)."
}], "Text",
 CellChangeTimes->{{3.6308892885376043`*^9, 3.630889295362112*^9}, {
  3.630943074262177*^9, 3.630943112537203*^9}, {3.6309436849216022`*^9, 
  3.6309437535766582`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"p3\[Phi]2gamSwift", "[", 
   RowBox[{
   "SMprimary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "minE\[Gamma]_", ",", 
    "maxE\[Gamma]_", ",", "n\[Phi]bins_", ",", "n\[Gamma]bins_", ",", 
    "nEfs_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"primary", "=", "SMprimary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Nphi", "=", "n\[Phi]bins"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", "mSM", ",", 
      "\[IndentingNewLine]", "minEphi", ",", "maxEphi", ",", 
      "\[CapitalDelta]E\[Phi]", ",", "E\[Phi]midpoints", ",", 
      "d\[Sigma]vdEsamples", ",", "total\[Sigma]v", ",", "WeightedSpectrum", 
      ",", "samplepoints", ",", 
      RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Identify", " ", "points", " ", "to", " ", "sample", " ", "in", " ", 
      "E\[Phi]"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mSM", "=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"primary", "==", "\"\<t\>\""}], ",", " ", "173.", ",", " ", 
        RowBox[{"primary", "==", "\"\<b\>\""}], ",", " ", "4.2", ",", " ", 
        RowBox[{"primary", "==", "\"\<c\>\""}], ",", " ", "1.3", ",", " ", 
        RowBox[{"primary", "==", "\"\<q\>\""}], ",", " ", "0"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"minEphi", "=", "m\[Phi]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"maxEphi", "=", 
      RowBox[{"MaxE1", "[", 
       RowBox[{"mchi", ",", "mphi"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]E\[Phi]", "=", 
      FractionBox[
       RowBox[{"maxEphi", "-", "minEphi"}], "Nphi"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E\[Phi]midpoints", "=", 
      RowBox[{
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "+", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "2"], "&"}], "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"minEphi", ",", "maxEphi", ",", "\[CapitalDelta]E\[Phi]"}], 
          "]"}], ",", "2", ",", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Sample", " ", 
        RowBox[{"d\[Sigma]v", "/", "dE"}]}], ",", " ", 
       RowBox[{
       "also", " ", "do", " ", "box", " ", "approximation", " ", "to", " ", 
        "intergal"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"d\[Sigma]vdEsamples", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"d\[Sigma]vdEfast", "[", 
           RowBox[{"#", ",", "mchi", ",", "mphi"}], "]"}]}], "}"}], "&"}], "/@",
        "E\[Phi]midpoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "The", " ", "following", " ", "can", " ", "speed", " ", "things", " ", 
        "up", " ", "by", " ", "an", " ", "O", 
        RowBox[{"(", 
         RowBox[{"20", "%"}], ")"}], " ", "amount"}], ",", " ", 
       RowBox[{"not", " ", "really", " ", "worth", " ", "it"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"d\[Sigma]vdEsamples", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"d\[Sigma]vdEfastest", "[", 
             RowBox[{"#", ",", "mchi", ",", "mphi", ",", "2"}], "]"}]}], 
           "}"}], "&"}], "/@", "E\[Phi]midpoints"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"total\[Sigma]v", "=", 
      RowBox[{"\[CapitalDelta]E\[Phi]", " ", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
         "d\[Sigma]vdEsamples"}], "]"}]}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "note", " ", "that", " ", "total\[Sigma]v", " ", "includes", " ", "the",
        " ", "factor", " ", "of", " ", "3", " ", "for", " ", "the", " ", "3", 
       "x2", " ", "final", " ", "state", " ", "SM", " ", "particles", " ", 
       RowBox[{"vs", ".", " ", "only"}], " ", "2", " ", "final", " ", "state",
        " ", "SM", " ", 
       RowBox[{"particles", ".", " ", "I"}], " ", "have", " ", "to", " ", 
       "multiply", " ", "by", " ", "3", " ", "again", " ", "down", " ", "the",
        " ", 
       RowBox[{"road", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"WeightedSpectrum", "[", "Egam_", "]"}], ":=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", 
             RowBox[{"(*", " ", 
              RowBox[{"3", "x2", " ", "final", " ", "particles"}], " ", 
              "*)"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], " ", "\[CapitalDelta]E\[Phi]"}],
             "total\[Sigma]v"], 
           FractionBox[
            RowBox[{"p2\[Phi]2gamquickest", "[", 
             RowBox[{"primary", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "mphi", ",", "numEfs", 
              ",", "Egam"}], "]"}], 
            RowBox[{"2", " ", 
             RowBox[{"(*", " ", 
              RowBox[{
              "because", " ", "p2\[Phi]2gam", " ", "is", " ", "normed", " ", 
               "to", " ", "2", " ", "mediators"}], " ", "*)"}]}]]}], ")"}], 
         "&"}], "/@", "d\[Sigma]vdEsamples"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"NB", ":", " ", 
       RowBox[{
       "one", " ", "way", " ", "to", " ", "make", " ", "this", " ", "even", 
        " ", "faster", " ", "is", " ", "to", " ", "define", " ", "a", " ", 
        "p2\[Phi]2gamquickest", " ", "that", " ", "samples", " ", "instead", 
        " ", "of", " ", "NIntegrates"}]}], " ", "*)"}], "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Identify", " ", "log", " ", "sampling", " ", "in", " ", "E\[Gamma]"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"samplepoints", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox["10", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "minEgam"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "maxEgam"}], "]"}], ",", 
         FractionBox[
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "maxEgam"}], "]"}], "-", 
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "minEgam"}], "]"}]}], "Ngam"]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Output", " ", "an", " ", "interpolated", " ", "function"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"WeightedSpectrum", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
       "samplepoints"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6239626540870037`*^9, 3.6239626830062923`*^9}, {
   3.62396272256785*^9, 3.6239627532813797`*^9}, {3.6239628280068502`*^9, 
   3.623962835369751*^9}, {3.623962875081612*^9, 3.6239629520508013`*^9}, {
   3.623963083889194*^9, 3.623963097409747*^9}, {3.623963156981248*^9, 
   3.623963178902687*^9}, {3.623963376036372*^9, 3.623963396431202*^9}, {
   3.623963576236308*^9, 3.623963601368923*^9}, {3.6239639628948593`*^9, 
   3.623964034698489*^9}, {3.623964403996807*^9, 3.623964464655717*^9}, {
   3.623965385200697*^9, 3.623965416914826*^9}, {3.623965553073406*^9, 
   3.623965587286686*^9}, {3.623965622970069*^9, 3.62396563940385*^9}, {
   3.623966179435309*^9, 3.623966182541675*^9}, {3.623966503425797*^9, 
   3.62396655637576*^9}, {3.623966617103036*^9, 3.623966862578979*^9}, {
   3.623968384162057*^9, 3.62396840135191*^9}, {3.623968708184505*^9, 
   3.623968774722851*^9}, {3.623968948399506*^9, 3.623968973883823*^9}, {
   3.623969017585524*^9, 3.623969018034133*^9}, {3.623969054084814*^9, 
   3.623969117628607*^9}, {3.6239691692106123`*^9, 3.623969169532675*^9}, {
   3.623969260447137*^9, 3.623969297259959*^9}, {3.62396934425561*^9, 
   3.623969345228611*^9}, {3.62397099779735*^9, 3.623971068247653*^9}, {
   3.623971176314334*^9, 3.623971183653945*^9}, {3.623971224808139*^9, 
   3.623971315705819*^9}, {3.6239713594453983`*^9, 3.6239713609483633`*^9}, {
   3.623971395072514*^9, 3.623971429543694*^9}, {3.623971495622859*^9, 
   3.623971497838367*^9}, {3.623971528044677*^9, 3.623971552544107*^9}, {
   3.6239715870729437`*^9, 3.623971588371134*^9}, {3.623971644286998*^9, 
   3.623971645197029*^9}, {3.623971690872521*^9, 3.6239716924720993`*^9}, {
   3.6239719344759893`*^9, 3.623971986852112*^9}, {3.623972032194909*^9, 
   3.6239720354971237`*^9}, 3.623972068679126*^9, {3.6239722054451*^9, 
   3.6239722238358173`*^9}, {3.623972264629776*^9, 3.6239722692676773`*^9}, {
   3.623972301988961*^9, 3.6239723035009212`*^9}, {3.623973176413185*^9, 
   3.623973241988571*^9}, {3.6239732789249573`*^9, 3.623973307980194*^9}, {
   3.623973493335875*^9, 3.623973494262554*^9}, {3.6243224433081837`*^9, 
   3.6243225221215153`*^9}, {3.6243226203284883`*^9, 
   3.6243226375793457`*^9}, {3.624326829052218*^9, 3.624326829269285*^9}, {
   3.6307792380810866`*^9, 3.630779293844313*^9}, {3.6308892235717*^9, 
   3.63088926873983*^9}, {3.6309430105264273`*^9, 3.6309430142759953`*^9}, {
   3.630943119218238*^9, 3.630943132540188*^9}, {3.630943176071507*^9, 
   3.630943186623765*^9}, {3.630943243146171*^9, 3.630943258424893*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["dqp3\[Phi]2gamSwift", "Subsubsection",
 CellChangeTimes->{{3.631136228575316*^9, 3.631136243896534*^9}}],

Cell["\<\
Checked against p3\[Phi]2gamSwift when the primaries are set to be the same.\
\>", "Text",
 CellChangeTimes->{{3.631137632100527*^9, 3.631137655778912*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dqp3\[Phi]2gamSwift", "[", 
   RowBox[{
   "SMprimary1_", ",", "SMprimary2_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", 
    "minE\[Gamma]_", ",", "maxE\[Gamma]_", ",", "n\[Phi]bins_", ",", 
    "n\[Gamma]bins_", ",", "nEfs_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"primary1", "=", "SMprimary1"}], ",", 
      RowBox[{"primary2", "=", "SMprimary2"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Nphi", "=", "n\[Phi]bins"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", "\[IndentingNewLine]", 
      "minEphi", ",", "maxEphi", ",", "\[CapitalDelta]E\[Phi]", ",", 
      "E\[Phi]midpoints", ",", "d\[Sigma]vdEsamples", ",", "total\[Sigma]v", 
      ",", "WeightedSpectrum", ",", "samplepoints", ",", 
      RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Identify", " ", "points", " ", "to", " ", "sample", " ", "in", " ", 
      "E\[Phi]"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"minEphi", "=", "m\[Phi]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"maxEphi", "=", 
      RowBox[{"MaxE1", "[", 
       RowBox[{"mchi", ",", "mphi"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]E\[Phi]", "=", 
      FractionBox[
       RowBox[{"maxEphi", "-", "minEphi"}], "Nphi"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"E\[Phi]midpoints", "=", 
      RowBox[{
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "+", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "2"], "&"}], "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"minEphi", ",", "maxEphi", ",", "\[CapitalDelta]E\[Phi]"}], 
          "]"}], ",", "2", ",", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Sample", " ", 
        RowBox[{"d\[Sigma]v", "/", "dE"}]}], ",", " ", 
       RowBox[{
       "also", " ", "do", " ", "box", " ", "approximation", " ", "to", " ", 
        "intergal"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"d\[Sigma]vdEsamples", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"d\[Sigma]vdEfast", "[", 
           RowBox[{"#", ",", "mchi", ",", "mphi"}], "]"}]}], "}"}], "&"}], "/@",
        "E\[Phi]midpoints"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "The", " ", "following", " ", "can", " ", "speed", " ", "things", " ", 
        "up", " ", "by", " ", "an", " ", "O", 
        RowBox[{"(", 
         RowBox[{"20", "%"}], ")"}], " ", "amount"}], ",", " ", 
       RowBox[{"not", " ", "really", " ", "worth", " ", "it"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"d\[Sigma]vdEsamples", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"d\[Sigma]vdEfastest", "[", 
             RowBox[{"#", ",", "mchi", ",", "mphi", ",", "2"}], "]"}]}], 
           "}"}], "&"}], "/@", "E\[Phi]midpoints"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"total\[Sigma]v", "=", 
      RowBox[{"\[CapitalDelta]E\[Phi]", " ", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
         "d\[Sigma]vdEsamples"}], "]"}]}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "note", " ", "that", " ", "total\[Sigma]v", " ", "includes", " ", "the",
        " ", "factor", " ", "of", " ", "3", " ", "for", " ", "the", " ", "3", 
       "x2", " ", "final", " ", "state", " ", "SM", " ", "particles", " ", 
       RowBox[{"vs", ".", " ", "only"}], " ", "2", " ", "final", " ", "state",
        " ", "SM", " ", 
       RowBox[{"particles", ".", " ", "I"}], " ", "have", " ", "to", " ", 
       "multiply", " ", "by", " ", "3", " ", "again", " ", "down", " ", "the",
        " ", 
       RowBox[{"road", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"WeightedSpectrum", "[", "Egam_", "]"}], ":=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", 
             RowBox[{"(*", " ", 
              RowBox[{"3", "x2", " ", "final", " ", "particles"}], " ", 
              "*)"}], " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], " ", "\[CapitalDelta]E\[Phi]"}],
             "total\[Sigma]v"], 
           FractionBox[
            RowBox[{"dqp2\[Phi]2gamquickest", "[", 
             RowBox[{"primary1", ",", "primary2", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "mphi", ",", "numEfs", 
              ",", "Egam"}], "]"}], 
            RowBox[{"2", " ", 
             RowBox[{"(*", " ", 
              RowBox[{
              "because", " ", "p2\[Phi]2gam", " ", "is", " ", "normed", " ", 
               "to", " ", "2", " ", "mediators"}], " ", "*)"}]}]]}], ")"}], 
         "&"}], "/@", "d\[Sigma]vdEsamples"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"NB", ":", " ", 
       RowBox[{
       "one", " ", "way", " ", "to", " ", "make", " ", "this", " ", "even", 
        " ", "faster", " ", "is", " ", "to", " ", "define", " ", "a", " ", 
        "p2\[Phi]2gamquickest", " ", "that", " ", "samples", " ", "instead", 
        " ", "of", " ", "NIntegrates"}]}], " ", "*)"}], "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Identify", " ", "log", " ", "sampling", " ", "in", " ", "E\[Gamma]"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"samplepoints", "=", 
      RowBox[{
       RowBox[{
        SuperscriptBox["10", "#"], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "minEgam"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", "maxEgam"}], "]"}], ",", 
         FractionBox[
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "maxEgam"}], "]"}], "-", 
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", "minEgam"}], "]"}]}], "Ngam"]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Output", " ", "an", " ", "interpolated", " ", "function"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"WeightedSpectrum", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
       "samplepoints"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6239626540870037`*^9, 3.6239626830062923`*^9}, {
   3.62396272256785*^9, 3.6239627532813797`*^9}, {3.6239628280068502`*^9, 
   3.623962835369751*^9}, {3.623962875081612*^9, 3.6239629520508013`*^9}, {
   3.623963083889194*^9, 3.623963097409747*^9}, {3.623963156981248*^9, 
   3.623963178902687*^9}, {3.623963376036372*^9, 3.623963396431202*^9}, {
   3.623963576236308*^9, 3.623963601368923*^9}, {3.6239639628948593`*^9, 
   3.623964034698489*^9}, {3.623964403996807*^9, 3.623964464655717*^9}, {
   3.623965385200697*^9, 3.623965416914826*^9}, {3.623965553073406*^9, 
   3.623965587286686*^9}, {3.623965622970069*^9, 3.62396563940385*^9}, {
   3.623966179435309*^9, 3.623966182541675*^9}, {3.623966503425797*^9, 
   3.62396655637576*^9}, {3.623966617103036*^9, 3.623966862578979*^9}, {
   3.623968384162057*^9, 3.62396840135191*^9}, {3.623968708184505*^9, 
   3.623968774722851*^9}, {3.623968948399506*^9, 3.623968973883823*^9}, {
   3.623969017585524*^9, 3.623969018034133*^9}, {3.623969054084814*^9, 
   3.623969117628607*^9}, {3.6239691692106123`*^9, 3.623969169532675*^9}, {
   3.623969260447137*^9, 3.623969297259959*^9}, {3.62396934425561*^9, 
   3.623969345228611*^9}, {3.62397099779735*^9, 3.623971068247653*^9}, {
   3.623971176314334*^9, 3.623971183653945*^9}, {3.623971224808139*^9, 
   3.623971315705819*^9}, {3.6239713594453983`*^9, 3.6239713609483633`*^9}, {
   3.623971395072514*^9, 3.623971429543694*^9}, {3.623971495622859*^9, 
   3.623971497838367*^9}, {3.623971528044677*^9, 3.623971552544107*^9}, {
   3.6239715870729437`*^9, 3.623971588371134*^9}, {3.623971644286998*^9, 
   3.623971645197029*^9}, {3.623971690872521*^9, 3.6239716924720993`*^9}, {
   3.6239719344759893`*^9, 3.623971986852112*^9}, {3.623972032194909*^9, 
   3.6239720354971237`*^9}, 3.623972068679126*^9, {3.6239722054451*^9, 
   3.6239722238358173`*^9}, {3.623972264629776*^9, 3.6239722692676773`*^9}, {
   3.623972301988961*^9, 3.6239723035009212`*^9}, {3.623973176413185*^9, 
   3.623973241988571*^9}, {3.6239732789249573`*^9, 3.623973307980194*^9}, {
   3.623973493335875*^9, 3.623973494262554*^9}, {3.6243224433081837`*^9, 
   3.6243225221215153`*^9}, {3.6243226203284883`*^9, 
   3.6243226375793457`*^9}, {3.624326829052218*^9, 3.624326829269285*^9}, {
   3.6307792380810866`*^9, 3.630779293844313*^9}, {3.6308892235717*^9, 
   3.63088926873983*^9}, {3.6309430105264273`*^9, 3.6309430142759953`*^9}, {
   3.630943119218238*^9, 3.630943132540188*^9}, {3.630943176071507*^9, 
   3.630943186623765*^9}, {3.630943243146171*^9, 3.630943258424893*^9}, {
   3.63113691228082*^9, 3.631136944774152*^9}, {3.6311369766931562`*^9, 
   3.631136982359991*^9}, 3.6311370725669413`*^9, {3.631137122377248*^9, 
   3.631137133597856*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["DC\[CloseCurlyQuote]s SaveIt and ReadIt functions", "Section",
 CellChangeTimes->{{3.624114966901318*^9, 3.624114970844288*^9}}],

Cell[TextData[{
 "http://www.terpconnect.umd.edu/%7Edcurtin1/mathematica.html\nSee also \
DumpSave, \
http://mathematica.stackexchange.com/questions/1959/how-do-i-save-a-variable-\
or-function-definition-to-a-file\n... but DC says this carries the risk of \
overwriting things because ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " saves the initial variable assignment, not just the object itself.\n\n\
Functions courtesy of David Curtin."
}], "Text",
 CellChangeTimes->{
  3.6241149895607758`*^9, {3.6308608127089443`*^9, 3.630860817491064*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"to", " ", "avoid", " ", "memory", " ", "bloat"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearMemory", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{"Unprotect", "[", 
         RowBox[{"In", ",", "Out"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{"In", ",", "Out"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Protect", "[", 
         RowBox[{"In", ",", "Out"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ClearSystemCache", "[", "]"}], ";"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SaveIt", "[", 
      RowBox[{"filename_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "output", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"Export", "[", 
          RowBox[{
           RowBox[{"filename", "<>", "\"\<.dat\>\""}], ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"expr", "//", "InputForm"}], "]"}], ",", 
           "\"\<String\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
        "ClearMemory", ";", "\[IndentingNewLine]", "output"}]}], "]"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SaveIt", "[", "varnamestring_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "output", "}"}], ",", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"Export", "[", 
          RowBox[{
           RowBox[{"varnamestring", "<>", "\"\<.dat\>\""}], ",", 
           RowBox[{"ToString", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", "varnamestring", "]"}], "//", 
             "InputForm"}], "]"}], ",", "\"\<String\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", "ClearMemory", ";", "\[IndentingNewLine]", 
        "output"}]}], "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ReadIt", "[", "filename_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "output", "}"}], ",", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"ToExpression", "[", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"StringReplace", "[", 
              RowBox[{"filename", ",", 
               RowBox[{"\"\<.dat\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], 
             "<>", "\"\<.dat\>\""}], ",", "\"\<String\>\""}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "ClearMemory", ";", "\[IndentingNewLine]",
         "output"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.6254118055510664`*^9, 3.625411933217869*^9}, {
   3.625412110964512*^9, 3.625412142848851*^9}, {3.625412244602681*^9, 
   3.62541225044716*^9}, {3.625412440651064*^9, 3.6254124613137474`*^9}, {
   3.625414004674595*^9, 3.6254140692788544`*^9}, {3.6254141944552183`*^9, 
   3.6254142177045617`*^9}, {3.62541433888583*^9, 3.625414403158327*^9}, {
   3.6254144791533613`*^9, 3.6254144820120764`*^9}, {3.625414674864777*^9, 
   3.625414698787961*^9}, {3.62541475347532*^9, 3.625414757251891*^9}, {
   3.625414805354452*^9, 3.625414807339139*^9}, {3.6254151674699607`*^9, 
   3.6254152403346477`*^9}, {3.6254152991485195`*^9, 3.625415302049885*^9}, {
   3.6254155152274413`*^9, 3.6254155294894056`*^9}, {3.6254163270579777`*^9, 
   3.6254164681846085`*^9}, {3.6254171492456865`*^9, 3.6254171844172835`*^9}, 
   3.63078724415996*^9}],

Cell[CellGroupData[{

Cell["Reading files: Jordan\[CloseCurlyQuote]s simplified functions", \
"Subsection",
 CellChangeTimes->{{3.6309445700565*^9, 3.630944575885125*^9}, {
  3.631556493911154*^9, 3.631556497440126*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Filetofunction", "[", "filename_", "]"}], ":=", 
   RowBox[{
    RowBox[{"ReadIt", "[", 
     RowBox[{"StringDrop", "[", 
      RowBox[{"filename", ",", " ", 
       RowBox[{"-", "4"}]}], "]"}], "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Filetotag", "[", "filename_", "]"}], ":=", 
   RowBox[{
    RowBox[{"ReadIt", "[", 
     RowBox[{"StringDrop", "[", 
      RowBox[{"filename", ",", " ", 
       RowBox[{"-", "4"}]}], "]"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Listoffilestolistoffunctions", "[", "listoffilenames_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Filetofunction", "[", "#", "]"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{"listoffilenames", ",", " ", "Null"}], "]"}], ")"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6295653845883904`*^9, 3.6295653930686016`*^9}, {
  3.6295654700388207`*^9, 3.629565601449674*^9}, {3.6295658830829625`*^9, 
  3.6295658832704935`*^9}, {3.630432719332636*^9, 3.6304327366990023`*^9}, {
  3.630944597249024*^9, 3.6309445984905977`*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Output one data file per function", "Section",
 CellChangeTimes->{{3.624306677282857*^9, 3.6243066842393627`*^9}}],

Cell["Makes it easier if I have to halt at some mid point. ", "Text",
 CellChangeTimes->{{3.624306687271096*^9, 3.624306695550933*^9}, {
  3.624309323546484*^9, 3.624309323598075*^9}}],

Cell[CellGroupData[{

Cell["Older versions (not used)", "Subsection",
 CellChangeTimes->{{3.630886016320375*^9, 3.630886021201706*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Interpol3phi", "[", 
    RowBox[{
    "SMprimary_", ",", "mprimary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", 
     "minE\[Gamma]_", ",", "maxE\[Gamma]_", ",", "n\[Phi]bins_", ",", 
     "n\[Gamma]bins_", ",", "filename_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"primary", "=", "SMprimary"}], ",", 
       RowBox[{"mSM", "=", "mprimary"}], ",", 
       RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
       RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
       RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
       RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
       RowBox[{"Nphi", "=", "n\[Phi]bins"}], ",", 
       RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
       RowBox[{"path", "=", "filename"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"SaveIt", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
        RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
        RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "primary", ",", "mSM", ",", "mchi", ",", "mphi", ",", "minEgam", 
           ",", "maxEgam", ",", "Nphi", ",", "Ngam", ",", "path"}], "}"}], 
         ",", 
         RowBox[{"p3\[Phi]2gamfaster", "[", 
          RowBox[{
          "primary", ",", "mSM", ",", "mchi", ",", "mphi", ",", "minEgam", 
           ",", "maxEgam", ",", "Nphi", ",", "Ngam"}], "]"}]}], "}"}]}], 
      "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Interpol2V", "[", 
   RowBox[{
   "SMprimary_", ",", "mprimary_", ",", " ", "m\[Chi]_", ",", "m\[Phi]_", ",",
     "minE\[Gamma]_", ",", "maxE\[Gamma]_", ",", "n\[Gamma]bins_", ",", 
    "filename_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"primary", "=", "SMprimary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
      RowBox[{"path", "=", "filename"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"mchi", ">", "mphi", "\[GreaterEqual]", " ", 
       RowBox[{"2", "mprimary"}]}], ",", 
      RowBox[{"SaveIt", "[", 
       RowBox[{
        RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
         RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
         RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "primary", ",", "mprimary", ",", "mchi", ",", "mphi", ",", 
            "minEgam", ",", "maxEgam", ",", "Ngam", ",", "path"}], "}"}], ",", 
          RowBox[{"p2\[Phi]2gamfastest", "[", 
           RowBox[{
           "primary", ",", "mchi", ",", "mphi", ",", "minEgam", ",", 
            "maxEgam", ",", "Ngam"}], "]"}]}], "}"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.624309332428986*^9, 3.624309355059553*^9}, {
   3.6243094265903463`*^9, 3.624309548356604*^9}, {3.624309890836089*^9, 
   3.624309899142665*^9}, {3.624310064834036*^9, 3.62431012568429*^9}, {
   3.6243102581100473`*^9, 3.624310281258025*^9}, {3.62431063979613*^9, 
   3.624310666588607*^9}, {3.624310808756425*^9, 3.6243108698552027`*^9}, {
   3.62541706041072*^9, 3.625417061098252*^9}, {3.6254171094967613`*^9, 
   3.625417116159073*^9}, 3.6254172070573735`*^9, {3.6254191631832066`*^9, 
   3.625419178410751*^9}, {3.625419291174933*^9, 3.6254192935814514`*^9}, {
   3.6258653465521326`*^9, 3.6258653474584413`*^9}, {3.630786161946042*^9, 
   3.6307861708507586`*^9}, {3.630786775883048*^9, 3.6307867763830743`*^9}, {
   3.630787215986408*^9, 3.630787230319146*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Interpolflavorviol", "[", 
    RowBox[{
    "prim1_", ",", " ", "prim2_", ",", " ", "mprim1_", ",", " ", "mprim2_", 
     ",", " ", "m\[Chi]_", ",", " ", "m\[Phi]_", ",", " ", "minE\[Gamma]_", 
     ",", " ", "maxE\[Gamma]_", ",", " ", "n\[Gamma]bins_", ",", " ", 
     "filename_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"mchi", "=", "m\[Chi]"}], ",", " ", 
       RowBox[{"mphi", "=", "m\[Phi]"}], ",", " ", 
       RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", " ", 
       RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", " ", 
       RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", " ", 
       RowBox[{"path", "=", "filename"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"mchi", ">", "mphi", ">=", 
        RowBox[{"mprim1", "+", "mprim2"}]}], ",", 
       RowBox[{"SaveIt", "[", 
        RowBox[{
         RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
          RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
          RowBox[{"ToString", "[", "mphi", "]"}]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "prim1", ",", " ", "prim2", ",", " ", "mchi", ",", " ", "mphi", 
             ",", " ", "minEgam", ",", " ", "maxEgam", ",", " ", "Ngam", ",", 
             " ", "path"}], "}"}], ",", " ", 
           RowBox[{"diffquarkstogammafastest", "[", 
            RowBox[{
            "prim1", ",", " ", "prim2", ",", " ", "mchi", ",", " ", "mphi", 
             ",", " ", "minEgam", ",", " ", "maxEgam", ",", " ", "Ngam"}], 
            "]"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"In", " ", "this", " ", "next", " ", "one", " ", 
     RowBox[{"I", "'"}], "m", " ", "shifting", " ", "the", " ", 
     "reponsibility", " ", "onto", " ", "the", " ", "user", " ", "to", " ", 
     "make", " ", "sure", " ", 
     RowBox[{"we", "'"}], "re", " ", "only", " ", "generating", " ", 
     "spectra", " ", "where", " ", "the", " ", "masses", " ", "m\[Chi]", " ", 
     "and", " ", "m\[Phi]", " ", "are", " ", "high", " ", "enough", " ", "to",
      " ", "produce", " ", "the", " ", "primaries", " ", 
     RowBox[{"we", "'"}], "re", " ", "asking", " ", 
     RowBox[{"about", ".", " ", "Otherwise"}], " ", "the", " ", "program", 
     " ", "will", " ", "hit", " ", "an", " ", "error", " ", "and", " ", 
     RowBox[{"halt", ".", " ", 
      RowBox[{"These", " ", "^", " ", "other"}]}], " ", "ones", " ", 
     "usually", " ", "will", " ", "just", " ", "give", " ", "a", " ", "Null", 
     " ", "result"}], ",", " ", 
    RowBox[{"but", " ", 
     RowBox[{"it", "'"}], "s", " ", "slightly", " ", "more", " ", 
     "complicated", " ", "to", " ", "make", " ", "this", " ", "check", " ", 
     "the", " ", "masses", " ", "now", " ", "that", " ", "everything", " ", 
     "involving", " ", "the", " ", "mass", " ", "of", " ", "the", " ", 
     "primaries", " ", "has", " ", "been", " ", "moved", " ", "upstream"}]}], 
   " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.624909732685658*^9, 3.624909882718506*^9}, {
  3.624910160393284*^9, 3.624910194170757*^9}, {3.6249106727804823`*^9, 
  3.624910718330476*^9}, {3.624910934381357*^9, 3.6249109424984956`*^9}, {
  3.625416526871293*^9, 3.625416527308813*^9}, {3.6254169262278566`*^9, 
  3.625416955924256*^9}, {3.6254191895818663`*^9, 3.6254192106596236`*^9}, {
  3.6254194588071513`*^9, 3.6254194672067146`*^9}, {3.63078688599235*^9, 
  3.6307869289233255`*^9}, {3.6307902218184958`*^9, 3.630790290043748*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Interpol2VCombinedSpec", "[", 
   RowBox[{
   "primaries_", ",", " ", "m\[Chi]_", ",", " ", "m\[Phi]_", ",", " ", 
    "minE\[Gamma]_", ",", " ", "maxE\[Gamma]_", ",", " ", "n\[Gamma]bins_", 
    ",", " ", "weights_", ",", " ", "filename_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
      RowBox[{"path", "=", "filename"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"SaveIt", "[", 
     RowBox[{
      RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "primaries", ",", "mchi", ",", "mphi", ",", "minEgam", ",", 
          "maxEgam", ",", "Ngam", ",", "path"}], "}"}], ",", 
        RowBox[{"p2\[Phi]2gammultiquarkfastest", "[", 
         RowBox[{
         "primaries", ",", "mchi", ",", "mphi", ",", "minEgam", ",", 
          "maxEgam", ",", "Ngam", ",", " ", "weights"}], "]"}]}], "}"}]}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.630779361476924*^9, 3.630779363102208*^9}, {
  3.6307860580418153`*^9, 3.630786081194899*^9}, {3.6307861153558445`*^9, 
  3.6307861489887137`*^9}, {3.6307868281833177`*^9, 3.63078688196057*^9}, {
  3.630786937684804*^9, 3.6307869460815616`*^9}, {3.630787076922629*^9, 
  3.630787092104928*^9}, {3.63078813668112*^9, 3.630788144732486*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Revised versions (work in progress)", "Subsection",
 CellChangeTimes->{{3.630886016320375*^9, 3.630886021201706*^9}, {
  3.630889853027525*^9, 3.630889858180929*^9}}],

Cell["\<\
Interpol2V test: \[OpenCurlyDoubleQuote]b\[CloseCurlyDoubleQuote]/80/20 with \
100 photon energy samples, 20 primary energy samples (nEfs) is \
indistinguishable from p2\[Phi]2gamSwift (which is itself close to \
p2\[Phi]2gamfastest and gets closer as you increase nEfs).

1/22 updated tag to include nEfs.
1/22 Interpol3\[Phi] tested. (Had to clean out mprimary dependence)\
\>", "Text",
 CellChangeTimes->{{3.6308902708720007`*^9, 3.63089035201093*^9}, {
  3.630944055509386*^9, 3.630944068186108*^9}, {3.6309444390091953`*^9, 
  3.6309444582131357`*^9}}],

Cell[CellGroupData[{

Cell["qq final states", "Subsubsection",
 CellChangeTimes->{{3.6311387487076397`*^9, 3.6311387534655647`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Interpol2V", "[", 
    RowBox[{
    "SMprimary_", ",", " ", "m\[Chi]_", ",", "m\[Phi]_", ",", "minE\[Gamma]_",
      ",", "maxE\[Gamma]_", ",", "n\[Gamma]bins_", ",", "nEfs_", ",", 
     "filename_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"primary", "=", "SMprimary"}], ",", 
       RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
       RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
       RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
       RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
       RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
       RowBox[{"path", "=", "filename"}], ",", 
       RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"SaveIt", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
        RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
        RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "primary", ",", "mchi", ",", "mphi", ",", "minEgam", ",", "maxEgam",
            ",", "Ngam", ",", "nEfs", ",", "path"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"p2\[Phi]2gamSwift", "[", 
          RowBox[{
          "primary", ",", "mchi", ",", "mphi", ",", "minEgam", ",", "maxEgam",
            ",", "Ngam", ",", "numEfs"}], "]"}]}], "}"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Interpol3\[Phi]", "[", 
   RowBox[{
   "SMprimary_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", "minE\[Gamma]_", ",", 
    "maxE\[Gamma]_", ",", "n\[Phi]bins_", ",", "n\[Gamma]bins_", ",", "nEfs_",
     ",", "filename_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"primary", "=", "SMprimary"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Nphi", "=", "n\[Phi]bins"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
      RowBox[{"path", "=", "filename"}], ",", 
      RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"SaveIt", "[", 
     RowBox[{
      RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "primary", ",", "mchi", ",", "mphi", ",", "minEgam", ",", "maxEgam", 
          ",", "Nphi", ",", "Ngam", ",", "path"}], "}"}], ",", 
        RowBox[{"p3\[Phi]2gamSwift", "[", 
         RowBox[{
         "primary", ",", "mchi", ",", "mphi", ",", "minEgam", ",", "maxEgam", 
          ",", "Nphi", ",", "Ngam", ",", "numEfs"}], "]"}]}], "}"}]}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.624309332428986*^9, 3.624309355059553*^9}, {
   3.6243094265903463`*^9, 3.624309548356604*^9}, {3.624309890836089*^9, 
   3.624309899142665*^9}, {3.624310064834036*^9, 3.62431012568429*^9}, {
   3.6243102581100473`*^9, 3.624310281258025*^9}, {3.62431063979613*^9, 
   3.624310666588607*^9}, {3.624310808756425*^9, 3.6243108698552027`*^9}, {
   3.62541706041072*^9, 3.625417061098252*^9}, {3.6254171094967613`*^9, 
   3.625417116159073*^9}, 3.6254172070573735`*^9, {3.6254191631832066`*^9, 
   3.625419178410751*^9}, {3.625419291174933*^9, 3.6254192935814514`*^9}, {
   3.6258653465521326`*^9, 3.6258653474584413`*^9}, {3.630786161946042*^9, 
   3.6307861708507586`*^9}, {3.630786775883048*^9, 3.6307867763830743`*^9}, {
   3.630787215986408*^9, 3.630787230319146*^9}, {3.6308898679655533`*^9, 
   3.63088987036917*^9}, {3.630889913755083*^9, 3.6308899587034607`*^9}, {
   3.6308900453334627`*^9, 3.630890062132079*^9}, {3.6308901198741693`*^9, 
   3.63089012191397*^9}, {3.630890206712902*^9, 3.630890207307288*^9}, {
   3.630943962479074*^9, 3.6309440524266644`*^9}, {3.630944285094852*^9, 
   3.630944291817067*^9}, {3.6309443680441723`*^9, 3.630944371778647*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["qq\[CloseCurlyQuote] final states", "Subsubsection",
 CellChangeTimes->{{3.6311387382042007`*^9, 3.631138745810676*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Interpol2Vdq", "[", 
    RowBox[{
    "SMprimary1_", ",", "SMprimary2_", ",", " ", "m\[Chi]_", ",", "m\[Phi]_", 
     ",", "minE\[Gamma]_", ",", "maxE\[Gamma]_", ",", "n\[Gamma]bins_", ",", 
     "nEfs_", ",", "filename_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"primary1", "=", "SMprimary1"}], ",", 
       RowBox[{"primary2", "=", "SMprimary2"}], ",", 
       RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
       RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
       RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
       RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
       RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
       RowBox[{"path", "=", "filename"}], ",", 
       RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"SaveIt", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
        RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
        RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "primary1", ",", "primary2", ",", "mchi", ",", "mphi", ",", 
           "minEgam", ",", "maxEgam", ",", "Ngam", ",", "nEfs", ",", "path"}],
           "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"dqp2\[Phi]2gamSwift", "[", 
          RowBox[{
          "primary1", ",", "primary2", ",", "mchi", ",", "mphi", ",", 
           "minEgam", ",", "maxEgam", ",", "Ngam", ",", "numEfs"}], "]"}]}], 
        "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Interpol3\[Phi]dq", "[", 
   RowBox[{
   "SMprimary1_", ",", "SMprimary2_", ",", "m\[Chi]_", ",", "m\[Phi]_", ",", 
    "minE\[Gamma]_", ",", "maxE\[Gamma]_", ",", "n\[Phi]bins_", ",", 
    "n\[Gamma]bins_", ",", "nEfs_", ",", "filename_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"primary1", "=", "SMprimary1"}], ",", 
      RowBox[{"primary2", "=", "SMprimary2"}], ",", 
      RowBox[{"mchi", "=", "m\[Chi]"}], ",", 
      RowBox[{"mphi", "=", "m\[Phi]"}], ",", 
      RowBox[{"minEgam", "=", "minE\[Gamma]"}], ",", 
      RowBox[{"maxEgam", "=", "maxE\[Gamma]"}], ",", 
      RowBox[{"Nphi", "=", "n\[Phi]bins"}], ",", 
      RowBox[{"Ngam", "=", "n\[Gamma]bins"}], ",", 
      RowBox[{"path", "=", "filename"}], ",", 
      RowBox[{"numEfs", "=", "nEfs"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"SaveIt", "[", 
     RowBox[{
      RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "mchi", "]"}], "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "mphi", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "primary1", ",", "primary2", ",", "mchi", ",", "mphi", ",", 
          "minEgam", ",", "maxEgam", ",", "Nphi", ",", "Ngam", ",", "path"}], 
         "}"}], ",", 
        RowBox[{"dqp3\[Phi]2gamSwift", "[", 
         RowBox[{
         "primary1", ",", "primary2", ",", "mchi", ",", "mphi", ",", 
          "minEgam", ",", "maxEgam", ",", "Nphi", ",", "Ngam", ",", 
          "numEfs"}], "]"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.631138758377204*^9, 3.631138778158085*^9}, {
  3.631138835697233*^9, 3.631138863450658*^9}, {3.631138936864952*^9, 
  3.631139007369093*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Code for analyzing spectrum functions", "Subchapter",
 CellChangeTimes->{{3.631371435934104*^9, 3.631371443016848*^9}}],

Cell[CellGroupData[{

Cell["FERMI Models", "Section",
 CellChangeTimes->{{3.625692759599728*^9, 3.625692776863051*^9}}],

Cell["\<\
Simona presented some fits for the FERMI excess assuming an NFW morphology \
and a \[OpenCurlyDoubleQuote]power law with exponential cutoff\
\[CloseCurlyDoubleQuote] spectrum. In the plots, she presents four benchmark \
lines that reprsent different background subtractions. These aren\
\[CloseCurlyQuote]t comprehensive, but are meant to sample the extreme ranges \
of backgrounds.

Here are parameterizations to three of the lines: (evaluate this block)\
\>", "Text",
 CellChangeTimes->{{3.625692778657528*^9, 3.625692809957453*^9}, {
  3.625692895274963*^9, 3.625692997233408*^9}, {3.625693049719151*^9, 
  3.625693057246141*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BluLin", "[", "x_", "]"}], ":=", 
  RowBox[{"0.00022", " ", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{
     RowBox[{"-", "0.05"}], " ", "x"}]], " ", 
   SuperscriptBox["x", "0.43"]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RedLin", "[", "x_", "]"}], ":=", 
  RowBox[{"0.00019971397237953823`", " ", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{
     RowBox[{"-", "0.05638402167808436`"}], " ", "x"}]], " ", 
   SuperscriptBox["x", "0.45644018846273754`"]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GreLin", "[", "x_", "]"}], ":=", 
  RowBox[{"0.00028197993482789003`", " ", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{
     RowBox[{"-", "0.6305547186339059`"}], " ", "x"}]], " ", 
   SuperscriptBox["x", "1.8603942252272618`"]}]}]}], "Input"],

Cell["\<\
Caveat emptor: the Red and Green lines were extracted using NonlinearFit, but \
the Blue line didn\[CloseCurlyQuote]t behave well so I just did the fit by \
eye. It should be good enough. (The third line wasn\[CloseCurlyQuote]t \
interesting, it was in between the three lines for the range of energies of \
interest.)\
\>", "Text",
 CellChangeTimes->{{3.625693002304191*^9, 3.6256930425994587`*^9}, {
  3.625693345774494*^9, 3.625693364669599*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["FERMI-inspired Envelopes", "Section",
 CellChangeTimes->{{3.625693064281665*^9, 3.625693066206851*^9}, {
  3.6309446122193604`*^9, 3.6309446148815737`*^9}}],

Cell[TextData[{
 "We want to define upper limit and lower limit functions such that we can \
define a criterion for whether a spectrum fits. First, \
here\[CloseCurlyQuote]s the max/min value of the three lines. Note units of \
y-axis are in ",
 Cell[BoxData[
  FormBox["MeV", TraditionalForm]],
  FormatType->"TraditionalForm"],
 " ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"/", 
     SuperscriptBox["cm", "2"]}], "/", "sr"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 " ... we\[CloseCurlyQuote]ll redefine them below so they\[CloseCurlyQuote]re \
in GeV."
}], "Text",
 CellChangeTimes->{{3.6256930685984783`*^9, 3.625693143567876*^9}, {
  3.6256932095967216`*^9, 3.6256932401480417`*^9}, {3.6256933272458982`*^9, 
  3.6256933432936573`*^9}, {3.632672103082118*^9, 3.6326721628674994`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MaxEnv", "[", "x_", "]"}], ":=", 
  RowBox[{"Max", "[", 
   RowBox[{
    RowBox[{"BluLin", "[", "x", "]"}], ",", 
    RowBox[{"RedLin", "[", "x", "]"}], ",", 
    RowBox[{"GreLin", "[", "x", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MinEnv", "[", "x_", "]"}], ":=", 
  RowBox[{"Min", "[", 
   RowBox[{
    RowBox[{"BluLin", "[", "x", "]"}], ",", 
    RowBox[{"RedLin", "[", "x", "]"}], ",", 
    RowBox[{"GreLin", "[", "x", "]"}]}], "]"}]}]}], "Input"],

Cell["\<\
For example, a reasonable envelope would be: a spectrum f(x) fits if
1. f(x) < 2 MaxEnv(x) for all x in the range (1,100)
2. f(x) > 0.5 MinEnv(x) for all x in the range (1,100)\
\>", "Text",
 CellChangeTimes->{{3.625693374031559*^9, 3.62569337601336*^9}, {
  3.625693752508174*^9, 3.62569381645476*^9}}],

Cell["Here\[CloseCurlyQuote]s what that envelope looks like:", "Text",
 CellChangeTimes->{{3.625693830941608*^9, 3.625693839913851*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"LogLogPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"2", 
       RowBox[{"MaxEnv", "[", "x", "]"}]}], ",", 
      RowBox[{".5", 
       RowBox[{"MinEnv", "[", "x", "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "1", ",", "30"}], "}"}], ",", 
    RowBox[{"Exclusions", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "30"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]], ",", 
         SuperscriptBox["10", 
          RowBox[{"-", "3"}]]}], "}"}]}], "}"}]}]}], "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Exclusions", " ", "because", " ", "otherwise", " ", "there", " ", "are", 
    " ", "gaps"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.6258514797145405`*^9, 3.6258515151946526`*^9}, {
   3.625851565060206*^9, 3.6258515654508514`*^9}, 3.63267203667804*^9}],

Cell[BoxData[
 GraphicsBox[{{}, {}, 
   {RGBColor[0.368417, 0.506779, 0.709798], AbsoluteThickness[1.6], Opacity[
    1.], LineBox[CompressedData["
1:eJwV13c8lV8YAPB7r1HIKIrwXuMnWUUSSjlHJGWmiahQUVZWWlYlpGlFVqSk
IRVpOgmV0JZNhWz3XtfI/D33r/v5fu47zvOc857nOUquvvb7GTQarZ1Oo/F+
R2ZStcdv+BsrGK7q86IUSNddW9No6S3od/AVPgHwQ6s9s67S+1CaW6JCurwC
WUgddLaTPoJWal9zrZFTIBYCh+dtlI5A28duSi2XVSD7/vW7rZe+gpIOPVVn
LVIgPsP3xbH0DfS24AHzqIQCCfS72GksXYjGXq/zusynQLQGO6VMPr1BT1xS
ymr+Mkm5XviLkqAqZPugVle9FmzNmd4T8gV9l2pqsipikjeKu2id8+vQhY/d
b/NTmUTi5ST/j92NqMp7Ts2SSCaZkkmu8vNtROYl801fRjBJd5Du5XmRjai6
6lapPbhU21PO7HYj8u0MqQ4LZxKfnLoVj9mN6LgLR68xlEk+xha6XIlqQhsz
/q6/fIJJohwOllg/bEaqT1z30oOYxL+YEdpT1oxGv4XfvRbIJM6SGaZnfzQj
gWcHp7XBejXfa19ONKPQkuQilwAm+YPXd2puaEHnuU+PvjzCJFiNWiDc2IJG
I4vNjvkwidbZkp+5/S1o83zbaQmwzO+t6SazLcjN+PPLPG8mGboeq3ZMpRWl
hiXY1XsxSYb4uHG3TyuqF3L+aHCYSWK94vnPRLSi2RH/F58OMUnQh+VVCgmt
KCE34tFBsNXp/dt3PmtF572uFCV7MolhO01u+GMrUk1IeqMNVlmX1n6xtRXl
ZqZ9f+fBJJOjXw9X8rUh05jH4uMHmUS1+4adyKI25FgYI38VbN/gt8pOrQ1R
lUt1tMChVUg2cU0bknd75mR9gEnyX4jNNli1ofTgtWMO+5mk7l7LH+YeeF5N
XPcBdyZhZNx773akDeV0l2kHujGJY/jmqwOJbWg4aT25tI9JWvj37RaWakf/
dPdGiDgyybqL9ZErbrWj1A9HvM0smWQ6692nsKpfKI7L8nuznElu5Zf3fun7
g5xbo774TlOEOtNUrGLUhYRW9JnN1lBEykmivty0C51UTU1yBAvrbvjnbtWF
aLlO5sXVFBlre2CU69yFjEtPEJ+PFPliFEmWhHehrcHjSh3vKXJ2WK1KtaIL
5fSsedj+liIDrsEtarZ/kVKX4AOl5xR5ZTKff5lbN3ob+bXr/W2KfP/d9uTG
4W7ELjO3RODe0w/2LwrsRlN6fhLFtygiU2n5bvZMN3oxYfHqZi5F/DdHxX69
1Y12pLXlROVQRG3rpERIbzc6MvHfi92ZFLnq3km9PdKDzveffWefTJE7Ak9q
DY73oJKh+4E/kihCbkWG3YvsQezYqrO7wAPdCr8S43uQ2AbL73sSKWLh7XjT
o6gH2fjZLQmIp8h00CcNsX89qL/v/oN7lyjice6ZgUN4LzocuVnWK5oiry9Z
9Z2N6UXM/cl97HOQv2ttGY+u9qLo41H6IWCSJyA4L7cX5TbUrY6Kooh01Zbv
rz/0IpU2yYnbZyhSOa/XT0WyDzU/fRHGiKCIylXZ/KHcPiT9+UWy1HGKHE+9
7yxf0Icadtz/decYRT5n4/mbSvrQMuPCOwh88vGBkOyqPlT5O/yJVwhFvn1/
ZL59qA/xP9V/Vh1MkUhpyz/PDftRlUN9xs0AirSnnZCP+tiPJoX+NT3xhvcr
St5a+B3+f225di/4/s187dzmftSlsU9sHvj4vYb15QP9yHLaeu5+L4jvpYEn
Q2IAxSpF7ZA/DPlqGi4K3TaA1k6go1keFClc7GV7tGUANYvNyZ51o8i1dL4G
wa4BVJdnE/wMHKp03TVpcADJ2RmQALCVelVQ0ewAci31LOpxpUiXoVrasNIg
WvmuUq1pH0Vkd3V0+x4YRLmBsrbf90A8SbsjPYYGkYh9wTHF3RTJiygRezg+
iHIWrsjucKJIrZfU9TH6EBrzy3S4A15sWv04SmoIbW36G6QHfjhk1Hlz9RBq
v/bYY4sjRVot5Cx+nR5CJbqlTrd2UYRf7+h3tQtDqF4jMSoArKHwba9f0hCS
7OauNwEHjcQem80bQqtvT/i17qTIvOyJfKp2CN1OI7cUwOnT/YLL5rGQVr9n
xqvtFNEZlq35LMFCxLtsJB5c1m0RH7iQhQaZNr8Ogbu/3VR4yWSh0/J3g2TB
evm7DS1XsJBAsu618G0UeZcZOzO4ioWK7JoSncCOiSXlV9ewkOA1CXUDcHi4
1JZGUxbq9aqVYG2lyMcd1Z6eO1hoKXLo9QC7WE1oizqxkAullmIBZpmojT7c
w0KL57W3qoEXLTsTOe7BQkLWz7X77Cniyrf2+rkTLPQ7srMvGDwy7rlPM5yF
Ah592OEEjh5MXvrpDAsl3Bh1wOAHDcOPF11kobfRTerzwP8K7lbnZrHQpi93
uPlbKJIWe6txZS4LzVaIXE4AG++/0f3mDgsdZZwrDQWfkU3mb33EQtFy/k3b
wEtHrizwespCqcf132Nw1ac4xYkXLHRQ9dWmZWCJs5FrF1Ww0N2B5yJzwY/3
nNp88wMLifZHWY3aUWTHmpBdurUQz/Rr5U5w2pB3oM1PFiq9QV0uB6s5OtyL
6mGh4HwUEAv+qLftudQgC5mlL3I/BfYRt32fzWGhc4EFfX7gJ+VmHa8nWYiT
9bXUAbwzE3GsaGw0PPVoni144tgaWhM/G/1nSWebgbG2jvyYKBvdtU8I1wX/
EdLUOLuAjYSCtLU0wFEdSwwlpdnovlOnrzJYvVTR/IYcG3U4/LKUA1enyG3T
VmQj+082RArsG7jI9ZUKG/1b6lAjBl5gO9/PUp2N9Js1A4TARerzQhuWsdEH
P04hP3gX/5y4g7psVB9cH0MDT7bSU0f02Yh9XmhyypYiGc+mbp82YiNxx0KB
CbBJwljRfMxGacmTd8bAHT6ct5lmbBQ8R6p7BHxu08CXZZvYiBOiSrhgDZXu
thfWbPTrnYsuzzUzvwc22bPRxeZuY579Glomf+5go+q7rE6eJZ/UCx1wYqMB
/eylo+Dii9+kuXvY6NN5df5xsINn7ZJIdzZqLn90gjeeKdMPKyU82UhM6NDF
aXAms9wkwxvyff7EWjrEs/7fa1stfzZ6cEEySgDc8e2Z8/NgNqI5uRwWBp97
8OSwxQk22mAd3S8O1ogpOFYXxkanql4JLeLl1y3/nPsZNrLeoPlWnpdf49xE
TjQbMdZNy6jw8rs4Kyf8AhtdW7dXRIuX3+HUQrGrbPS8LTxVj5ff2sTStCQ2
qnh/vnIdOOP0+aaSTDZ6aCY5ugVs4hLVY34T8r2v599u3vgMI8a+57FRd+Pu
6x688QwGS7IL2Ugp4tPTCHDN+yNKYcVsNJahtvIS2C/HS1v0BcT376tVOrh4
l6ulejkbDX375PQCrHRkT7nHe4hPeOnqKnBczO51edVsdNPzY1YD2O35Du2l
P9goKuui+ARYQt5SckkXG3GnBHxN4Hs5oWcR597LRgkbarJ531uX1QaBm4Ns
dKlgrqsH+NUpNKY8xkZyTL/TV8CH2lY2Kc7loELh+Tt6wT/GdLbtncdBGa+j
e+jwvWOJ5TWZEhy0lZ4hJAuWNlErZS7moBe5+ixLcHm2fI68BgfRnxk6FYMV
DggclrHioEQdtw+5sP/EhjI6dtpxkFyLpWEleDRpdnfyNg66cVBL/y+4+t0/
m0XOHOQr5N2mAfvdcfVBXSkfDurYtai/BPy9v25C/DIH/dQ6Js6C/RMJfA+w
TeCg30pvwxbvoEg+9aX/4jUOEt3lGWEKjrD52Cp6g4PcBfavTgEvf1haJvKI
g3Ys2B5uCft3dEBe7JzvEK+edNxH2O/jS+cI5NRz0KjQkD/DAeZb5GCYcQsH
RZy+NWcN+EnOksCgLg56+v2k0V1w27ds5z/jHMRdseFrItQXfb10nVJqGKmG
H+g+D/XKJHwq31F5GAW2fyuvAVtVOy0ZVR1Gj9Ztspdwhv3XXVZ2mc4w0uCX
iUgGX0hI5ru+fhj9d6Fl5QMXWE/cK3XBB4fRpOuY7PReigxhtt0Cr2Hkc21A
YTPUy4k4u4/3/YbR2S/KDclgiSXipOPYMLomI+u5Cuqr0fa4O/Zxw6itcoD/
GNTfq0VRJ5cXDqPB3T0OygdgPoNPKHdNDCM9/s29M1DfJWktc1bODqPt39yW
74b63xVjPBDGx0WnNU0XPgdfSKeXLJ7HRbQUevVR6Bcay89ZW1NcNNOz6feE
D/QTNj26qUpc1K6z28TZF+pV/WaZv0u46OjReDMCVu0X/RO+nIvqMpUMo/2g
fgT5vq/R5SKXgc9qA+Dq2c/3ZQ24SG7Bjtf2RyiSFaMbf9CIi/L3tYyXgAMk
E0KeIC5KMIqvV/CniHn6iDPdjIs8VQ126oNll+40tbHgIsbp6UYWXD/wsETt
uhW87+rfw3fBZI2sWLcdFwW0jgsdAMeXnxjW285Fu4b0ihTBB2xa6iMcuGjc
NtO7CcYzzzUrR84VvFxUcAu4rY8e43GAi/jeSXeJgB8FufkUHeIi+d8u3yoh
PocY1dW2AVy0re3hj7XgWw/v1Uae4SLn5nfH1CE/x9aIPfkUzUXPvWTLOyB/
VuW+KfIXuKhCqlIuCzz8U9e9OJGLTsw1GF4ExrMl/3pucdHttR3rBSD/jdYV
Kls+cJHdeIJHhydFRPtajiuIjSDuxMeue/sh33k39r1fMIKERzU2u4M5+/db
HJEeQb/DS1/Jgevb+xe+VRxB05ppP2LdKXKzbvLhgZUjqNc3770nrI81ZYv/
3t81gvrHVxENWE8HU7ZvXZszgmbDSxY9g/X7ZmONpoPhKGqIT/Gfy/s+u0c+
qTiPoT9KthsrTKE/nLyvZ+kzjuJfuOqnr4J+eoTDPpL0D3EDP7cHLIX+0/Wd
73D+BKo93VTlJUeRRMkf7YLPJ5HqhZPqPyQosvmeb75s+xTSSl4Y904Q+q9t
19zdO6aQk8Ho1E1w1hRhPuieQgks/TOR4FGrBfEm7CkUWsD6sQ6cM/DkhAdj
GlWWDUQVCUB9WT5hVawyjWbydqjc4adIQeGZoS2e0+jHkpNHbzCgv32aohfD
mUZOEaYNP2fkSdtVFdbysWlEE5PJLwHn+xTc/T45jRYIzk1OASPVCmVFgRl0
9a9jhRP4UCJL4qn0DGp+XRj4a1qekICNAx1rZ1Dv3B1LOFPyxEtnJBefm0GV
J2Lmqk/KE4N54fu6zs8gjYgaL1Ewo1uYirs8g77M6A+yJ+RJcqZiws+UGeS+
Mc3iBbhMzCrS594M4tal77YFywxku6R9mUHeu4bnnvonTyru2EmPy80iQw5V
MDgmT7IO5clGK84i2TJpw5/g45o0psySWaTYoNtaCta5X6BiuHwWEWow4go4
7aGYbgieRW42rmr6YP+n1Vbj7rNo7bn48TOj8kSxwiJy/P4sWiWr/stwRJ5M
ns06G/1oFm2PTWAuAdeZj0fLPJ1FDi3ax+eD497fvmRIZpFStkxcL1eejH0U
TA/5OotkDt+UywDXfi1/Oj46i5IMjNjCYGO/rOApBRrOWZr6eJIjTy771iyj
lGl4elSuoR/8y2eiY50KDW8w/r64FXzGe9vWMDUaFlguMEDAVYfm6jBW0DDf
55VN58A79/v1zFlPw8/3q7TIgvPc07PUzGj45mDwM1HwhFvVzk3mNFxUFFhI
A2e4qlTGbqZh/sBL3C62POnYU58tupWG9XZKvH8C9nPEuyXdaZi2+0X+dnCZ
g7ek3gEaVspdvWEzWNIhtWqbBw0/+9swaQwu3sk1TPKiYX/rjFdq4OlteQsX
B9HwnadzE6ZZ8iTWVuITM4qGZU9NXr0HbrZZF4WiaTiAUhzOBi+zObRubywN
L/Br800Bf7Yqv3vjIg1/zbIqjQIv2hwSrZJMw9e+Fhe7gnPM2k008mjYSj9U
TBFc7vz6X0g+DUvkyCRIg7uC0wrf3aPhbcN/jcTBand2Ke0vpGHmayvOzJA8
eSD6hZb1nIa7ZM0m28CfVQtKBl/S8O/7qfH1YDa64LeulIY1fIJsvoD1/De1
N76lYe6WNs234Gd1b0oX1tBwj3laVB64cSjzqPsnGi74rKmXDZ6aG6r9+AsN
74i5xJ8GNjZak2lXB/NVOil6GVye+Sj0fBsNB7tHlB8Dd5Vc1m/8RcP3j1XH
BILnfPUZVOug4dqQtf6+4M38mi6V3TRc9uHxvf3gTx456+gcGp7vLf9hK5gV
ETFiy6XhHwF382zBC67vuZ8xCs9rfHjXErytRo5aO0nDqS82ypuBg7v+fY+d
puH44oEYDE6e/RnXMEvDHpIr5dbx4lmRMBXMT8f0hRV5+rx4Nvs/qRCkYxd7
1dyVYMrdzktKiI6rle0qdMB7k+Y1F4rS8Zta1SOa4IiC3niaBB0/duyeUgNn
v39vabuAjmMbr99TBXdOnHnRv4iOUw0YIcpgQSm3AKPFdKzR8iFeEay2zEQz
Vo6Orefc/8YEbzJX+FNP0fFDpWIDCnxoz3TqUkU6nk0dKpUDx4U02Qcr0/Fg
h5uXLPj+lWfCFSp0vDyQWrcYXJufXCa5lI6PEVVdGV6+3gYdd1Wn4wtmsZbS
vHy1bNUt1KRj7VD7mEXglaMremeX0bH6YEzfQl7+xCWybXTo2E7GyJ/nYLVB
h3RdOg477UfxnGxSPb9fj47Tn+kNSIFLHPM/rDGA+DZe/cVzY0B0RMxqOvZ/
FT/B82TcgdX1RvC+B6aGvPtpFRW3ZtfR8czg1FWeBadVpJZiOnZrfi3KG8+8
VWcibNbTcYL01TyeF3j/GQwyo2NpszA33vhlctfvTjen4w9zLhnz4qNabnwo
t6DjRuGq1bz4lRfSDfo30/GnMcPtvPyoWe+9KWlNx6dPdFzm5W/52dL5RrZ0
rLrhR788L/5XzDDXLXRsIijlycu/4cip/pitdPzI/44Ab36Ml7U4FG6H+cUZ
ZUpgs/1r39XvpONvapOZ//HmK/26Hs2Rjic736cv4eVP1FHc1gX+r2uYUAc7
bnh2MngvHcvGLXfUAu85JdOb7gr5WyzduJw3vwN15f0HIL+NlUZ6YL8l+rpS
nnTsmJ1JGYCDnBMzjQ7TsfdhbcU14PCarcdjfel4s1nyOd56jhJ4/LfwCB2f
nwzvNwWfX7dge0MAHXMYG/w3gpPuf9ZWC6HjLYfD2m3A9y5Yd1aE0/HbOcUW
e8CPKu7ZD0TC+k88VOQGfjotQqTO0nFpJDb1AJd5V6W6xcB8rgosOwKut95o
R78K4wkesY0Ct5699UotgY4zggoqz4P/vBLQtEuiY9ewry5XwIPLygUyU+n4
atHRYd7+ICBm8mJtDqy3TUYFRWBh8yw191xYn2prdF+CJUJnE8/fpuOUnb11
ZWD5wVd+jXfpOGIk8uxnsG7tGtWQJ3R8eSg+ZADsclHvyuMKmK8/uq+Xwf7X
b3hc+fM7Or5Z91BPH3zsT+nj/g90fEpPvtoYnGBoWbeklo7PTrY424Grfu+T
u1ZHx5JldLEgsIHBpdyTf2F+5Pzzynn77a/v+ik9dGxj0rbiE9g+TvZ9UR8d
K8+tbG4A+/zK7R0couPxn/8lD4Fvnn+pvW+cjotSZTLloT5ItPc82yDEwDk6
BXynwBmx2pauIgyc4tyeFwPWXBXUHCrKwBPFi/2SwOaxtNmn8xl4X8d794fg
U3rSZhqyDJzkvrC7E9wbbVYrpsnAO3PsXHZCfXu7IvP3TysGNtgqt2nbMNTz
0cRAZVsGruJb+eQAOPR5nKD3Fga2+VZkcQxsaHpcg7GDgcustAYzwA+2bffX
2sPAO36qa/WDU4+KMCKOMHA0uyn0ItRvv1dHlTSSYPzSwd84UP9rI3weB15j
YLbFytPC0D9omu/fUJrKwLSFrc7K4K5ae89tmQysULwswR7s1L6sMDSPgbf6
igkWgc35OvC35wxszr0rFAn9iPwmu70n2xg4zLj871rod1y03t/O/MXAavqU
zC5wpjgeKvvDwA+qdHwDwMp12qFC3Qzsalh4JR+s5iaelsSC68tX35GF/mnV
qdqfD+l8uDP/nCYD+i+bQivbzv/48LwFqZWD0K9dTihPmqvKhzl3436LQT/3
5ejaVk01Pvw5L1ZVG7zNWMvbX4sPV974puoHdvwocn5Wjw8Hi1YKccEHOqsq
F5vzYaKU6so3K0/CFm8ytvHgww8a6PcwnSKXF/lHZR7iw0/35NI8wdmS12tZ
XnxY0Ztz9gq4XHTAJf4IHz5z4Y3yH7Aw40pY/XE+vLiu9FY09KsJvfXE9QIf
fh53p6OZD867LzxMjz7iw8ks/7R86H9/OEdbZE3x4YZn9zRb51Gk6piuedUM
H34VjlLEReH8k9hsyqXx4zd7ffVMwPdqdJCFAD/+9/nn8E1w5LqGVSxRfjw7
uOSajxiclymN/7ACPz4tkhQhDP15VPPH6TYTfix9xEd7vyScd53EHyuc48en
DoWX5snC+bgn87txDD9u/ClU3gFeEaIz6nyeH/fPPzmmCP2+VuKW1WmX+LH4
M6u+FLDyp/hSmWv8OF51as5FeYqIm8pUz7/Dj7snohXDmBTp1lDq5PvIjwcK
ilTPKlMkZUJXultMAL9dYr39P004n2YHrl41XwBTdRlJR8B6lsVOkZLg5L4F
BFx7fXWWvIwAPmbw/KWzFkX412H1LUoCOOL43J/Xl1HEJ8za6PlKAZzk5bzq
Px2KmPF77InbJYBjblyavwfOLyzR9Ns62QJ4l+cr6hKmyJZGm2u3NAVxvu5Q
L7WLIrmyG4vSiCDeesqd/iUIzhtTTR+b7Ofgjx78VeHJFHG5VrLeomkOvus8
ucTsBUUe327q1POdi9euft7K/EuRBX7mPTb/5mK9/V6umguZJLDRuqswXAhX
cNmn/TYyyYeS6+KJksL4wMDeGMUzTKJutyIlN00Y933oUxsqYxL74PMZQpnC
eOpw78eF5UxyMq0zx/uGMBZVchpcW8Ektd0pD1bdEsYixpqP4t7B8yMY5RUF
wthG+slq3WomIY++DXaWCWPVkCnPxB9MsmNhsJlqjzCeFTzo8qqbScKNPm+K
7RPGd1bsXsPtYZI7+zRsBweE8e7V6amafUwydb/VoZgjjA8uvdF9fYBJbphv
9DWfEsbDQnNKIzlM0n9UJvWAuAh+YKEa4jnFJIsy/DOr5ovgpWtD7+ZNMwkq
r765XEoE376Ytb97hkmuSkQUjMqIYI2ETh9PugIxvNNTHqUsggXSmxuOCCoQ
10+mVb0qItjyIWdj0RwFcn4k/ZPNUhGc8meR8b+5CqTVxL5xkZYIXnxE622k
iAKZ43Gv7fhyESxr7Wv/fp4C0bko2NmqI4JrrdwOiYkpEMcne3vXr4T7bVeI
bBdXIKcbnw/dWiWC5UwYq9IkFMj/J0JnTw==
     "]]}, 
   {RGBColor[0.880722, 0.611041, 0.142051], AbsoluteThickness[1.6], Opacity[
    1.], LineBox[CompressedData["
1:eJw11Xk41ekeAHCRZYYrUiTE7xcVYylmYpS+1pgky+DaXes49TyW3GmMMtZB
lmqKkiud04KE1JO9eGUn6zmWhJLsy1jO73dwkvveP+4f7/M+n3/e97s9z5fw
DXEIEBQQEIjA53+3BD9oQluqB2SdymqeXyDRAprcux3UA+7DZZGtQSRqtFnd
8o7oBaEgXbsNbxJJTfKlm1N6oTRjNsoH2+OK8CHNe71gpVTV1eZFIm7hvnPr
9b0AeW3vsj1JpCoGuTfE+0CL7rh9yp1E8W9ST9Xn9kGtnGFZmjOJulwzHQ4/
74MrjQbyPCcS7V/JDUxv6IORZ6tMH+wXyi+uuc70wU7fegV9RxJ9ujI0tnKM
DV/K5uom7EmkvefT6j/N2XC6acLUFjvy6bxIrTMbjt+fm622I9Hu4a/aKZfZ
EH3M+tFNWxKZ6qtFk01scFyI7DCzIdG1Lu1byYNsSHURDi09S6LhAIP8pVk2
KA4vGyhhH9oyqXH8woaRactDKdYkuphh3V0tyYGH/D0GvDMkqv3OaUKF4MCh
siOhl7C/bfDiJepx4ElnCfMUtrNbkPiiBQcSPCI5ItgPVsKUf3bhQI5Dmnj3
TyRaSr6sV3WeA/KsSYs72IYqf1oqR3GA8WNSvDd237mskHkWB+5K5ostW5FI
sKi2Ln6eA1sd4YbS2OfMWtmzWxzYmFa//s6SRNnDvdO2Uv0gMqEzzcLW/WZy
l+IP/aB8Woeli+0bKP6vl3/0g9MfskaOp0lUr+IiMCk9AJrXPPdmmeN6PjuP
pA4OgGfhjIM/do5RVMzJ7wdg8bbfraPYl9weCGQ4DwBLTFOpzYxEGhkLAmb/
GYArwUqOm6YkyhCN3cFSHYQ7PD07TxMSBS09EfTUH4LswdZEtVN4fl7xd/Z7
DIMxS1KhTp9EfLrvQrPQB2DbRtwU1yDRFrOlO7p9HGK7Rov7FUmUV9g41zs/
ATqxlzVqpUiklPC+XPXEFPgFZj+eEiLRaxPpnVp+MyARkLlfZ51AQUlV+q4x
c2B1dMBzfYFAH3MuKyZ2LICu/LOzxDiB4m57xAX9vQQmrHANxgCBNp49ffuY
uQzl+VE7tToIVO7ia63euAKfg6stbiACJYcXpIhyVsGNE/pZqoJAxpcuk1Ob
a6C8fOL3E8UEkhEYFdXbXgO1hItVcthTV08tRgtxgSSXBbhFBEq/t6NSXoIL
V+1aHxdhDzcm2dgocUHL/6DlAexwmYyIl8CFpVSjOcGnBMorLeqKS+CCDTVV
11tAoN8NJV92J3Oh9TV7oQT7bGPIXcV0LmzoWxJp2GuDuv7lmVyIcmtnnsY2
3q7cmM3jwiO1yM2afPyfTZOqfRsXtCWs9hfkEegf86ORypIUZNbw5RMfESim
gOXTupsCMcVff/HBXg0IsAqTo0Bca3ftSeyhjwt7G1QoKBF7k7j2kECPBvil
gXoUhDPMEn2wDd/ITxe7UGASoWYMDwhUHD3a6exJwU1NBUIBW8WI9XLbh4Ln
qd7iPBaBhCuPxNlfoICh+oFfgt1TrK9ERVFg+0nYRhn7l7tOP598SEE7OL3Y
wcTxO8sbTuZj911RH7uP898zqnKtiIJVzoHCamzd6/5LH8ooeKs32hKO/TUh
/Gp8KwXmn2/8OpVLoDBT/VDNTgriwt8ZNGB/3t507u+lQIT1QpiJ3RYZp3r4
PQU9W8QrV+yM0L/q2hcpiP1imtN5j0Ci2k554asUuJV7FRViR87vS1fkURAf
RjQnYXsHMt2CBWjo0cyXNcXuO+hvIidMw5/dITbK2Objh4+gb2goqZxL/5JD
oIrceUmGJA0Pa/YPvcPW8HhGScvQkFokqFmBfU8+fKRajgaZpP0+Y9hSg8cb
/BRp+NCvqg/4vfiMzScSBA0W9kaRTGzavvZGmRoNT1G8hiCOn7Er7jcvDRoq
uHJW/tgjby28RHVocGmRZzdj11t2fudqQEPE2OSxdFwv8zlPt4WTNKhL5On9
jd2ctpQcbUKD+333+/a4/m97d009PkPDv41VyuRwf4bcHZirHjTIufuOFuD+
LocM7kmLpeEAHXXiw2MCHcga36ptx/knRgvfw/MdOUN1q3ryoDXE7IlfDYGa
WpMZDB8eCF0/VzKELfVEQagkgAemmf6y514RKJ9hclw/mAfB8gpShq8JxJlL
y/kpmgeMsTtFsnUE0l48yAhm8UAjRZb16Q2BxlfsBSsnedBg3aPX3E4gK37x
99bB61B1XJ2qf08gvV0Pu+cvroOhVUuWxwiO72DW+bTf1oHrOVLJw147E8fs
jFmHpuf8YJ0xAuVmO0vY3VoHOWHBikcfCUT9uD3hWLkOcWIz/XmTBHoQYXfL
S3ADTmfts/12mUBb1OpK2O0NsDyq6OAsQqJm35aQtcJNCOZ9/ev+DyTKlOn/
KFLNh1Cfu4MpeL+eMY9RL8X+/779L6YJxKU=
     "]]}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., -9.210340371976184},
  CoordinatesToolOptions:>{"DisplayFunction" -> ({
      Exp[
       Part[#, 1]], 
      Exp[
       Part[#, 2]]}& ), "CopiedValueFunction" -> ({
      Exp[
       Part[#, 1]], 
      Exp[
       Part[#, 2]]}& )},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{
     Charting`ScaledTicks[{Log, Exp}], 
     Charting`ScaledFrameTicks[{Log, Exp}]}, {
     Charting`ScaledTicks[{Log, Exp}], 
     Charting`ScaledFrameTicks[{Log, Exp}]}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  Method->{"DefaultBoundaryStyle" -> Automatic, "ScalingFunctions" -> None},
  PlotRange->{{0., 
   3.4011973816621555`}, {-9.210340371976184, -6.907755278982137}},
  PlotRangeClipping->True,
  PlotRangePadding->{{0, 0}, {0, 0}},
  Ticks->FrontEndValueCache[{
     Charting`ScaledTicks[{Log, Exp}], 
     Charting`ScaledTicks[{Log, Exp}]}, {{{0., 
       FormBox["1", TraditionalForm], {0.01, 0.}, {
        AbsoluteThickness[0.1]}}, {0.6931471805599453, 
       FormBox["2", TraditionalForm], {0.01, 0.}, {
        AbsoluteThickness[0.1]}}, {1.6094379124341003`, 
       FormBox["5", TraditionalForm], {0.01, 0.}, {
        AbsoluteThickness[0.1]}}, {2.302585092994046, 
       FormBox["10", TraditionalForm], {0.01, 0.}, {
        AbsoluteThickness[0.1]}}, {2.995732273553991, 
       FormBox["20", TraditionalForm], {0.01, 0.}, {
        AbsoluteThickness[0.1]}}, {0.4054651081081644, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {1.0986122886681098`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {1.3862943611198906`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {1.791759469228055, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {1.9459101490553132`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {2.0794415416798357`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {2.1972245773362196`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {2.70805020110221, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {3.4011973816621555`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {3.6888794541139363`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {3.912023005428146, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}}, {{-8.517193191416238, 
       FormBox[
        TemplateBox[{"\[Times]", "\"\[Times]\"", "2.`", 
          TemplateBox[{"10", 
            RowBox[{"-", "4"}]}, "Superscript", SyntaxForm -> 
           SuperscriptBox]}, "RowWithSeparators"], TraditionalForm], {0.01, 
       0.}, {
        AbsoluteThickness[0.1]}}, {-7.824046010856292, 
       FormBox[
        TemplateBox[{"\[Times]", "\"\[Times]\"", "4.`", 
          TemplateBox[{"10", 
            RowBox[{"-", "4"}]}, "Superscript", SyntaxForm -> 
           SuperscriptBox]}, "RowWithSeparators"], TraditionalForm], {0.01, 
       0.}, {
        AbsoluteThickness[0.1]}}, {-7.418580902748128, 
       FormBox[
        TemplateBox[{"\[Times]", "\"\[Times]\"", "6.`", 
          TemplateBox[{"10", 
            RowBox[{"-", "4"}]}, "Superscript", SyntaxForm -> 
           SuperscriptBox]}, "RowWithSeparators"], TraditionalForm], {0.01, 
       0.}, {
        AbsoluteThickness[0.1]}}, {-7.1308988302963465`, 
       FormBox[
        TemplateBox[{"\[Times]", "\"\[Times]\"", "8.`", 
          TemplateBox[{"10", 
            RowBox[{"-", "4"}]}, "Superscript", SyntaxForm -> 
           SuperscriptBox]}, "RowWithSeparators"], TraditionalForm], {0.01, 
       0.}, {
        AbsoluteThickness[0.1]}}, {-6.907755278982137, 
       FormBox[
        TemplateBox[{"10", 
          RowBox[{"-", "3"}]}, "Superscript", SyntaxForm -> SuperscriptBox], 
        TraditionalForm], {0.01, 0.}, {
        AbsoluteThickness[0.1]}}, {-9.903487552536127, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-9.210340371976182, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-8.804875263868018, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-8.294049640102028, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-8.111728083308073, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.957577403480815, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.706262975199909, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.600902459542082, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.505592279737757, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.338538195074591, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.264430222920869, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.195437351433918, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.070274208479912, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-7.013115794639964, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-6.959048573369688, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-6.8589651148127055`, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-6.812445099177812, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-6.767993336606978, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}, {-6.725433722188183, 
       FormBox[
        InterpretationBox[
         StyleBox[
          
          GraphicsBox[{}, ImageSize -> {0., 0.}, BaselinePosition -> 
           Baseline], "CacheGraphics" -> False], 
         Spacer[{0., 0.}]], TraditionalForm], {0.005, 0.}, {
        AbsoluteThickness[0.1]}}}}]]], "Output",
 CellChangeTimes->{
  3.625851112304181*^9, {3.6258514893364887`*^9, 3.625851516401904*^9}, 
   3.625851566027506*^9, 3.6259437448846455`*^9, 3.626758147330715*^9, 
   3.626802868194791*^9, 3.6268142157021694`*^9, 3.6287166672601604`*^9, 
   3.6287461696620264`*^9, 3.6290518992065177`*^9, 3.6295667560257764`*^9, 
   3.6295674725454235`*^9, 3.629567511369372*^9, 3.6295677263686996`*^9, 
   3.6295681889160433`*^9, 3.629568703187727*^9, 3.629568926150182*^9, 
   3.629577007254352*^9, 3.6295774768136983`*^9, 3.6295780987811794`*^9, 
   3.6295782043897066`*^9, 3.629578499564011*^9, 3.6295785829983525`*^9, 
   3.6295786192506247`*^9, 3.629578851512019*^9, 3.6295792395297985`*^9, 
   3.6295797973843884`*^9, 3.629580129130515*^9, 3.629580408699718*^9, 
   3.6296916821014614`*^9, 3.629739408441119*^9, 3.629739845204541*^9, {
   3.6297399541633787`*^9, 3.629739960988747*^9}, 3.6297419412733316`*^9, 
   3.6298715010961475`*^9, 3.6298736779367685`*^9, 3.630432534191805*^9, 
   3.630434153930111*^9, 3.6304389860136275`*^9, 3.630777947010989*^9, 
   3.63078865304324*^9, 3.6307912809656115`*^9, 3.630852215401128*^9, 
   3.630886460557255*^9, 3.631130458196739*^9, 3.6312558783007708`*^9, 
   3.631290686180315*^9, 3.63155614496358*^9, 3.632168626602407*^9, 
   3.632670034028997*^9, 3.632670167775601*^9, 3.6327750053364897`*^9, 
   3.633739121250486*^9, 3.633787066712772*^9, 3.635554880200083*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["BottomlessMinEnv", "Subsubsection",
 CellChangeTimes->{{3.631559197882587*^9, 3.631559201467593*^9}}],

Cell["\<\
This accounts for the fact that Simona\[CloseCurlyQuote]s green line goes off \
the chart at 14 GeV, so we should consider it effectively zero for the \
purposes of envelopes. \
\>", "Text",
 CellChangeTimes->{{3.631559203166547*^9, 3.6315592387657223`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MinEnv", "[", "x_", "]"}], ":=", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"BluLin", "[", "x", "]"}], ",", 
         RowBox[{"RedLin", "[", "x", "]"}], ",", 
         RowBox[{"GreLin", "[", "x", "]"}]}], "]"}], ",", 
       RowBox[{"x", "<", "14"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"x", ">", "14"}]}], "}"}]}], "}"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.631559241167309*^9, 3.6315592550094833`*^9}, {
  3.631559287187744*^9, 3.631559338086738*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Map on to GeV", "Subsubsection",
 CellChangeTimes->{{3.6326721697953863`*^9, 3.6326721732059402`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MeVtoGeV", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "3"}]]}], ";"}]], "Input",
 CellChangeTimes->{3.632672200406666*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MaxEnv", "[", "x_", "]"}], ":=", 
  RowBox[{"MeVtoGeV", " ", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{"BluLin", "[", "x", "]"}], ",", 
     RowBox[{"RedLin", "[", "x", "]"}], ",", 
     RowBox[{"GreLin", "[", "x", "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MinEnv", "[", "x_", "]"}], ":=", 
  RowBox[{"MeVtoGeV", " ", 
   RowBox[{"Piecewise", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"BluLin", "[", "x", "]"}], ",", 
          RowBox[{"RedLin", "[", "x", "]"}], ",", 
          RowBox[{"GreLin", "[", "x", "]"}]}], "]"}], ",", 
        RowBox[{"x", "<", "14"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"x", ">", "14"}]}], "}"}]}], "}"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.632672194478837*^9, 3.632672208216037*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Normalization Code", "Section",
 CellChangeTimes->{{3.631256304020396*^9, 3.631256309021913*^9}, 
   3.631258167843336*^9}],

Cell["\<\
From Flip: I\[CloseCurlyQuote]m just re-writing the \
\[OpenCurlyDoubleQuote]Normalization test code\[CloseCurlyDoubleQuote] \
section to make it understandable to me. I\[CloseCurlyQuote]ve taken Jordan\
\[CloseCurlyQuote]s code and re-implemented it in a more modular way. I\
\[CloseCurlyQuote]ve also made it more flexible by forcing the functions to \
take more arguments, i.e. nothing hard-coded.\
\>", "Text",
 CellChangeTimes->{{3.631258162697804*^9, 3.631258187228321*^9}, {
  3.631258979035988*^9, 3.631258985567545*^9}, {3.631289905301256*^9, 
  3.631289944584281*^9}}],

Cell[CellGroupData[{

Cell["Generate a range of normalizations with respect to one point", \
"Subsection",
 CellChangeTimes->{{3.631260963664186*^9, 3.631260971215535*^9}}],

Cell[TextData[{
 StyleBox["RangeOfNorms",
  FontWeight->"Bold"],
 " outputs a list of normalizations for a function. These normalizations are \
chosen such that the function is between ",
 StyleBox["MinFun/A",
  FontSlant->"Italic"],
 " and ",
 StyleBox["A*Max",
  FontSlant->"Italic"],
 " at a point testE. Note that the envelope functions are assumed to already \
give ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["E", "2"], 
    RowBox[{"dN", "/", "dE"}]}], TraditionalForm]]],
 " so had to make sure that the ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["E", "2"], TraditionalForm]]],
 " is included in the comparison. \n\nUpdate: changed this to a log scale.\n\n\
",
 StyleBox["MinMaxNorms",
  FontWeight->"Bold"],
 " assumes the MinEnv and MaxEnv functions above and testing at E=1. This is \
tested agianst Sieve in Jordan\[CloseCurlyQuote]s functions."
}], "Text",
 CellChangeTimes->{{3.631258987244027*^9, 3.631259052697489*^9}, {
  3.6312591379945717`*^9, 3.6312591719350653`*^9}, {3.631259333802127*^9, 
  3.631259362318033*^9}, {3.631259532335248*^9, 3.63125956056736*^9}, {
  3.63284060881275*^9, 3.632840616123043*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"RangeOfNorms", "[", 
     RowBox[{
     "fun_", ",", "MinFun_", ",", "MaxFun_", ",", "A_", ",", "testE_", ",", 
      "numdiv_"}], "]"}], ":=", 
    RowBox[{"Range", "[", 
     RowBox[{
      FractionBox[
       RowBox[{"MinFun", "[", "testE", "]"}], 
       RowBox[{"A", "  ", 
        SuperscriptBox["testE", "2"], 
        RowBox[{"fun", "[", "testE", "]"}]}]], ",", 
      FractionBox[
       RowBox[{"A", " ", 
        RowBox[{"MaxFun", "[", "testE", "]"}]}], 
       RowBox[{
        SuperscriptBox["testE", "2"], 
        RowBox[{"fun", "[", "testE", "]"}]}]], ",", 
      FractionBox[
       RowBox[{
        RowBox[{"A", " ", 
         RowBox[{"MaxFun", "[", "testE", "]"}]}], "-", 
        RowBox[{
         RowBox[{"MinFun", "[", "testE", "]"}], "/", "A"}]}], 
       RowBox[{"numdiv", "  ", 
        SuperscriptBox["testE", "2"], 
        RowBox[{"fun", "[", "testE", "]"}]}]]}], "]"}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RangeOfNorms", "[", 
     RowBox[{
     "fun_", ",", "MinFun_", ",", "MaxFun_", ",", "A_", ",", "testE_", ",", 
      "numdiv_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      SuperscriptBox["10", "#"], "&"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", 
         FractionBox[
          RowBox[{"MinFun", "[", "testE", "]"}], 
          RowBox[{"A", "  ", 
           SuperscriptBox["testE", "2"], 
           RowBox[{"fun", "[", "testE", "]"}]}]]}], "]"}], ",", 
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", 
         FractionBox[
          RowBox[{"A", " ", 
           RowBox[{"MaxFun", "[", "testE", "]"}]}], 
          RowBox[{
           SuperscriptBox["testE", "2"], 
           RowBox[{"fun", "[", "testE", "]"}]}]]}], "]"}], ",", 
       FractionBox[
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", 
           FractionBox[
            RowBox[{"A", " ", 
             RowBox[{"MaxFun", "[", "testE", "]"}]}], 
            RowBox[{
             SuperscriptBox["testE", "2"], 
             RowBox[{"fun", "[", "testE", "]"}]}]]}], "]"}], "-", 
         RowBox[{"Log", "[", 
          RowBox[{"10", ",", 
           FractionBox[
            RowBox[{"MinFun", "[", "testE", "]"}], 
            RowBox[{"A", "  ", 
             SuperscriptBox["testE", "2"], 
             RowBox[{"fun", "[", "testE", "]"}]}]]}], "]"}]}], "numdiv"]}], 
      "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MinMaxNorms", "[", 
     RowBox[{"fun_", ",", "A_", ",", "numdiv_"}], "]"}], ":=", 
    RowBox[{"RangeOfNorms", "[", 
     RowBox[{
     "fun", ",", "MinEnv", ",", "MaxEnv", ",", "A", ",", "1", ",", "numdiv"}],
      "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.631258234520863*^9, 3.6312582405188704`*^9}, {
  3.631258485555285*^9, 3.631258661993301*^9}, {3.631259381212303*^9, 
  3.631259421418223*^9}, {3.6312594702900667`*^9, 3.6312594765893307`*^9}, {
  3.63155753554346*^9, 3.6315575357050943`*^9}, {3.63284062558471*^9, 
  3.6328406629253283`*^9}, {3.632840703329414*^9, 3.632840729417836*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Check if a function and normalization fit the envelope over a range\
\>", "Subsection",
 CellChangeTimes->{{3.631260978067141*^9, 3.631260997294415*^9}}],

Cell[TextData[{
 "Create a function that inputs a function (spectrum) and determines whether \
it fits in the envelope given by  ",
 Cell[BoxData[
  FormBox[
   FractionBox["1", "A"], TraditionalForm]]],
 "MinEnv < f < A MaxEnv for a given value of A.\n\nStrategy: sample over \
several points in the range of interest. The functions are smooth enough that \
you don\[CloseCurlyQuote]t need to sample many points, but this is \
computationally inexpensive, anyway.\n\nSample between minE and maxE, the new \
function samples on a log scale.\n\n",
 StyleBox["Note",
  FontWeight->"Bold"],
 ": do NOT sample the function beyond the kinematic limit, i.e. if you ask \
questions about energies above the dark matter mass, then the spectrum = 0 \
and you don\[CloseCurlyQuote]t pass the \[OpenCurlyDoubleQuote]Minimum\
\[CloseCurlyDoubleQuote] envelope, even though this is silly. I should \
probably only ask about normalizations up to 20 or 30 GeV.\n\n",
 StyleBox["NOTE",
  FontWeight->"Bold"],
 ": Actually, a better way to do this is to use a MinEnv that goes to zero \
above 14, which is the last data point extracted from \
Simona\[CloseCurlyQuote]s plot.\n\n",
 StyleBox["Note: ",
  FontWeight->"Bold"],
 "Shouldn\[CloseCurlyQuote]t ask about minE below 1 (technically below 1.15) \
or else you\[CloseCurlyQuote]re asking outside of the interpolation."
}], "Text",
 CellChangeTimes->{{3.631260998450633*^9, 3.63126103363986*^9}, {
  3.631261822944725*^9, 3.631261841220943*^9}, {3.6312898137244883`*^9, 
  3.631289891027198*^9}, {3.631559143644847*^9, 3.6315591716111917`*^9}, {
  3.631559488422793*^9, 3.631559490041388*^9}, {3.6316500485131397`*^9, 
  3.631650070376062*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"InEnvelope", "[", 
    RowBox[{
    "function_", ",", "MinFun_", ",", "MaxFun_", ",", " ", "norm_", ",", "A_",
      ",", " ", "numpoints_", ",", "minE_", ",", "maxE_"}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{"<", " ", 
      RowBox[{"30", "!"}]}], " ", "*)"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "samplepoints", ",", " ", "bunchobooleans", ",", " ", "newnorm", ",", 
       RowBox[{"coeff", "=", "A"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"newnorm", "=", "norm"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"samplepoints", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             FractionBox["49", "numpoints"], "#"}], "+", "1"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"1", ",", " ", "51"}], "]"}]}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Identify", " ", "log", " ", "sampling", " ", "in", " ", "E\[Gamma]"}],
        " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"samplepoints", "=", 
       RowBox[{
        RowBox[{
         SuperscriptBox["10", "#"], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "minE"}], "]"}], ",", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "maxE"}], "]"}], ",", 
          FractionBox[
           RowBox[{
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "maxE"}], "]"}], "-", 
            RowBox[{"Log", "[", 
             RowBox[{"10", ",", "minE"}], "]"}]}], "numpoints"]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"bunchobooleans", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"newnorm", " ", 
              SuperscriptBox["#", "2"], 
              RowBox[{"function", "[", "#", "]"}]}], ")"}], "-", 
            FractionBox[
             RowBox[{"MinFun", "[", "#", "]"}], "A"]}], "\[GreaterEqual]", 
           "0"}], " ", 
          RowBox[{"(*", 
           RowBox[{"\[GreaterEqual]", " ", 
            RowBox[{"for", " ", "zero", " ", "case"}]}], "*)"}], " ", "&&", 
          " ", 
          RowBox[{
           RowBox[{
            RowBox[{"A", " ", 
             RowBox[{"MaxFun", "[", "#", "]"}]}], "-", 
            RowBox[{"(", 
             RowBox[{"newnorm", " ", 
              SuperscriptBox["#", "2"], 
              RowBox[{"function", "[", "#", "]"}]}], ")"}]}], ">", "0"}]}], 
         " ", "&"}], "/@", "samplepoints"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"AllTrue", "[", 
       RowBox[{"bunchobooleans", ",", "TrueQ"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"shortcut", " ", "version"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InMinMaxEnv", "[", 
   RowBox[{
   "fun_", ",", "norm_", ",", "A_", ",", "numpoints_", ",", "minE_", ",", 
    "maxE_"}], "]"}], ":=", 
  RowBox[{"InEnvelope", "[", 
   RowBox[{
   "fun", ",", "MinEnv", ",", "MaxEnv", ",", "norm", ",", "A", ",", 
    "numpoints", ",", "minE", ",", "maxE"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.631261051023797*^9, 3.6312610731354513`*^9}, {
   3.631261218643993*^9, 3.6312612235508413`*^9}, {3.631261356666671*^9, 
   3.631261359558525*^9}, {3.631261607011342*^9, 3.631261639604741*^9}, {
   3.6312874980256147`*^9, 3.631287584070064*^9}, 3.63128871203321*^9, {
   3.631288885040077*^9, 3.6312888979927692`*^9}, {3.6312891169558783`*^9, 
   3.631289124644273*^9}, {3.6312892260044813`*^9, 3.631289263398918*^9}, {
   3.6312902376393347`*^9, 3.6312902547733727`*^9}, {3.631559580275175*^9, 
   3.6315595905011053`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Get the good normalizations", "Subsection",
 CellChangeTimes->{{3.6312876511655703`*^9, 3.6312876543284082`*^9}}],

Cell["\<\
Takes a list of normalizations and outputs the list of those which stay \
within the envelope at all sampling points as described by the parameters of \
InEnvelope.\
\>", "Text",
 CellChangeTimes->{{3.6312882833973007`*^9, 3.631288310315735*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GoodNorms", "[", 
    RowBox[{
    "function_", ",", "MinEnv_", ",", "MaxEnv_", ",", "A_", ",", 
     "listofnorms_", ",", "numpoints_", ",", "minE_", ",", "maxE_"}], "]"}], ":=",
    "\[IndentingNewLine]", 
   RowBox[{"Select", "[", 
    RowBox[{"listofnorms", ",", 
     RowBox[{
      RowBox[{"InEnvelope", "[", 
       RowBox[{
       "function", ",", "MinEnv", ",", "MaxEnv", ",", "#", ",", "A", ",", 
        "numpoints", ",", "minE", ",", "maxE"}], "]"}], "&"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BadNorms", "[", 
   RowBox[{
   "function_", ",", "MinEnv_", ",", "MaxEnv_", ",", "A_", ",", 
    "listofnorms_", ",", "numpoints_", ",", "minE_", ",", "maxE_"}], "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Select", "[", 
   RowBox[{"listofnorms", ",", 
    RowBox[{
     RowBox[{"!", 
      RowBox[{"InEnvelope", "[", 
       RowBox[{
       "function", ",", "MinEnv", ",", "MaxEnv", ",", "#", ",", "A", ",", 
        "numpoints", ",", "minE", ",", "maxE"}], "]"}]}], "&"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.631287663004691*^9, 3.631287694101242*^9}, {
   3.6312879170228977`*^9, 3.631287950994069*^9}, {3.631288152016171*^9, 
   3.63128823602501*^9}, 3.6312884764304953`*^9, {3.631291204563048*^9, 
   3.631291211228215*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plotting the whole thing", "Subsection",
 CellChangeTimes->{{3.6312912542044764`*^9, 3.631291259769402*^9}, {
  3.631291408835237*^9, 3.631291409303046*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SuperPlot", "[", 
   RowBox[{
   "func_", ",", "norms_", ",", "MinEnv_", ",", "MaxEnv_", ",", "A_", ",", 
    "numchecks_", ",", "minE_", ",", "maxE_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"goodnorms", ",", "badnorms"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"goodnorms", "=", 
      RowBox[{"GoodNorms", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "A", ",", "norms", ",", 
        "numchecks", ",", "minE", ",", "maxE"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"badnorms", "=", 
      RowBox[{"BadNorms", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "A", ",", "norms", ",", 
        "numchecks", ",", "minE", ",", "maxE"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"LogLogPlot", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"Join", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             SuperscriptBox["x", "2"], 
             RowBox[{"func", "[", "x", "]"}], "#"}], "&"}], "/@", 
           "goodnorms"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             SuperscriptBox["x", "2"], 
             RowBox[{"func", "[", "x", "]"}], "#"}], "&"}], "/@", 
           "badnorms"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            FractionBox[
             RowBox[{"MinEnv", "[", "x", "]"}], "A"], ",", 
            RowBox[{"A", " ", 
             RowBox[{"MaxEnv", "[", "x", "]"}]}]}], "}"}]}], "]"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"x", ",", "minE", ",", "maxE"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"Join", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Good", " ", 
           RowBox[{"Curves", ":"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Darker", "[", "Green", "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "goodnorms", "]"}]}], "}"}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"Bad", " ", "Curves"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"AbsoluteThickness", "[", "Small", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "badnorms", "]"}]}], "}"}]}], "]"}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"Min", "/", "Max"}], " ", 
            RowBox[{"curves", ":"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "Black", "}"}], ",", 
            RowBox[{"{", "Black", "}"}]}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"minE", ",", "maxE"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MeVtoGeV", " ", "6", " ", 
             SuperscriptBox["10", 
              RowBox[{"-", "6"}]]}], ",", 
            RowBox[{"MeVtoGeV", " ", 
             SuperscriptBox["10", 
              RowBox[{"-", "3"}]]}]}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"BaseStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
          RowBox[{"FontSize", "\[Rule]", "12"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
       RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"GridLinesStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Gray", ",", "Dotted"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Gray", ",", "Dotted"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Photon Energy [GeV]\>\"", ",", 
          "\"\<Flux [GeV/\!\(\*SuperscriptBox[\(cm\), \(2\)]\)/s]\>\""}], 
         "}"}]}]}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], "*)"}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.631291413474527*^9, 3.631291592301799*^9}, {
   3.63130297259413*^9, 3.631303117481454*^9}, {3.631303194867569*^9, 
   3.631303357118462*^9}, {3.631303388454154*^9, 3.6313034169011583`*^9}, {
   3.6313034476481037`*^9, 3.631303477339302*^9}, {3.631303566023973*^9, 
   3.631303595584466*^9}, {3.631308144619357*^9, 3.631308156370762*^9}, {
   3.631308231618408*^9, 3.6313082858183002`*^9}, {3.631308324592957*^9, 
   3.631308344481248*^9}, {3.631308411739846*^9, 3.631308417132895*^9}, {
   3.631308557143319*^9, 3.631308829394123*^9}, {3.631308868119084*^9, 
   3.631308898310441*^9}, {3.631309118301186*^9, 3.631309122414308*^9}, {
   3.631309206148875*^9, 3.6313092087103577`*^9}, {3.6313092766955643`*^9, 
   3.631309277421978*^9}, {3.631309355010654*^9, 3.6313094260793*^9}, {
   3.6313095029690847`*^9, 3.631309525970442*^9}, 3.63130955907635*^9, {
   3.63130971792656*^9, 3.6313097216454973`*^9}, {3.631310597632531*^9, 
   3.631310711402351*^9}, {3.631580985731777*^9, 3.6315810215670357`*^9}, {
   3.631581561531136*^9, 3.631581605082121*^9}, {3.631581652738405*^9, 
   3.631581662508093*^9}, {3.632672248023652*^9, 3.6326722666143312`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Tools", "Section",
 CellChangeTimes->{{3.631383726094804*^9, 3.631383726659433*^9}}],

Cell[CellGroupData[{

Cell[TextData[StyleBox["From from parameter point to filename", \
"Subsection"]], "Subsection",
 CellChangeTimes->{3.63269620462449*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Filename", "[", 
    RowBox[{"path_", ",", "parampoint_"}], "]"}], ":=", 
   RowBox[{"path", "<>", "\"\<_\>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"parampoint", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "<>", "\"\<_\>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"parampoint", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "]"}], "<>", "\"\<.dat\>\""}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllFilesExist", "[", "listofpaths_", "]"}], ":=", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"FileExistsQ", "[", "#", "]"}], "&"}], "/@", "listofpaths"}], 
    ",", "TrueQ"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.631383344989367*^9, 3.631383402212296*^9}, {
   3.63138345145258*^9, 3.631383534059821*^9}, 3.631383701677486*^9, {
   3.631384576655858*^9, 3.631384625988792*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Primitive Tag", "Subsection",
 CellChangeTimes->{{3.632696210228396*^9, 3.6326962125691843`*^9}}],

Cell["\<\
Output model, final state, parameter point, and filename as an early tag.\
\>", "Text",
 CellChangeTimes->{{3.631384001620985*^9, 3.631384003416273*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreTag", "[", 
   RowBox[{
   "mediator_", ",", "finalstate_", ",", "parameterpoint_", ",", "path_"}], 
   "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"{", 
   RowBox[{"mediator", ",", "finalstate", ",", "parameterpoint", ",", 
    RowBox[{"Filename", "[", 
     RowBox[{"path", ",", "parameterpoint"}], "]"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.631383992092527*^9, 3.631384072068035*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Retrieve Interpolating Function ", "Subsection",
 CellChangeTimes->{{3.6326962171742496`*^9, 3.632696221393015*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetFunc", "[", 
   RowBox[{"path_", ",", "parampoint_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"ReadIt", "[", 
    RowBox[{"Filename", "[", 
     RowBox[{"path", ",", "parampoint"}], "]"}], "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.631557063569139*^9, 3.631557096901436*^9}, {
  3.6315572811495667`*^9, 3.631557312726796*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Get Good Norms Functions", "Subsection",
 CellChangeTimes->{{3.632696226156417*^9, 3.632696229373726*^9}}],

Cell[CellGroupData[{

Cell["Get Good Norms", "Subsubsection",
 CellChangeTimes->{{3.63158213832655*^9, 3.631582139937131*^9}, {
  3.6315828446960297`*^9, 3.6315828499325933`*^9}}],

Cell["\<\
Reminder: A is the wiggle room in the Min and Max envelope (2), testpoint is \
where you sample norms (2 is good), numdiv is the number of lines to check \
(20), numpoints is the number of energies to check the envelope (20), minE \
and maxE are the ranges of energies to check (1,30).\
\>", "Text",
 CellChangeTimes->{{3.632671496175993*^9, 3.632671564850875*^9}, {
  3.6326953494612913`*^9, 3.632695369550456*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetGoodNorms", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "A_", ",", "testpoint_", 
     ",", " ", "numdiv_", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"fine", " ", "graining"}], " ", "*)"}], ",", "numpoints_", ",", 
     "minE_", ",", "maxE_"}], "]"}], ":=", 
   RowBox[{"GoodNorms", "[", 
    RowBox[{
    "func", ",", "MinEnv", ",", "MaxEnv", ",", "A", ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"list", " ", "of", " ", "norms"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"RangeOfNorms", "[", 
      RowBox[{
      "func", ",", "MinEnv", ",", "MaxEnv", ",", "A", ",", "testpoint", ",", 
       "numdiv"}], "]"}], ",", "\[IndentingNewLine]", "numpoints", ",", 
     "\[IndentingNewLine]", "minE", ",", "\[IndentingNewLine]", "maxE"}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GetNormsShort", "[", 
     RowBox[{"path_", ",", "parampoint_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"GetGoodNorms", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"GetFunc", "[", 
         RowBox[{"path", ",", "parampoint"}], "]"}], ",", 
        "\[IndentingNewLine]", "MinEnv", ",", "MaxEnv", ",", 
        "\[IndentingNewLine]", "2", ",", " ", 
        RowBox[{"(*", " ", "A", " ", "*)"}], "\[IndentingNewLine]", "2", ",", 
        " ", 
        RowBox[{"(*", " ", 
         RowBox[{"test", " ", "point"}], " ", "*)"}], "\[IndentingNewLine]", 
        "30", ",", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"num", " ", "slices"}], " ", "*)"}], "\[IndentingNewLine]", 
        "30", ",", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"num", " ", "energies", " ", "to", " ", "test"}], " ", 
         "*)"}], "\[IndentingNewLine]", "1", ",", 
        RowBox[{"(*", " ", 
         RowBox[{"minimum", " ", "energy", " ", "to", " ", "test"}], " ", 
         "*)"}], " ", "\[IndentingNewLine]", "100"}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{"maximum", " ", "energy", " ", "to", " ", "test"}], " ", 
        "*)"}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"GetRangeShort", "[", 
       RowBox[{"path_", ",", "parampoint_"}], "]"}]}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Min", "[", 
        RowBox[{"GetNormsShort", "[", 
         RowBox[{"path", ",", "parampoint"}], "]"}], "]"}], ",", 
       RowBox[{"Max", "[", 
        RowBox[{"GetNormsShort", "[", 
         RowBox[{"path", ",", "parampoint"}], "]"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.6315829608675337`*^9, 3.631583003972736*^9}, {
  3.631583037822214*^9, 3.6315830719969*^9}, {3.631649429940846*^9, 
  3.631649448996414*^9}, {3.631649485760687*^9, 3.631649529911014*^9}, {
  3.631650554662909*^9, 3.631650554894702*^9}, {3.632696274304226*^9, 
  3.63269627808956*^9}, {3.6326964079384613`*^9, 3.6326964730013647`*^9}, {
  3.632758059719922*^9, 3.63275810426551*^9}, {3.632758659504499*^9, 
  3.632758662495018*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Get Good Norms Short", "Subsubsection",
 CellChangeTimes->{{3.632696428207066*^9, 3.6326964364963083`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Awiggle", "=", "2"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "fudge", " ", "factor", " ", "in", " ", "the", " ", 
    "normalizations"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"testpoint", "=", "2"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "2", " ", "GeV", " ", "is", " ", "where", " ", "to", " ", "sample", " ", 
    "a", " ", "range", " ", "of", " ", "norms"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"numSlices", "=", "30"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"#", " ", "of", " ", "lines", " ", "to", " ", "test"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"numSamples", "=", "20"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"#", " ", "energies", " ", "to", " ", "test"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"minE", "=", "1"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"to", " ", "sample", " ", "fits"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"maxE", "=", "35"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"to", " ", "sample", " ", "fits"}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetGoodNormShort", "[", 
    RowBox[{"path_", ",", "param_"}], "]"}], ":=", 
   RowBox[{"GetGoodNorms", "[", 
    RowBox[{
     RowBox[{"GetFunc", "[", 
      RowBox[{"path", ",", "param"}], "]"}], ",", "MinEnv", ",", "MaxEnv", 
     ",", "Awiggle", ",", "testpoint", ",", "numSlices", ",", "numSamples", 
     ",", "minE", ",", "maxE"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetGoodNormRange", "[", 
   RowBox[{"path_", ",", "param_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Max", "[", 
     RowBox[{"GetGoodNormShort", "[", 
      RowBox[{"path", ",", "param"}], "]"}], "]"}], ",", 
    RowBox[{"Min", "[", 
     RowBox[{"GetGoodNormShort", "[", 
      RowBox[{"path", ",", "param"}], "]"}], "]"}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.6326773381448402`*^9, 3.632677403916798*^9}, {
  3.6326774600220947`*^9, 3.632677549213236*^9}, {3.6326775977039547`*^9, 
  3.6326776469058104`*^9}, {3.632695316647585*^9, 3.6326953387326202`*^9}, {
  3.632695378848665*^9, 3.632695386903305*^9}, {3.6326958012142487`*^9, 
  3.63269581517253*^9}, {3.632696037875762*^9, 3.632696048628318*^9}, {
  3.6326960899941463`*^9, 3.632696122317432*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Find minimum A for fit", "Subsection",
 CellChangeTimes->{{3.632750961345441*^9, 3.632750966277607*^9}}],

Cell[TextData[{
 "This is a good measure for how much fudge factor do we need in order to get \
a given curve to fit inside envelope. In other words, the minimum A measures \
how big the envelope has to be in order for the curves to fit into the \
envelope while allowing their overall normalization to float. \n\nTo say it \
physically: this tells me about compatibility of the shape of the spectrum \
without regard to the overall normalization.\n\nThe idea: Run ",
 StyleBox["GetGoodNorms ",
  FontWeight->"Bold"],
 "with different values of A and find the minimum value (to some given \
precision) that gives the requisite wiggle room in the window. \n\nI\
\[CloseCurlyQuote]m not sophisticated enough to implement a nice \
divide-and-conquer search algorithm for this, so I\[CloseCurlyQuote]ll just \
hard code it in multiple stages by order of magnitude in precision. "
}], "Text",
 CellChangeTimes->{{3.632751449963533*^9, 3.632751538028613*^9}, {
  3.632751654046043*^9, 3.632751741086445*^9}}],

Cell[CellGroupData[{

Cell["Saved Version", "Subsubsection",
 CellChangeTimes->{{3.632838346277281*^9, 3.6328383503817177`*^9}, {
  3.632838775547112*^9, 3.6328387789245243`*^9}, {3.632844705616489*^9, 
  3.6328447070259933`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetMinA1", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
     "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AA", "=", "0"}], ",", 
       RowBox[{"Dec", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "\[IndentingNewLine]", 
          RowBox[{"GetGoodNorms", "[", 
           RowBox[{"func", ",", "MinEnv", ",", "MaxEnv", ",", 
            RowBox[{"1", "+", 
             RowBox[{"Dec", " ", "AA"}]}], ",", " ", "testpoint", ",", " ", 
            "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}],
           "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"1", ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"do", " ", "nothing"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AA", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"AA", "==", "0"}], ",", "0", ",", 
        RowBox[{"AA", "-", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "some", " ", "special", " ", "cases", " ", "pass", " ", "for", " ", 
       "norm"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"1", " ", "+", " ", 
        RowBox[{"Dec", " ", "AA"}]}], " ", "=", " ", "1"}]}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
       "in", " ", "this", " ", "case", " ", "we", " ", "say", " ", "that", 
        " ", "norm"}], " ", "\[Equal]", " ", "1"}], ",", " ", 
      RowBox[{"not", " ", "zero"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"then", " ", "because", " ", "we", " ", "use", " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", "A1"}], ")"}], " ", "as", " ", "the", " ", "norm"}],
       ",", " ", 
      RowBox[{
      "we", " ", "need", " ", "to", " ", "set", " ", "AA", " ", "to", " ", 
       "0"}]}], " ", "*)"}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetMinA01", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
     "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_", ",", 
     "A1_"}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{"output", " ", "of", " ", "previous", " ", "func"}], " ", "*)"}],
     "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AA", "=", "0"}], ",", 
       RowBox[{"Dec", "=", ".1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "\[IndentingNewLine]", 
          RowBox[{"GetGoodNorms", "[", 
           RowBox[{"func", ",", "MinEnv", ",", "MaxEnv", ",", 
            RowBox[{"1", " ", "+", "A1", "+", 
             RowBox[{"Dec", " ", "AA"}]}], ",", " ", "testpoint", ",", " ", 
            "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}],
           "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"1", ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"do", " ", "nothing"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AA", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"AA", "\[Equal]", "0"}], ",", "0", ",", 
        RowBox[{"AA", "-", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetMinA001", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
     "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_", ",", "A1_",
      ",", "A01_"}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{"output", " ", "of", " ", "previous", " ", "func"}], " ", "*)"}],
     "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AA", "=", "0"}], ",", 
       RowBox[{"Dec", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "\[IndentingNewLine]", 
          RowBox[{"GetGoodNorms", "[", 
           RowBox[{"func", ",", "MinEnv", ",", "MaxEnv", ",", 
            RowBox[{"1", " ", "+", "A1", "+", 
             RowBox[{".1", " ", "A01"}], "+", 
             RowBox[{"Dec", " ", "AA"}]}], ",", " ", "testpoint", ",", " ", 
            "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}],
           "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"1", ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"do", " ", "nothing"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AA", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AA", "-", "1"}]}]}], " ", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Put", " ", "these", " ", "all", " ", "together"}], " ", 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.632752632320568*^9, 3.63275282515874*^9}, {
  3.6327529214680862`*^9, 3.632752963101183*^9}, {3.632753031666554*^9, 
  3.632753158024044*^9}, {3.632753193904398*^9, 3.632753230862359*^9}, {
  3.632753268701097*^9, 3.632753304821425*^9}, {3.632835513953051*^9, 
  3.6328356185349607`*^9}, {3.632835748177829*^9, 3.632835752777733*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMinA", "[", 
   RowBox[{
   "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
    "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A1", ",", "A01", ",", "A001"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A1", "=", 
      RowBox[{"GetMinA1", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
        "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"A01", "=", 
      RowBox[{"GetMinA01", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
        "numSlices", ",", "numSamples", ",", "minE", ",", "maxE", ",", "A1"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"A001", "=", 
      RowBox[{"GetMinA001", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
        "numSlices", ",", "numSamples", ",", "minE", ",", "maxE", ",", "A1", 
        ",", "A01"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"1", "+", "A1", "+", 
      RowBox[{".1", " ", "A01"}], " ", "+", " ", 
      RowBox[{".01", 
       RowBox[{"(", 
        RowBox[{"A001", "+", "1"}], " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "to", " ", "give", " ", "the", " ", "first", " ", "nonzero", " ", 
          "value"}], " ", "*)"}], ")"}]}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.632753486198041*^9, 3.632753516413951*^9}, {
  3.6327538950972013`*^9, 3.632753957723195*^9}, {3.632754024871085*^9, 
  3.632754035997674*^9}}],

Cell["\<\
Actually, an alternate estimated measure of the same quantity is to just \
check the size of GetGoodNorms---the bigger the spread the less wiggle room \
you need.\
\>", "Text",
 CellChangeTimes->{{3.632755867104087*^9, 3.6327558993619213`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["New Version: hard stop when you get to large numbers", "Subsubsection",
 CellChangeTimes->{{3.632838346277281*^9, 3.6328383503817177`*^9}, {
  3.632838775547112*^9, 3.6328387789245243`*^9}, {3.632844705616489*^9, 
  3.6328447223124943`*^9}}],

Cell["\<\
This now stops at A=10 so there are no more runaways. Thus if the minimum A = \
10, then you should treat this as \[OpenCurlyDoubleQuote]effectively \
impossible to find an envelope that works.\[CloseCurlyDoubleQuote]\
\>", "Text",
 CellChangeTimes->{{3.632845916292904*^9, 3.632845928852257*^9}, {
  3.632846460428019*^9, 3.632846480349337*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetMinA1", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
     "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AA", "=", "0"}], ",", 
       RowBox[{"Dec", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "\[IndentingNewLine]", 
           RowBox[{"GetGoodNorms", "[", 
            RowBox[{"func", ",", "MinEnv", ",", "MaxEnv", ",", 
             RowBox[{"1", "+", 
              RowBox[{"Dec", " ", "AA"}]}], ",", " ", "testpoint", ",", " ", 
             "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], 
            "]"}], "]"}], "\[Equal]", "0"}], "&&", 
         RowBox[{"AA", "<", "10"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Print", "[", "AA", "]"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"1", ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"do", " ", "nothing"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AA", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"AA", "==", "0"}], ",", "0", ",", 
        RowBox[{"AA", "-", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "some", " ", "special", " ", "cases", " ", "pass", " ", "for", " ", 
       "norm"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"1", " ", "+", " ", 
        RowBox[{"Dec", " ", "AA"}]}], " ", "=", " ", "1"}]}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
       "in", " ", "this", " ", "case", " ", "we", " ", "say", " ", "that", 
        " ", "norm"}], " ", "\[Equal]", " ", "1"}], ",", " ", 
      RowBox[{"not", " ", "zero"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"then", " ", "because", " ", "we", " ", "use", " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", "A1"}], ")"}], " ", "as", " ", "the", " ", "norm"}],
       ",", " ", 
      RowBox[{
      "we", " ", "need", " ", "to", " ", "set", " ", "AA", " ", "to", " ", 
       "0"}]}], " ", "*)"}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetMinA01", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
     "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_", ",", 
     "A1_"}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{"output", " ", "of", " ", "previous", " ", "func"}], " ", "*)"}],
     "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AA", "=", "0"}], ",", 
       RowBox[{"Dec", "=", ".1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "\[IndentingNewLine]", 
          RowBox[{"GetGoodNorms", "[", 
           RowBox[{"func", ",", "MinEnv", ",", "MaxEnv", ",", 
            RowBox[{"1", " ", "+", "A1", "+", 
             RowBox[{"Dec", " ", "AA"}]}], ",", " ", "testpoint", ",", " ", 
            "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}],
           "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"1", ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"do", " ", "nothing"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AA", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"AA", "\[Equal]", "0"}], ",", "0", ",", 
        RowBox[{"AA", "-", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetMinA001", "[", 
    RowBox[{
    "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
     "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_", ",", "A1_",
      ",", "A01_"}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{"output", " ", "of", " ", "previous", " ", "func"}], " ", "*)"}],
     "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AA", "=", "0"}], ",", 
       RowBox[{"Dec", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "\[IndentingNewLine]", 
          RowBox[{"GetGoodNorms", "[", 
           RowBox[{"func", ",", "MinEnv", ",", "MaxEnv", ",", 
            RowBox[{"1", " ", "+", "A1", "+", 
             RowBox[{".1", " ", "A01"}], "+", 
             RowBox[{"Dec", " ", "AA"}]}], ",", " ", "testpoint", ",", " ", 
            "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}],
           "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"1", ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"do", " ", "nothing"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AA", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AA", "-", "1"}]}]}], " ", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Put", " ", "these", " ", "all", " ", "together"}], " ", 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.632752632320568*^9, 3.63275282515874*^9}, {
   3.6327529214680862`*^9, 3.632752963101183*^9}, {3.632753031666554*^9, 
   3.632753158024044*^9}, {3.632753193904398*^9, 3.632753230862359*^9}, {
   3.632753268701097*^9, 3.632753304821425*^9}, {3.632835513953051*^9, 
   3.6328356185349607`*^9}, {3.632835748177829*^9, 3.632835752777733*^9}, {
   3.632844729811329*^9, 3.63284478031706*^9}, 3.632845362128564*^9, {
   3.632845813021862*^9, 3.632845903358698*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetMinA", "[", 
   RowBox[{
   "func_", ",", "MinEnv_", ",", "MaxEnv_", ",", "testpoint_", ",", 
    "numSlices_", ",", "numSamples_", ",", "minE_", ",", "maxE_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A1", ",", "A01", ",", "A001"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A1", "=", 
      RowBox[{"GetMinA1", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
        "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"A1", "<", "7"}], ",", "\[IndentingNewLine]", 
       RowBox[{"A01", "=", 
        RowBox[{"GetMinA01", "[", 
         RowBox[{
         "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
          "numSlices", ",", "numSamples", ",", "minE", ",", "maxE", ",", 
          "A1"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"A01", "=", "0"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"A1", "<", "7"}], ",", "\[IndentingNewLine]", 
       RowBox[{"A001", "=", 
        RowBox[{"GetMinA001", "[", 
         RowBox[{
         "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
          "numSlices", ",", "numSamples", ",", "minE", ",", "maxE", ",", "A1",
           ",", "A01"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"A001", "=", "0"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"A1", "<", "7"}], ",", "\[IndentingNewLine]", 
       RowBox[{"1", "+", "A1", "+", 
        RowBox[{".1", " ", "A01"}], " ", "+", " ", 
        RowBox[{".01", 
         RowBox[{"(", 
          RowBox[{"A001", "+", "1"}], " ", 
          RowBox[{"(*", " ", 
           RowBox[{
           "to", " ", "give", " ", "the", " ", "first", " ", "nonzero", " ", 
            "value"}], " ", "*)"}], ")"}]}]}], ",", "\[IndentingNewLine]", 
       "10"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.632753486198041*^9, 3.632753516413951*^9}, {
  3.6327538950972013`*^9, 3.632753957723195*^9}, {3.632754024871085*^9, 
  3.632754035997674*^9}, {3.6328449312121897`*^9, 3.632845029160029*^9}, {
  3.632845078804265*^9, 3.632845085256854*^9}, {3.632845786484435*^9, 
  3.6328457970060368`*^9}, {3.6328520021667557`*^9, 3.632852006253429*^9}}],

Cell["\<\
Actually, an alternate estimated measure of the same quantity is to just \
check the size of GetGoodNorms---the bigger the spread the less wiggle room \
you need.\
\>", "Text",
 CellChangeTimes->{{3.632755867104087*^9, 3.6327558993619213`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["All Information Tag", "Subsection",
 CellChangeTimes->{{3.6327579856242857`*^9, 3.632757988895049*^9}}],

Cell["\<\
This should contain all of the information needed for each parameter point.\
\>", "Text",
 CellChangeTimes->{{3.632759078336317*^9, 3.632759086292596*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FullTag", "[", 
   RowBox[{"mediator_", " ", 
    RowBox[{"(*", "string", "*)"}], ",", "final_", " ", 
    RowBox[{"(*", "string", "*)"}], ",", "path_", ",", "param_", ",", 
    "\[IndentingNewLine]", "MinEnv_", ",", "MaxEnv_", ",", "A_", ",", 
    "testpoint_", ",", "numSlices_", ",", "numSamples_", ",", "minE_", ",", 
    "maxE_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"func", ",", "norms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"func", "=", 
      RowBox[{"GetFunc", "[", 
       RowBox[{"path", ",", "param"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norms", "=", 
      RowBox[{"GetGoodNorms", "[", 
       RowBox[{
       "func", ",", "MinEnv", ",", "MaxEnv", ",", "A", ",", "testpoint", ",", 
        "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"PreTag", "[", 
        RowBox[{"mediator", ",", "final", ",", "param", ",", "path"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Min", "[", "norms", "]"}], ",", 
          RowBox[{"Max", "[", "norms", "]"}]}], "}"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"GetMinA", "[", 
         RowBox[{
         "func", ",", "MinEnv", ",", "MaxEnv", ",", "testpoint", ",", 
          "numSlices", ",", "numSamples", ",", "minE", ",", "maxE"}], "]"}], 
        "}"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.632759187794029*^9, 3.6327592062244*^9}}],

Cell[TextData[{
 "Output is:\n{\nMediator (\[OpenCurlyDoubleQuote]V\[CloseCurlyDoubleQuote] \
or \[OpenCurlyDoubleQuote]sc\[CloseCurlyDoubleQuote]),\nFinal state (e.g. \
\[OpenCurlyDoubleQuote]b\[CloseCurlyDoubleQuote]),\nParameters ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{"m\[Chi]", ",", 
     SubscriptBox["m", "mediator"]}], ")"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ",\nPath,\nMinimum norm to fit,\nMaximum norm to fit,\nMinimum A for which \
the shape fits\n}\n\nNote that to convert the min/max norms into cross \
sections, you need to calculate the J factor for the region of interest from \
which the min/max curves came."
}], "Text",
 CellChangeTimes->{{3.6327592537105217`*^9, 3.632759376196558*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{849, 562},
WindowMargins->{{128, Automatic}, {Automatic, 103}},
FrontEndVersion->"10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September 9, \
2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 326, 5, 92, "Title"],
Cell[909, 29, 3008, 63, 582, "Text"],
Cell[CellGroupData[{
Cell[3942, 96, 98, 1, 44, "Subsection"],
Cell[4043, 99, 6228, 124, 1208, "Text"],
Cell[10274, 225, 205, 5, 28, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10516, 235, 128, 1, 62, "Subchapter"],
Cell[CellGroupData[{
Cell[10669, 240, 157, 2, 64, "Section"],
Cell[CellGroupData[{
Cell[10851, 246, 120, 1, 44, "Subsection"],
Cell[10974, 249, 441, 11, 49, "Text"],
Cell[11418, 262, 982, 24, 114, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[12449, 292, 103, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[12577, 297, 130, 2, 44, "Subsection"],
Cell[CellGroupData[{
Cell[12732, 303, 125, 1, 35, "Subsubsection"],
Cell[12860, 306, 3390, 104, 355, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16287, 415, 133, 1, 35, "Subsubsection"],
Cell[16423, 418, 231, 5, 30, "Text"],
Cell[16657, 425, 1212, 32, 141, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[17930, 464, 111, 1, 64, "Section"],
Cell[18044, 467, 132, 1, 30, "Text"],
Cell[18179, 470, 115, 1, 30, "Text"],
Cell[18297, 473, 596, 19, 51, "DisplayFormula"],
Cell[18896, 494, 677, 14, 122, "Text"],
Cell[19576, 510, 669, 21, 52, "DisplayFormula"],
Cell[20248, 533, 793, 25, 47, "Text"],
Cell[21044, 560, 565, 17, 66, "DisplayFormula"],
Cell[21612, 579, 356, 6, 69, "Text"],
Cell[21971, 587, 515, 15, 113, "DisplayFormula"],
Cell[22489, 604, 234, 5, 30, "Text"],
Cell[22726, 611, 1954, 63, 168, "DisplayFormula"],
Cell[24683, 676, 103, 1, 30, "Text"],
Cell[24789, 679, 1496, 46, 103, "DisplayFormula"]
}, Closed]],
Cell[CellGroupData[{
Cell[26322, 730, 110, 1, 50, "Section"],
Cell[26435, 733, 489, 9, 106, "Text"],
Cell[CellGroupData[{
Cell[26949, 746, 101, 1, 44, "Subsection"],
Cell[27053, 749, 454, 8, 68, "Text"],
Cell[CellGroupData[{
Cell[27532, 761, 301, 4, 35, "Subsubsection"],
Cell[27836, 767, 175, 4, 30, "Text"],
Cell[28014, 773, 3797, 99, 502, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[31848, 877, 152, 2, 29, "Subsubsection"],
Cell[32003, 881, 226, 5, 30, "Text"],
Cell[32232, 888, 4569, 118, 553, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[36838, 1011, 162, 2, 29, "Subsubsection"],
Cell[37003, 1015, 1198, 18, 201, "Text"],
Cell[38204, 1035, 5234, 136, 682, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43475, 1176, 260, 4, 35, "Subsubsection"],
Cell[43738, 1182, 365, 7, 50, "Text"],
Cell[44106, 1191, 13715, 337, 1451, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[57858, 1533, 158, 2, 29, "Subsubsection"],
Cell[58019, 1537, 280, 5, 30, "Text"],
Cell[58302, 1544, 9001, 222, 978, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[67352, 1772, 102, 1, 44, "Subsection"],
Cell[67457, 1775, 884, 15, 163, "Text"],
Cell[CellGroupData[{
Cell[68366, 1794, 226, 3, 35, "Subsubsection"],
Cell[68595, 1799, 5055, 128, 445, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[73687, 1932, 103, 1, 29, "Subsubsection"],
Cell[73793, 1935, 695, 13, 106, "Text"],
Cell[74491, 1950, 3606, 86, 211, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[78134, 2041, 244, 3, 35, "Subsubsection"],
Cell[78381, 2046, 4477, 118, 326, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[82895, 2169, 121, 1, 29, "Subsubsection"],
Cell[83019, 2172, 314, 6, 30, "Text"],
Cell[83336, 2180, 2438, 62, 177, "Input"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[85835, 2249, 112, 1, 50, "Section"],
Cell[85950, 2252, 320, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[86295, 2261, 100, 1, 44, "Subsection"],
Cell[86398, 2264, 336, 9, 32, "Text"],
Cell[86737, 2275, 4131, 121, 256, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[90905, 2401, 114, 1, 44, "Subsection"],
Cell[91022, 2404, 430, 12, 51, "Text"],
Cell[91455, 2418, 2234, 68, 242, "DisplayFormula"],
Cell[93692, 2488, 884, 27, 56, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[94613, 2520, 118, 1, 36, "Subsection"],
Cell[94734, 2523, 4305, 124, 305, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[99076, 2652, 132, 2, 44, "Subsection"],
Cell[99211, 2656, 490, 10, 87, "Text"],
Cell[99704, 2668, 2077, 53, 167, "Input"],
Cell[CellGroupData[{
Cell[101806, 2725, 280, 6, 35, "Subsubsection"],
Cell[102089, 2733, 587, 11, 106, "Text"],
Cell[102679, 2746, 2618, 67, 254, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[105346, 2819, 204, 3, 44, "Subsection"],
Cell[105553, 2824, 578, 11, 87, "Text"],
Cell[106134, 2837, 833, 23, 46, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[107004, 2865, 237, 3, 36, "Subsection"],
Cell[107244, 2870, 512, 10, 87, "Text"],
Cell[107759, 2882, 7632, 183, 706, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[115428, 3070, 101, 1, 36, "Subsection"],
Cell[115532, 3073, 1481, 23, 221, "Text"],
Cell[CellGroupData[{
Cell[117038, 3100, 202, 2, 35, "Subsubsection"],
Cell[117243, 3104, 106, 1, 30, "Text"],
Cell[117352, 3107, 9191, 191, 685, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[126580, 3303, 135, 1, 29, "Subsubsection"],
Cell[126718, 3306, 647, 14, 88, "Text"],
Cell[127368, 3322, 10135, 214, 792, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[137540, 3541, 110, 1, 35, "Subsubsection"],
Cell[137653, 3544, 166, 3, 30, "Text"],
Cell[137822, 3549, 9980, 209, 803, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[147863, 3765, 134, 1, 64, "Section"],
Cell[148000, 3768, 555, 12, 144, "Text"],
Cell[148558, 3782, 3617, 83, 403, "Input"],
Cell[CellGroupData[{
Cell[152200, 3869, 198, 3, 44, "Subsection"],
Cell[152401, 3874, 1319, 34, 148, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[153769, 3914, 120, 1, 50, "Section"],
Cell[153892, 3917, 184, 2, 30, "Text"],
Cell[CellGroupData[{
Cell[154101, 3923, 113, 1, 44, "Subsection"],
Cell[154217, 3926, 4018, 86, 267, "Input"],
Cell[158238, 4014, 3728, 72, 233, "Input"],
Cell[161969, 4088, 1781, 38, 114, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[163787, 4131, 172, 2, 36, "Subsection"],
Cell[163962, 4135, 567, 11, 106, "Text"],
Cell[CellGroupData[{
Cell[164554, 4150, 110, 1, 35, "Subsubsection"],
Cell[164667, 4153, 4295, 88, 284, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[168999, 4246, 126, 1, 35, "Subsubsection"],
Cell[169128, 4249, 3527, 79, 301, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[172728, 4336, 125, 1, 62, "Subchapter"],
Cell[CellGroupData[{
Cell[172878, 4341, 97, 1, 64, "Section"],
Cell[172978, 4344, 643, 12, 106, "Text"],
Cell[173624, 4358, 815, 21, 75, "Input"],
Cell[174442, 4381, 459, 8, 68, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[174938, 4394, 162, 2, 50, "Section"],
Cell[175103, 4398, 814, 20, 73, "Text"],
Cell[175920, 4420, 509, 14, 46, "Input"],
Cell[176432, 4436, 313, 6, 68, "Text"],
Cell[176748, 4444, 136, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[176909, 4449, 1013, 29, 75, "Input"],
Cell[177925, 4480, 26071, 539, 236, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[204033, 5024, 107, 1, 35, "Subsubsection"],
Cell[204143, 5027, 268, 5, 49, "Text"],
Cell[204414, 5034, 644, 18, 28, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[205095, 5057, 108, 1, 35, "Subsubsection"],
Cell[205206, 5060, 162, 5, 32, "Input"],
Cell[205371, 5067, 928, 26, 63, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[206348, 5099, 129, 2, 64, "Section"],
Cell[206480, 5103, 588, 10, 68, "Text"],
Cell[CellGroupData[{
Cell[207093, 5117, 150, 2, 44, "Subsection"],
Cell[207246, 5121, 1150, 31, 164, "Text"],
Cell[208399, 5154, 3192, 86, 225, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[211628, 5245, 163, 3, 44, "Subsection"],
Cell[211794, 5250, 1680, 32, 333, "Text"],
Cell[213477, 5284, 3995, 99, 400, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[217509, 5388, 119, 1, 44, "Subsection"],
Cell[217631, 5391, 256, 5, 49, "Text"],
Cell[217890, 5398, 1351, 34, 97, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[219278, 5437, 163, 2, 44, "Subsection"],
Cell[219444, 5441, 6121, 141, 579, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[225614, 5588, 90, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[225729, 5593, 136, 2, 44, "Subsection"],
Cell[225868, 5597, 928, 23, 80, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[226833, 5625, 103, 1, 44, "Subsection"],
Cell[226939, 5628, 163, 3, 30, "Text"],
Cell[227105, 5633, 435, 10, 46, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[227577, 5648, 122, 1, 44, "Subsection"],
Cell[227702, 5651, 400, 10, 28, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[228139, 5666, 112, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[228276, 5671, 157, 2, 35, "Subsubsection"],
Cell[228436, 5675, 426, 7, 68, "Text"],
Cell[228865, 5684, 3149, 71, 403, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[232051, 5760, 113, 1, 35, "Subsubsection"],
Cell[232167, 5763, 2531, 67, 233, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[234747, 5836, 110, 1, 44, "Subsection"],
Cell[234860, 5839, 1002, 16, 239, "Text"],
Cell[CellGroupData[{
Cell[235887, 5859, 208, 3, 35, "Subsubsection"],
Cell[236098, 5864, 5931, 139, 743, "Input"],
Cell[242032, 6005, 1729, 42, 148, "Input"],
Cell[243764, 6049, 254, 5, 49, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[244055, 6059, 247, 3, 29, "Subsubsection"],
Cell[244305, 6064, 356, 6, 49, "Text"],
Cell[244664, 6072, 6226, 145, 760, "Input"],
Cell[250893, 6219, 2466, 55, 250, "Input"],
Cell[253362, 6276, 254, 5, 49, "Text"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[253665, 6287, 109, 1, 44, "Subsection"],
Cell[253777, 6290, 165, 3, 30, "Text"],
Cell[253945, 6295, 1761, 41, 216, "Input"],
Cell[255709, 6338, 747, 15, 260, "Text"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
